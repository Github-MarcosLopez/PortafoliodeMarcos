"use strict";var m=require("@cloudflare/kv-asset-handler");const y="object"==typeof performance&&performance&&"function"==typeof performance.now?performance:Date,k="function"==typeof AbortController?AbortController:class AbortController{constructor(){this.signal=new P}abort(){this.signal.dispatchEvent("abort")}},I="function"==typeof AbortSignal,z="function"==typeof k.AbortSignal,P=I?AbortSignal:z?k.AbortController:class AbortSignal{constructor(){this.aborted=!1,this._listeners=[]}dispatchEvent(m){if("abort"===m){this.aborted=!0;const y={type:m,target:this};this.onabort(y),this._listeners.forEach((m=>m(y)),this)}}onabort(){}addEventListener(m,y){"abort"===m&&this._listeners.push(y)}removeEventListener(m,y){"abort"===m&&(this._listeners=this._listeners.filter((m=>m!==y)))}},N=new Set,deprecatedOption=(m,y)=>{const k=`LRU_CACHE_OPTION_${m}`;shouldWarn(k)&&warn(k,`${m} option`,`options.${y}`,LRUCache)},deprecatedMethod=(m,y)=>{const k=`LRU_CACHE_METHOD_${m}`;if(shouldWarn(k)){const{prototype:I}=LRUCache,{get:z}=Object.getOwnPropertyDescriptor(I,m);warn(k,`${m} method`,`cache.${y}()`,z)}},emitWarning=(...m)=>{"object"==typeof process&&process&&"function"==typeof process.emitWarning?process.emitWarning(...m):console.error(...m)},shouldWarn=m=>!N.has(m),warn=(m,y,k,I)=>{N.add(m);emitWarning(`The ${y} is deprecated. Please use ${k} instead.`,"DeprecationWarning",m,I)},isPosInt=m=>m&&m===Math.floor(m)&&m>0&&isFinite(m),getUintArray=m=>isPosInt(m)?m<=Math.pow(2,8)?Uint8Array:m<=Math.pow(2,16)?Uint16Array:m<=Math.pow(2,32)?Uint32Array:m<=Number.MAX_SAFE_INTEGER?ZeroArray:null:null;class ZeroArray extends Array{constructor(m){super(m),this.fill(0)}}class Stack{constructor(m){if(0===m)return[];const y=getUintArray(m);this.heap=new y(m),this.length=0}push(m){this.heap[this.length++]=m}pop(){return this.heap[--this.length]}}class LRUCache{constructor(m={}){const{max:y=0,ttl:k,ttlResolution:I=1,ttlAutopurge:z,updateAgeOnGet:P,updateAgeOnHas:O,allowStale:U,dispose:B,disposeAfter:M,noDisposeOnSet:j,noUpdateTTL:G,maxSize:H=0,maxEntrySize:V=0,sizeCalculation:q,fetchMethod:Z,fetchContext:$,noDeleteOnFetchRejection:W,noDeleteOnStaleGet:X}=m,{length:J,maxAge:Y,stale:K}=m instanceof LRUCache?{}:m;if(0!==y&&!isPosInt(y))throw new TypeError("max option must be a nonnegative integer");const Q=y?getUintArray(y):Array;if(!Q)throw new Error("invalid max value: "+y);if(this.max=y,this.maxSize=H,this.maxEntrySize=V||this.maxSize,this.sizeCalculation=q||J,this.sizeCalculation){if(!this.maxSize&&!this.maxEntrySize)throw new TypeError("cannot set sizeCalculation without setting maxSize or maxEntrySize");if("function"!=typeof this.sizeCalculation)throw new TypeError("sizeCalculation set to non-function")}if(this.fetchMethod=Z||null,this.fetchMethod&&"function"!=typeof this.fetchMethod)throw new TypeError("fetchMethod must be a function if specified");if(this.fetchContext=$,!this.fetchMethod&&void 0!==$)throw new TypeError("cannot set fetchContext without fetchMethod");if(this.keyMap=new Map,this.keyList=new Array(y).fill(null),this.valList=new Array(y).fill(null),this.next=new Q(y),this.prev=new Q(y),this.head=0,this.tail=0,this.free=new Stack(y),this.initialFill=1,this.size=0,"function"==typeof B&&(this.dispose=B),"function"==typeof M?(this.disposeAfter=M,this.disposed=[]):(this.disposeAfter=null,this.disposed=null),this.noDisposeOnSet=!!j,this.noUpdateTTL=!!G,this.noDeleteOnFetchRejection=!!W,0!==this.maxEntrySize){if(0!==this.maxSize&&!isPosInt(this.maxSize))throw new TypeError("maxSize must be a positive integer if specified");if(!isPosInt(this.maxEntrySize))throw new TypeError("maxEntrySize must be a positive integer if specified");this.initializeSizeTracking()}if(this.allowStale=!!U||!!K,this.noDeleteOnStaleGet=!!X,this.updateAgeOnGet=!!P,this.updateAgeOnHas=!!O,this.ttlResolution=isPosInt(I)||0===I?I:1,this.ttlAutopurge=!!z,this.ttl=k||Y||0,this.ttl){if(!isPosInt(this.ttl))throw new TypeError("ttl must be a positive integer if specified");this.initializeTTLTracking()}if(0===this.max&&0===this.ttl&&0===this.maxSize)throw new TypeError("At least one of max, maxSize, or ttl is required");if(!this.ttlAutopurge&&!this.max&&!this.maxSize){const m="LRU_CACHE_UNBOUNDED";if(shouldWarn(m)){N.add(m);emitWarning("TTL caching without ttlAutopurge, max, or maxSize can result in unbounded memory consumption.","UnboundedCacheWarning",m,LRUCache)}}K&&deprecatedOption("stale","allowStale"),Y&&deprecatedOption("maxAge","ttl"),J&&deprecatedOption("length","sizeCalculation")}getRemainingTTL(m){return this.has(m,{updateAgeOnHas:!1})?1/0:0}initializeTTLTracking(){this.ttls=new ZeroArray(this.max),this.starts=new ZeroArray(this.max),this.setItemTTL=(m,k,I=y.now())=>{if(this.starts[m]=0!==k?I:0,this.ttls[m]=k,0!==k&&this.ttlAutopurge){const y=setTimeout((()=>{this.isStale(m)&&this.delete(this.keyList[m])}),k+1);y.unref&&y.unref()}},this.updateItemAge=m=>{this.starts[m]=0!==this.ttls[m]?y.now():0};let m=0;const getNow=()=>{const k=y.now();if(this.ttlResolution>0){m=k;const y=setTimeout((()=>m=0),this.ttlResolution);y.unref&&y.unref()}return k};this.getRemainingTTL=y=>{const k=this.keyMap.get(y);return void 0===k?0:0===this.ttls[k]||0===this.starts[k]?1/0:this.starts[k]+this.ttls[k]-(m||getNow())},this.isStale=y=>0!==this.ttls[y]&&0!==this.starts[y]&&(m||getNow())-this.starts[y]>this.ttls[y]}updateItemAge(m){}setItemTTL(m,y,k){}isStale(m){return!1}initializeSizeTracking(){this.calculatedSize=0,this.sizes=new ZeroArray(this.max),this.removeItemSize=m=>{this.calculatedSize-=this.sizes[m],this.sizes[m]=0},this.requireSize=(m,y,k,I)=>{if(this.isBackgroundFetch(y))return 0;if(!isPosInt(k)){if(!I)throw new TypeError("invalid size value (must be positive integer)");if("function"!=typeof I)throw new TypeError("sizeCalculation must be a function");if(k=I(y,m),!isPosInt(k))throw new TypeError("sizeCalculation return invalid (expect positive integer)")}return k},this.addItemSize=(m,y)=>{if(this.sizes[m]=y,this.maxSize){const y=this.maxSize-this.sizes[m];for(;this.calculatedSize>y;)this.evict(!0)}this.calculatedSize+=this.sizes[m]}}removeItemSize(m){}addItemSize(m,y){}requireSize(m,y,k,I){if(k||I)throw new TypeError("cannot set size without setting maxSize or maxEntrySize on cache")}*indexes({allowStale:m=this.allowStale}={}){if(this.size)for(let y=this.tail;this.isValidIndex(y)&&(!m&&this.isStale(y)||(yield y),y!==this.head);)y=this.prev[y]}*rindexes({allowStale:m=this.allowStale}={}){if(this.size)for(let y=this.head;this.isValidIndex(y)&&(!m&&this.isStale(y)||(yield y),y!==this.tail);)y=this.next[y]}isValidIndex(m){return this.keyMap.get(this.keyList[m])===m}*entries(){for(const m of this.indexes())yield[this.keyList[m],this.valList[m]]}*rentries(){for(const m of this.rindexes())yield[this.keyList[m],this.valList[m]]}*keys(){for(const m of this.indexes())yield this.keyList[m]}*rkeys(){for(const m of this.rindexes())yield this.keyList[m]}*values(){for(const m of this.indexes())yield this.valList[m]}*rvalues(){for(const m of this.rindexes())yield this.valList[m]}[Symbol.iterator](){return this.entries()}find(m,y={}){for(const k of this.indexes())if(m(this.valList[k],this.keyList[k],this))return this.get(this.keyList[k],y)}forEach(m,y=this){for(const k of this.indexes())m.call(y,this.valList[k],this.keyList[k],this)}rforEach(m,y=this){for(const k of this.rindexes())m.call(y,this.valList[k],this.keyList[k],this)}get prune(){return deprecatedMethod("prune","purgeStale"),this.purgeStale}purgeStale(){let m=!1;for(const y of this.rindexes({allowStale:!0}))this.isStale(y)&&(this.delete(this.keyList[y]),m=!0);return m}dump(){const m=[];for(const k of this.indexes({allowStale:!0})){const I=this.keyList[k],z=this.valList[k],P={value:this.isBackgroundFetch(z)?z.__staleWhileFetching:z};if(this.ttls){P.ttl=this.ttls[k];const m=y.now()-this.starts[k];P.start=Math.floor(Date.now()-m)}this.sizes&&(P.size=this.sizes[k]),m.unshift([I,P])}return m}load(m){this.clear();for(const[k,I]of m){if(I.start){const m=Date.now()-I.start;I.start=y.now()-m}this.set(k,I.value,I)}}dispose(m,y,k){}set(m,y,{ttl:k=this.ttl,start:I,noDisposeOnSet:z=this.noDisposeOnSet,size:P=0,sizeCalculation:N=this.sizeCalculation,noUpdateTTL:O=this.noUpdateTTL}={}){if(P=this.requireSize(m,y,P,N),this.maxEntrySize&&P>this.maxEntrySize)return this.delete(m),this;let U=0===this.size?void 0:this.keyMap.get(m);if(void 0===U)U=this.newIndex(),this.keyList[U]=m,this.valList[U]=y,this.keyMap.set(m,U),this.next[this.tail]=U,this.prev[U]=this.tail,this.tail=U,this.size++,this.addItemSize(U,P),O=!1;else{const k=this.valList[U];y!==k&&(this.isBackgroundFetch(k)?k.__abortController.abort():z||(this.dispose(k,m,"set"),this.disposeAfter&&this.disposed.push([k,m,"set"])),this.removeItemSize(U),this.valList[U]=y,this.addItemSize(U,P)),this.moveToTail(U)}if(0===k||0!==this.ttl||this.ttls||this.initializeTTLTracking(),O||this.setItemTTL(U,k,I),this.disposeAfter)for(;this.disposed.length;)this.disposeAfter(...this.disposed.shift());return this}newIndex(){return 0===this.size?this.tail:this.size===this.max&&0!==this.max?this.evict(!1):0!==this.free.length?this.free.pop():this.initialFill++}pop(){if(this.size){const m=this.valList[this.head];return this.evict(!0),m}}evict(m){const y=this.head,k=this.keyList[y],I=this.valList[y];return this.isBackgroundFetch(I)?I.__abortController.abort():(this.dispose(I,k,"evict"),this.disposeAfter&&this.disposed.push([I,k,"evict"])),this.removeItemSize(y),m&&(this.keyList[y]=null,this.valList[y]=null,this.free.push(y)),this.head=this.next[y],this.keyMap.delete(k),this.size--,y}has(m,{updateAgeOnHas:y=this.updateAgeOnHas}={}){const k=this.keyMap.get(m);return void 0!==k&&!this.isStale(k)&&(y&&this.updateItemAge(k),!0)}peek(m,{allowStale:y=this.allowStale}={}){const k=this.keyMap.get(m);if(void 0!==k&&(y||!this.isStale(k))){const m=this.valList[k];return this.isBackgroundFetch(m)?m.__staleWhileFetching:m}}backgroundFetch(m,y,I,z){const P=void 0===y?void 0:this.valList[y];if(this.isBackgroundFetch(P))return P;const N=new k,O={signal:N.signal,options:I,context:z},U=new Promise((y=>y(this.fetchMethod(m,P,O)))).then((y=>(N.signal.aborted||this.set(m,y,O.options),y)),(k=>{if(this.valList[y]===U){!I.noDeleteOnFetchRejection||void 0===U.__staleWhileFetching?this.delete(m):this.valList[y]=U.__staleWhileFetching}if(U.__returned===U)throw k}));return U.__abortController=N,U.__staleWhileFetching=P,U.__returned=null,void 0===y?(this.set(m,U,O.options),y=this.keyMap.get(m)):this.valList[y]=U,U}isBackgroundFetch(m){return m&&"object"==typeof m&&"function"==typeof m.then&&Object.prototype.hasOwnProperty.call(m,"__staleWhileFetching")&&Object.prototype.hasOwnProperty.call(m,"__returned")&&(m.__returned===m||null===m.__returned)}async fetch(m,{allowStale:y=this.allowStale,updateAgeOnGet:k=this.updateAgeOnGet,noDeleteOnStaleGet:I=this.noDeleteOnStaleGet,ttl:z=this.ttl,noDisposeOnSet:P=this.noDisposeOnSet,size:N=0,sizeCalculation:O=this.sizeCalculation,noUpdateTTL:U=this.noUpdateTTL,noDeleteOnFetchRejection:B=this.noDeleteOnFetchRejection,fetchContext:M=this.fetchContext,forceRefresh:j=!1}={}){if(!this.fetchMethod)return this.get(m,{allowStale:y,updateAgeOnGet:k,noDeleteOnStaleGet:I});const G={allowStale:y,updateAgeOnGet:k,noDeleteOnStaleGet:I,ttl:z,noDisposeOnSet:P,size:N,sizeCalculation:O,noUpdateTTL:U,noDeleteOnFetchRejection:B};let H=this.keyMap.get(m);if(void 0===H){const y=this.backgroundFetch(m,H,G,M);return y.__returned=y}{const I=this.valList[H];if(this.isBackgroundFetch(I))return y&&void 0!==I.__staleWhileFetching?I.__staleWhileFetching:I.__returned=I;if(!j&&!this.isStale(H))return this.moveToTail(H),k&&this.updateItemAge(H),I;const z=this.backgroundFetch(m,H,G,M);return y&&void 0!==z.__staleWhileFetching?z.__staleWhileFetching:z.__returned=z}}get(m,{allowStale:y=this.allowStale,updateAgeOnGet:k=this.updateAgeOnGet,noDeleteOnStaleGet:I=this.noDeleteOnStaleGet}={}){const z=this.keyMap.get(m);if(void 0!==z){const P=this.valList[z],N=this.isBackgroundFetch(P);if(this.isStale(z))return N?y?P.__staleWhileFetching:void 0:(I||this.delete(m),y?P:void 0);if(N)return;return this.moveToTail(z),k&&this.updateItemAge(z),P}}connect(m,y){this.prev[y]=m,this.next[m]=y}moveToTail(m){m!==this.tail&&(m===this.head?this.head=this.next[m]:this.connect(this.prev[m],this.next[m]),this.connect(this.tail,m),this.tail=m)}get del(){return deprecatedMethod("del","delete"),this.delete}delete(m){let y=!1;if(0!==this.size){const k=this.keyMap.get(m);if(void 0!==k)if(y=!0,1===this.size)this.clear();else{this.removeItemSize(k);const y=this.valList[k];this.isBackgroundFetch(y)?y.__abortController.abort():(this.dispose(y,m,"delete"),this.disposeAfter&&this.disposed.push([y,m,"delete"])),this.keyMap.delete(m),this.keyList[k]=null,this.valList[k]=null,k===this.tail?this.tail=this.prev[k]:k===this.head?this.head=this.next[k]:(this.next[this.prev[k]]=this.next[k],this.prev[this.next[k]]=this.prev[k]),this.size--,this.free.push(k)}}if(this.disposed)for(;this.disposed.length;)this.disposeAfter(...this.disposed.shift());return y}clear(){for(const m of this.rindexes({allowStale:!0})){const y=this.valList[m];if(this.isBackgroundFetch(y))y.__abortController.abort();else{const k=this.keyList[m];this.dispose(y,k,"delete"),this.disposeAfter&&this.disposed.push([y,k,"delete"])}}if(this.keyMap.clear(),this.valList.fill(null),this.keyList.fill(null),this.ttls&&(this.ttls.fill(0),this.starts.fill(0)),this.sizes&&this.sizes.fill(0),this.head=0,this.tail=0,this.initialFill=1,this.free.length=0,this.calculatedSize=0,this.size=0,this.disposed)for(;this.disposed.length;)this.disposeAfter(...this.disposed.shift())}get reset(){return deprecatedMethod("reset","clear"),this.clear}get length(){return((m,y)=>{const k=`LRU_CACHE_PROPERTY_${m}`;if(shouldWarn(k)){const{prototype:I}=LRUCache,{get:z}=Object.getOwnPropertyDescriptor(I,m);warn(k,`${m} property`,`cache.${y}`,z)}})("length","size"),this.size}static get AbortController(){return k}static get AbortSignal(){return P}}var O,U=LRUCache;exports.CacheStatus=void 0,(O=exports.CacheStatus||(exports.CacheStatus={})).HIT="hit",O.STALE="stale",O.MISS="miss";class Cache{}const mB=m=>1e6*m;const B={0:{66:{77:"image/bmp"},71:{73:{70:"image/gif"}},73:{73:{42:{0:"image/tiff"}}},77:{77:{0:{42:"image/tiff"}}},137:{80:{78:{71:{13:{10:{26:{10:"image/png"}}}}}}},255:{216:{255:"image/jpeg"}}},4:{102:{116:{121:{112:{97:{118:{105:{102:"image/avif",115:"image/avif"}}}}}}}},8:{87:{69:{66:{80:"image/webp"}}}}},M=[0,4,8];var j;!function(m){m.SVG="image/svg+xml",m.JPEG="image/jpeg",m.PNG="image/png",m.GIF="image/gif",m.WEBP="image/webp",m.BMP="image/bmp",m.TIFF="image/tiff",m.AVIF="image/avif"}(j||(j={}));const i$1=m=>{if(!m||m.byteLength<3)throw new Error("Buffer is not a valid image!");for(const y of M){let k=B[y];for(let I=y;I<=12;I+=1){const y=m[I];if("object"!=typeof k)return k;if(!Object.prototype.hasOwnProperty.call(k,y))break;k=k[y]}}throw new Error("Buffer is not a supported image type!")};var G,H;!function(m){m.SVG="image/svg+xml",m.JPEG="image/jpeg",m.PNG="image/png",m.GIF="image/gif",m.WEBP="image/webp",m.BMP="image/bmp",m.TIFF="image/tiff",m.AVIF="image/avif"}(G||(G={})),function(m){m[m.BITMAP_INFO_HEADER=40]="BITMAP_INFO_HEADER",m[m.BITMAP_V2_INFO_HEADER=52]="BITMAP_V2_INFO_HEADER",m[m.BITMAP_V3_INFO_HEADER=56]="BITMAP_V3_INFO_HEADER",m[m.BITMAP_V4_HEADER=108]="BITMAP_V4_HEADER",m[m.BITMAP_V5_HEADER=124]="BITMAP_V5_HEADER"}(H||(H={}));var V,q=H;class h{constructor(m,{toRGBA:y}={toRGBA:!1}){if(this.buffer=m,this.bufferView=new DataView(m.buffer,m.byteOffset,m.byteLength),this.toRGBA=!!y,this.bottomUp=!0,this.flag=String.fromCharCode(this.buffer[0])+String.fromCharCode(this.buffer[1]),this.pos=2,"BM"!==this.flag)throw new Error("Invalid BMP File");this.locRed=this.toRGBA?0:3,this.locGreen=this.toRGBA?1:2,this.locBlue=this.toRGBA?2:1,this.locAlpha=this.toRGBA?3:0,this.parseHeader(),this.parseRGBA()}parseHeader(){if(this.fileSize=this.readUInt32LE(),this.reserved1=this.bufferView.getUint16(this.pos,!0),this.pos+=2,this.reserved2=this.bufferView.getUint16(this.pos,!0),this.pos+=2,this.offset=this.readUInt32LE(),this.headerSize=this.readUInt32LE(),!(this.headerSize in q))throw new Error(`Unsupported BMP header size ${this.headerSize}`);if(this.width=this.readUInt32LE(),this.height=this.readUInt32LE(),this.planes=this.bufferView.getUint16(this.pos,!0),this.pos+=2,this.bitPP=this.bufferView.getUint16(this.pos,!0),this.pos+=2,this.compression=this.readUInt32LE(),this.rawSize=this.readUInt32LE(),this.hr=this.readUInt32LE(),this.vr=this.readUInt32LE(),this.colors=this.readUInt32LE(),this.importantColors=this.readUInt32LE(),32===this.bitPP?(this.maskAlpha=0,this.maskRed=16711680,this.maskGreen=65280,this.maskBlue=255):16===this.bitPP&&(this.maskAlpha=0,this.maskRed=31744,this.maskGreen=992,this.maskBlue=31),(this.headerSize>q.BITMAP_INFO_HEADER||3===this.compression||6===this.compression)&&(this.maskRed=this.readUInt32LE(),this.maskGreen=this.readUInt32LE(),this.maskBlue=this.readUInt32LE()),(this.headerSize>q.BITMAP_V2_INFO_HEADER||6===this.compression)&&(this.maskAlpha=this.readUInt32LE()),this.headerSize>q.BITMAP_V3_INFO_HEADER&&(this.pos+=q.BITMAP_V4_HEADER-q.BITMAP_V3_INFO_HEADER),this.headerSize>q.BITMAP_V4_HEADER&&(this.pos+=q.BITMAP_V5_HEADER-q.BITMAP_V4_HEADER),this.bitPP<=8||this.colors>0){const m=0===this.colors?1<<this.bitPP:this.colors;this.palette=new Array(m);for(let y=0;y<m;y++){const m=this.buffer[this.pos++],k=this.buffer[this.pos++],I=this.buffer[this.pos++],z=this.buffer[this.pos++];this.palette[y]={red:I,green:k,blue:m,quad:z}}}this.height<0&&(this.height*=-1,this.bottomUp=!1);const m=function(m,y,k,I){const z=1+~m&m,P=1+~y&y,N=1+~k&k,O=1+~I&I,U=m/z+1,B=y/P+1,M=k/N+1,j=I/O+1;return{shiftRed:y=>(y&m)/z*256/U,shiftGreen:m=>(m&y)/P*256/B,shiftBlue:m=>(m&k)/N*256/M,shiftAlpha:0!==I?m=>(m&I)/O*256/j:()=>255}}(this.maskRed,this.maskGreen,this.maskBlue,this.maskAlpha);this.shiftRed=m.shiftRed,this.shiftGreen=m.shiftGreen,this.shiftBlue=m.shiftBlue,this.shiftAlpha=m.shiftAlpha}parseRGBA(){switch(this.data=new Uint8Array(this.width*this.height*4),this.bitPP){case 1:this.bit1();break;case 4:this.bit4();break;case 8:this.bit8();break;case 16:this.bit16();break;case 24:this.bit24();break;default:this.bit32()}}bit1(){const m=Math.ceil(this.width/8),y=m%4,k=0!==y?4-y:0;this.scanImage(k,m,((m,y)=>{const k=this.buffer[this.pos++],I=y*this.width*4+8*m*4;for(let y=0;y<8&&8*m+y<this.width;y++){const m=this.palette[k>>7-y&1];this.data[I+y*this.locAlpha]=0,this.data[I+4*y+this.locBlue]=m.blue,this.data[I+4*y+this.locGreen]=m.green,this.data[I+4*y+this.locRed]=m.red}}))}bit4(){if(2===this.compression){this.data.fill(0);let m=!1,y=this.bottomUp?this.height-1:0,k=0;for(;k<this.data.length;){const I=this.buffer[this.pos++],z=this.buffer[this.pos++];if(0===I){if(0===z){y+=this.bottomUp?-1:1,k=y*this.width*4,m=!1;continue}if(1===z)break;if(2===z){const m=this.buffer[this.pos++],I=this.buffer[this.pos++];y+=this.bottomUp?-I:I,k+=I*this.width*4+4*m}else{let y=this.buffer[this.pos++];for(let I=0;I<z;I++)k=this.setPixelData(k,m?15&y:(240&y)>>4),1&I&&I+1<z&&(y=this.buffer[this.pos++]),m=!m;1==(z+1>>1&1)&&this.pos++}}else for(let y=0;y<I;y++)k=this.setPixelData(k,m?15&z:(240&z)>>4),m=!m}}else{const m=Math.ceil(this.width/2),y=m%4,k=0!==y?4-y:0;this.scanImage(k,m,((m,y)=>{const k=this.buffer[this.pos++],I=y*this.width*4+2*m*4,z=k>>4;let P=this.palette[z];if(this.data[I]=0,this.data[I+1]=P.blue,this.data[I+2]=P.green,this.data[I+3]=P.red,2*m+1>=this.width)return!1;const N=15&k;P=this.palette[N],this.data[I+4]=0,this.data[I+4+1]=P.blue,this.data[I+4+2]=P.green,this.data[I+4+3]=P.red}))}}bit8(){if(1===this.compression){this.data.fill(0);let m=this.bottomUp?this.height-1:0,y=0;for(;y<this.data.length;){const k=this.buffer[this.pos++],I=this.buffer[this.pos++];if(0===k){if(0===I){m+=this.bottomUp?-1:1,y=m*this.width*4;continue}if(1===I)break;if(2===I){const k=this.buffer[this.pos++],I=this.buffer[this.pos++];m+=this.bottomUp?-I:I,y+=I*this.width*4+4*k}else{for(let m=0;m<I;m++){const m=this.buffer[this.pos++];y=this.setPixelData(y,m)}!0&I&&this.pos++}}else for(let m=0;m<k;m++)y=this.setPixelData(y,I)}}else{const m=this.width%4,y=0!==m?4-m:0;this.scanImage(y,this.width,((m,y)=>{const k=this.buffer[this.pos++],I=y*this.width*4+4*m;if(k<this.palette.length){const m=this.palette[k];this.data[I]=0,this.data[I+1]=m.blue,this.data[I+2]=m.green,this.data[I+3]=m.red}else this.data[I]=0,this.data[I+1]=255,this.data[I+2]=255,this.data[I+3]=255}))}}bit16(){const m=this.width%2*2;this.scanImage(m,this.width,((m,y)=>{const k=y*this.width*4+4*m,I=this.bufferView.getUint16(this.pos,!0);this.pos+=2,this.data[k+this.locRed]=this.shiftRed(I),this.data[k+this.locGreen]=this.shiftGreen(I),this.data[k+this.locBlue]=this.shiftBlue(I),this.data[k+this.locAlpha]=this.shiftAlpha(I)}))}bit24(){const m=this.width%4;this.scanImage(m,this.width,((m,y)=>{const k=y*this.width*4+4*m,I=this.buffer[this.pos++],z=this.buffer[this.pos++],P=this.buffer[this.pos++];this.data[k+this.locRed]=P,this.data[k+this.locGreen]=z,this.data[k+this.locBlue]=I,this.data[k+this.locAlpha]=0}))}bit32(){this.scanImage(0,this.width,((m,y)=>{const k=y*this.width*4+4*m,I=this.readUInt32LE();this.data[k+this.locRed]=this.shiftRed(I),this.data[k+this.locGreen]=this.shiftGreen(I),this.data[k+this.locBlue]=this.shiftBlue(I),this.data[k+this.locAlpha]=this.shiftAlpha(I)}))}scanImage(m=0,y=this.width,k){for(let I=this.height-1;I>=0;I--){const z=this.bottomUp?I:this.height-1-I;for(let m=0;m<y;m++)k.call(this,m,z);this.pos+=m}}readUInt32LE(){const m=this.bufferView.getUint32(this.pos,!0);return this.pos+=4,m}setPixelData(m,y){const{blue:k,green:I,red:z}=this.palette[y];return this.data[m+this.locAlpha]=0,this.data[m+1+this.locBlue]=k,this.data[m+2+this.locGreen]=I,this.data[m+3+this.locRed]=z,m+4}}function f(m){return m.reduce(((m,y)=>m<<1|y),0)}function l(m){return m.quad<<24|m.red<<16|m.green<<8|m.blue}class d{constructor(m){switch(this.buffer=m.data,this.width=m.width,this.height=m.height,this.headerSize=q.BITMAP_INFO_HEADER,this.flag="BM",this.bitPP=m.bitPP,this.offset=54,this.reserved1=m.reserved1||0,this.reserved2=m.reserved2||0,this.planes=1,this.compress=0,this.hr=m.hr||0,this.vr=m.vr||0,this.importantColors=m.importantColors||0,this.colors=Math.min(Math.pow(2,this.bitPP-1||1),m.colors||1/0),this.palette=m.palette||[],this.colors&&this.bitPP<16?this.offset+=4*this.colors:this.colors=0,this.bitPP){case 32:this.bytesInColor=4;break;case 16:this.bytesInColor=2;break;case 8:this.bytesInColor=1;break;case 4:this.bytesInColor=.5;break;case 1:this.bytesInColor=1/8;break;default:this.bytesInColor=3,this.bitPP=24}const y=this.width*this.bitPP/32,k=Math.ceil(y);this.extraBytes=4*(k-y),this.rawSize=this.height*k*4+2,this.fileSize=this.rawSize+this.offset,this.data=new Uint8Array(this.fileSize),this.dataView=new DataView(this.data.buffer),this.data.fill(1),this.pos=0,this.encode()}encode(){switch(this.pos=0,this.writeHeader(),this.bitPP){case 32:this.bit32();break;case 16:this.bit16();break;case 8:this.bit8();break;case 4:this.bit4();break;case 1:this.bit1();break;default:this.bit24()}}writeHeader(){this.data[this.pos++]=this.flag.charCodeAt(0),this.data[this.pos++]=this.flag.charCodeAt(1),this.writeUInt32LE(this.fileSize),this.writeUInt32LE(this.reserved1<<16|this.reserved2),this.writeUInt32LE(this.offset),this.writeUInt32LE(this.headerSize),this.writeUInt32LE(this.width),this.writeUInt32LE(this.height),this.dataView.setUint16(this.pos,this.planes,!0),this.pos+=2,this.dataView.setUint16(this.pos,this.bitPP,!0),this.pos+=2,this.writeUInt32LE(this.compress),this.writeUInt32LE(this.rawSize),this.writeUInt32LE(this.hr),this.writeUInt32LE(this.vr),this.writeUInt32LE(this.colors),this.writeUInt32LE(this.importantColors)}bit1(){this.palette.length&&2===this.colors?this.initColors(1):(this.writeUInt32LE(16777215),this.writeUInt32LE(0)),this.pos+=1;let m=[];this.writeImage(((y,k,I)=>{let z=k;z++;const P=this.buffer[z++],N=this.buffer[z++],O=.2126*this.buffer[z++]+.7152*N+.0722*P;return m.push(O>127?0:1),(I+1)%8==0?(this.data[y-1]=f(m),m=[]):I===this.width-1&&m.length>0&&(this.data[y-1]=f(m)<<4,m=[]),z}))}bit4(){const m=this.initColors(4);let y=[];this.writeImage(((k,I,z)=>{let P=I;const N=l({quad:this.buffer[P++],blue:this.buffer[P++],green:this.buffer[P++],red:this.buffer[P++]}),O=m.findIndex((m=>m===N));return-1!==O?y.push(O):y.push(0),(z+1)%2==0&&(this.data[k]=y[0]<<4|y[1],y=[]),P}))}bit8(){const m=this.initColors(8);this.writeImage(((y,k)=>{let I=k;const z=l({quad:this.buffer[I++],blue:this.buffer[I++],green:this.buffer[I++],red:this.buffer[I++]}),P=m.findIndex((m=>m===z));return this.data[y]=-1!==P?P:0,I}))}bit16(){this.writeImage(((m,y)=>{let k=y+1;const I=this.buffer[k++]/8,z=this.buffer[k++]/8,P=this.buffer[k++]/8<<10|z<<5|I;return this.data[m]=255&P,this.data[m+1]=(65280&P)>>8,k}))}bit24(){this.writeImage(((m,y)=>{let k=y+1;return this.data[m]=this.buffer[k++],this.data[m+1]=this.buffer[k++],this.data[m+2]=this.buffer[k++],k}))}bit32(){this.writeImage(((m,y)=>{let k=y;return this.data[m+3]=this.buffer[k++],this.data[m]=this.buffer[k++],this.data[m+1]=this.buffer[k++],this.data[m+2]=this.buffer[k++],k}))}writeImage(m){const y=this.extraBytes+this.width*this.bytesInColor;let k=0;for(let I=0;I<this.height;I++)for(let z=0;z<this.width;z++){const P=Math.floor(this.pos+(this.height-1-I)*y+z*this.bytesInColor);k=m.call(this,P,k,z,I)}}initColors(m){const y=[];if(!this.palette.length)throw new Error(`To encode ${m}-bit BMPs a pallette is needed. Please choose up to ${this.colors} colors. Colors must be 32-bit integers.`);for(let m=0;m<this.colors;m++){const k=l(this.palette[m]);this.writeUInt32LE(k),y.push(k)}return y}writeUInt32LE(m){this.dataView.setUint32(this.pos,m,!0),this.pos+=4}}!function(m){m[m.NONE=0]="NONE",m[m.BI_RLE8=1]="BI_RLE8",m[m.BI_RLE4=2]="BI_RLE4",m[m.BI_BIT_FIELDS=3]="BI_BIT_FIELDS",m[m.BI_ALPHA_BIT_FIELDS=6]="BI_ALPHA_BIT_FIELDS"}(V||(V={}));const p=m=>{const y=m.length,k=new Uint8Array(y);for(let I=0;I<y;I+=4)k[I]=m[I+3],k[I+1]=m[I+2],k[I+2]=m[I+1],k[I+3]=m[I];return k},Z={decode(m){const y=((m,y)=>new h(m,y))(m,{toRGBA:!0});return{width:y.width,height:y.height,data:y.data}},encode:m=>(m=>new d(m))({bitPP:32,width:m.width,height:m.height,data:p(m.data)}).data};var $,W,X={};function b(m,y,k,I){for(var z=m[y++],P=1<<z,N=P+1,O=N+1,U=z+1,B=(1<<U)-1,M=0,j=0,G=0,H=m[y++],V=new Int32Array(4096),q=null;;){for(;M<16&&0!==H;)j|=m[y++]<<M,M+=8,1===H?H=m[y++]:--H;if(M<U)break;var Z=j&B;if(j>>=U,M-=U,Z!==P){if(Z===N)break;for(var $=Z<O?Z:q,W=0,X=$;X>P;)X=V[X]>>8,++W;var J=X;if(G+W+($!==Z?1:0)>I)return void console.log("Warning, gif stream longer than expected.");k[G++]=J;var Y=G+=W;for($!==Z&&(k[G++]=J),X=$;W--;)X=V[X],k[--Y]=255&X,X>>=8;null!==q&&O<4096&&(V[O++]=q<<8|J,O>=B+1&&U<12&&(++U,B=B<<1|1)),q=Z}else O=N+1,B=(1<<(U=z+1))-1,q=null}return G!==I&&console.log("Warning, gif stream shorter than expected."),k}try{W=X.GifWriter=function(m,y,k,I){var z=0,P=void 0===(I=void 0===I?{}:I).loop?null:I.loop,N=void 0===I.palette?null:I.palette;if(y<=0||k<=0||y>65535||k>65535)throw new Error("Width/Height invalid.");function o(m){var y=m.length;if(y<2||y>256||y&y-1)throw new Error("Invalid code/color length, must be power of 2 and 2 .. 256.");return y}m[z++]=71,m[z++]=73,m[z++]=70,m[z++]=56,m[z++]=57,m[z++]=97;var O=0,U=0;if(null!==N){for(var B=o(N);B>>=1;)++O;if(B=1<<O,--O,void 0!==I.background){if((U=I.background)>=B)throw new Error("Background index out of range.");if(0===U)throw new Error("Background index explicitly passed as 0.")}}if(m[z++]=255&y,m[z++]=y>>8&255,m[z++]=255&k,m[z++]=k>>8&255,m[z++]=(null!==N?128:0)|O,m[z++]=U,m[z++]=0,null!==N)for(var M=0,j=N.length;M<j;++M){var G=N[M];m[z++]=G>>16&255,m[z++]=G>>8&255,m[z++]=255&G}if(null!==P){if(P<0||P>65535)throw new Error("Loop count invalid.");m[z++]=33,m[z++]=255,m[z++]=11,m[z++]=78,m[z++]=69,m[z++]=84,m[z++]=83,m[z++]=67,m[z++]=65,m[z++]=80,m[z++]=69,m[z++]=50,m[z++]=46,m[z++]=48,m[z++]=3,m[z++]=1,m[z++]=255&P,m[z++]=P>>8&255,m[z++]=0}var H=!1;this.addFrame=function(y,k,I,P,O,U){if(!0===H&&(--z,H=!1),U=void 0===U?{}:U,y<0||k<0||y>65535||k>65535)throw new Error("x/y invalid.");if(I<=0||P<=0||I>65535||P>65535)throw new Error("Width/Height invalid.");if(O.length<I*P)throw new Error("Not enough pixels for the frame size.");var B=!0,M=U.palette;if(null==M&&(B=!1,M=N),null==M)throw new Error("Must supply either a local or global palette.");for(var j=o(M),G=0;j>>=1;)++G;j=1<<G;var V=void 0===U.delay?0:U.delay,q=void 0===U.disposal?0:U.disposal;if(q<0||q>3)throw new Error("Disposal out of range.");var Z=!1,$=0;if(void 0!==U.transparent&&null!==U.transparent&&(Z=!0,($=U.transparent)<0||$>=j))throw new Error("Transparent color index.");if((0!==q||Z||0!==V)&&(m[z++]=33,m[z++]=249,m[z++]=4,m[z++]=q<<2|(!0===Z?1:0),m[z++]=255&V,m[z++]=V>>8&255,m[z++]=$,m[z++]=0),m[z++]=44,m[z++]=255&y,m[z++]=y>>8&255,m[z++]=255&k,m[z++]=k>>8&255,m[z++]=255&I,m[z++]=I>>8&255,m[z++]=255&P,m[z++]=P>>8&255,m[z++]=!0===B?128|G-1:0,!0===B)for(var W=0,X=M.length;W<X;++W){var J=M[W];m[z++]=J>>16&255,m[z++]=J>>8&255,m[z++]=255&J}return z=function(m,y,k,I){m[y++]=k;var z=y++,P=1<<k,N=P-1,O=P+1,U=O+1,B=k+1,M=0,j=0;function u(k){for(;M>=k;)m[y++]=255&j,j>>=8,M-=8,y===z+256&&(m[z]=255,z=y++)}function c(m){j|=m<<M,M+=B,u(8)}var G=I[0]&N,H={};c(P);for(var V=1,q=I.length;V<q;++V){var Z=I[V]&N,$=G<<8|Z,W=H[$];if(void 0===W){for(j|=G<<M,M+=B;M>=8;)m[y++]=255&j,j>>=8,M-=8,y===z+256&&(m[z]=255,z=y++);4096===U?(c(P),U=O+1,B=k+1,H={}):(U>=1<<B&&++B,H[$]=U++),G=Z}else G=W}return c(G),c(O),u(1),z+1===y?m[z]=0:(m[z]=y-z-1,m[y++]=0),y}(m,z,G<2?2:G,O),z},this.end=function(){return!1===H&&(m[z++]=59,H=!0),z},this.getOutputBuffer=function(){return m},this.setOutputBuffer=function(y){m=y},this.getOutputBufferPosition=function(){return z},this.setOutputBufferPosition=function(m){z=m}},$=X.GifReader=function(m){var y=0;if(71!==m[y++]||73!==m[y++]||70!==m[y++]||56!==m[y++]||56!=(m[y++]+1&253)||97!==m[y++])throw new Error("Invalid GIF 87a/89a header.");var k=m[y++]|m[y++]<<8,I=m[y++]|m[y++]<<8,z=m[y++],P=z>>7,N=1<<1+(7&z);m[y++],m[y++];var O=null,U=null;P&&(O=y,U=N,y+=3*N);var B=!0,M=[],j=0,G=null,H=0,V=null;for(this.width=k,this.height=I;B&&y<m.length;)switch(m[y++]){case 33:switch(m[y++]){case 255:if(11!==m[y]||78==m[y+1]&&69==m[y+2]&&84==m[y+3]&&83==m[y+4]&&67==m[y+5]&&65==m[y+6]&&80==m[y+7]&&69==m[y+8]&&50==m[y+9]&&46==m[y+10]&&48==m[y+11]&&3==m[y+12]&&1==m[y+13]&&0==m[y+16])y+=14,V=m[y++]|m[y++]<<8,y++;else for(y+=12;;){if(!((yt=m[y++])>=0))throw Error("Invalid block size");if(0===yt)break;y+=yt}break;case 249:if(4!==m[y++]||0!==m[y+4])throw new Error("Invalid graphics extension block.");var q=m[y++];j=m[y++]|m[y++]<<8,G=m[y++],0==(1&q)&&(G=null),H=q>>2&7,y++;break;case 254:for(;;){if(!((yt=m[y++])>=0))throw Error("Invalid block size");if(0===yt)break;y+=yt}break;default:throw new Error("Unknown graphic control label: 0x"+m[y-1].toString(16))}break;case 44:var Z=m[y++]|m[y++]<<8,$=m[y++]|m[y++]<<8,W=m[y++]|m[y++]<<8,X=m[y++]|m[y++]<<8,J=m[y++],Y=J>>6&1,K=1<<1+(7&J),Q=O,tt=U,et=!1;J>>7&&(et=!0,Q=y,tt=K,y+=3*K);var vt=y;for(y++;;){var yt;if(!((yt=m[y++])>=0))throw Error("Invalid block size");if(0===yt)break;y+=yt}M.push({x:Z,y:$,width:W,height:X,has_local_palette:et,palette_offset:Q,palette_size:tt,data_offset:vt,data_length:y-vt,transparent_index:G,interlaced:!!Y,delay:j,disposal:H});break;case 59:B=!1;break;default:throw new Error("Unknown gif block: 0x"+m[y-1].toString(16))}this.numFrames=function(){return M.length},this.loopCount=function(){return V},this.frameInfo=function(m){if(m<0||m>=M.length)throw new Error("Frame index out of range.");return M[m]},this.decodeAndBlitFrameBGRA=function(y,I){var z=this.frameInfo(y),P=z.width*z.height,N=new Uint8Array(P);b(m,z.data_offset,N,P);var O=z.palette_offset,U=z.transparent_index;null===U&&(U=256);var B=z.width,M=k-B,j=B,G=4*(z.y*k+z.x),H=4*((z.y+z.height)*k+z.x),V=G,q=4*M;!0===z.interlaced&&(q+=4*k*7);for(var Z=8,$=0,W=N.length;$<W;++$){var X=N[$];if(0===j&&(j=B,(V+=q)>=H&&(q=4*M+4*k*(Z-1),V=G+(B+M)*(Z<<1),Z>>=1)),X===U)V+=4;else{var J=m[O+3*X],Y=m[O+3*X+1],K=m[O+3*X+2];I[V++]=K,I[V++]=Y,I[V++]=J,I[V++]=255}--j}},this.decodeAndBlitFrameRGBA=function(y,I){var z=this.frameInfo(y),P=z.width*z.height,N=new Uint8Array(P);b(m,z.data_offset,N,P);var O=z.palette_offset,U=z.transparent_index;null===U&&(U=256);var B=z.width,M=k-B,j=B,G=4*(z.y*k+z.x),H=4*((z.y+z.height)*k+z.x),V=G,q=4*M;!0===z.interlaced&&(q+=4*k*7);for(var Z=8,$=0,W=N.length;$<W;++$){var X=N[$];if(0===j&&(j=B,(V+=q)>=H&&(q=4*M+4*k*(Z-1),V=G+(B+M)*(Z<<1),Z>>=1)),X===U)V+=4;else{var J=m[O+3*X],Y=m[O+3*X+1],K=m[O+3*X+2];I[V++]=J,I[V++]=Y,I[V++]=K,I[V++]=255}--j}}}}catch(B){}var J={exports:{}};if(!Y)var Y={map:function(m,y){var k={};return y?m.map((function(m,I){return k.index=I,y.call(k,m)})):m.slice()},naturalOrder:function(m,y){return m<y?-1:m>y?1:0},sum:function(m,y){var k={};return m.reduce(y?function(m,I,z){return k.index=z,m+y.call(k,I)}:function(m,y){return m+y},0)},max:function(m,y){return Math.max.apply(null,y?Y.map(m,y):m)}};var K=function(){function t(m,y,k){return(m<<10)+(y<<5)+k}function e(m){var y=[],k=!1;function i(){y.sort(m),k=!0}return{push:function(m){y.push(m),k=!1},peek:function(m){return k||i(),void 0===m&&(m=y.length-1),y[m]},pop:function(){return k||i(),y.pop()},size:function(){return y.length},map:function(m){return y.map(m)},debug:function(){return k||i(),y}}}function r(m,y,k,I,z,P,N){var O=this;O.r1=m,O.r2=y,O.g1=k,O.g2=I,O.b1=z,O.b2=P,O.histo=N}function i(){this.vboxes=new e((function(m,y){return Y.naturalOrder(m.vbox.count()*m.vbox.volume(),y.vbox.count()*y.vbox.volume())}))}function n(m,y){if(y.count()){var k=y.r2-y.r1+1,I=y.g2-y.g1+1,z=y.b2-y.b1+1,P=Y.max([k,I,z]);if(1==y.count())return[y.copy()];var N,O,U,B,M=0,j=[],G=[];if(P==k)for(N=y.r1;N<=y.r2;N++){for(B=0,O=y.g1;O<=y.g2;O++)for(U=y.b1;U<=y.b2;U++)B+=m[t(N,O,U)]||0;M+=B,j[N]=M}else if(P==I)for(N=y.g1;N<=y.g2;N++){for(B=0,O=y.r1;O<=y.r2;O++)for(U=y.b1;U<=y.b2;U++)B+=m[t(O,N,U)]||0;M+=B,j[N]=M}else for(N=y.b1;N<=y.b2;N++){for(B=0,O=y.r1;O<=y.r2;O++)for(U=y.g1;U<=y.g2;U++)B+=m[t(O,U,N)]||0;M+=B,j[N]=M}return j.forEach((function(m,y){G[y]=M-m})),function p(m){var k,I,z,P,O,U=m+"1",B=m+"2",H=0;for(N=y[U];N<=y[B];N++)if(j[N]>M/2){for(z=y.copy(),P=y.copy(),O=(k=N-y[U])<=(I=y[B]-N)?Math.min(y[B]-1,~~(N+I/2)):Math.max(y[U],~~(N-1-k/2));!j[O];)O++;for(H=G[O];!H&&j[O-1];)H=G[--O];return z[B]=O,P[U]=z[B]+1,[z,P]}}(P==k?"r":P==I?"g":"b")}}return r.prototype={volume:function(m){var y=this;return y._volume&&!m||(y._volume=(y.r2-y.r1+1)*(y.g2-y.g1+1)*(y.b2-y.b1+1)),y._volume},count:function(m){var y=this,k=y.histo;if(!y._count_set||m){var I,z,P,N=0;for(I=y.r1;I<=y.r2;I++)for(z=y.g1;z<=y.g2;z++)for(P=y.b1;P<=y.b2;P++)N+=k[t(I,z,P)]||0;y._count=N,y._count_set=!0}return y._count},copy:function(){var m=this;return new r(m.r1,m.r2,m.g1,m.g2,m.b1,m.b2,m.histo)},avg:function(m){var y=this,k=y.histo;if(!y._avg||m){var I,z,P,N,O=0,U=0,B=0,M=0;for(z=y.r1;z<=y.r2;z++)for(P=y.g1;P<=y.g2;P++)for(N=y.b1;N<=y.b2;N++)O+=I=k[t(z,P,N)]||0,U+=I*(z+.5)*8,B+=I*(P+.5)*8,M+=I*(N+.5)*8;y._avg=O?[~~(U/O),~~(B/O),~~(M/O)]:[~~(8*(y.r1+y.r2+1)/2),~~(8*(y.g1+y.g2+1)/2),~~(8*(y.b1+y.b2+1)/2)]}return y._avg},contains:function(m){var y=this,k=m[0]>>3;return gval=m[1]>>3,bval=m[2]>>3,k>=y.r1&&k<=y.r2&&gval>=y.g1&&gval<=y.g2&&bval>=y.b1&&bval<=y.b2}},i.prototype={push:function(m){this.vboxes.push({vbox:m,color:m.avg()})},palette:function(){return this.vboxes.map((function(m){return m.color}))},size:function(){return this.vboxes.size()},map:function(m){for(var y=this.vboxes,k=0;k<y.size();k++)if(y.peek(k).vbox.contains(m))return y.peek(k).color;return this.nearest(m)},nearest:function(m){for(var y,k,I,z=this.vboxes,P=0;P<z.size();P++)((k=Math.sqrt(Math.pow(m[0]-z.peek(P).color[0],2)+Math.pow(m[1]-z.peek(P).color[1],2)+Math.pow(m[2]-z.peek(P).color[2],2)))<y||void 0===y)&&(y=k,I=z.peek(P).color);return I},forcebw:function(){var m=this.vboxes;m.sort((function(m,y){return Y.naturalOrder(Y.sum(m.color),Y.sum(y.color))}));var y=m[0].color;y[0]<5&&y[1]<5&&y[2]<5&&(m[0].color=[0,0,0]);var k=m.length-1,I=m[k].color;I[0]>251&&I[1]>251&&I[2]>251&&(m[k].color=[255,255,255])}},{quantize:function(m,y){if(!m.length||y<2||y>256)return!1;var k=function(m){var y,k,I,z,P=new Array(32768);return m.forEach((function(m){k=m[0]>>3,I=m[1]>>3,z=m[2]>>3,y=t(k,I,z),P[y]=(P[y]||0)+1})),P}(m);k.forEach((function(){}));var I=function(m,y){var k,I,z,P=1e6,N=0,O=1e6,U=0,B=1e6,M=0;return m.forEach((function(m){k=m[0]>>3,I=m[1]>>3,z=m[2]>>3,k<P?P=k:k>N&&(N=k),I<O?O=I:I>U&&(U=I),z<B?B=z:z>M&&(M=z)})),new r(P,N,O,U,B,M,y)}(m,k),z=new e((function(m,y){return Y.naturalOrder(m.count(),y.count())}));function l(m,y){for(var I,z=1,P=0;P<1e3;)if((I=m.pop()).count()){var N=n(k,I),O=N[0],U=N[1];if(!O)return;if(m.push(O),U&&(m.push(U),z++),z>=y)return;if(P++>1e3)return}else m.push(I),P++}z.push(I),l(z,.75*y);for(var P=new e((function(m,y){return Y.naturalOrder(m.count()*m.volume(),y.count()*y.volume())}));z.size();)P.push(z.pop());l(P,y-P.size());for(var N=new i;P.size();)N.push(P.pop());return N}}}(),Q=K.quantize;function x(m,y){return m[y+3]>=127}function E(m,y,k,I){if(y="number"==typeof y?0|y:5,I="function"==typeof I?I:x,(k="number"==typeof k?0|k:10)<=0)throw new Error("quality must be > 0");for(var z=[],P=4*k,N=0,O=m.length;N<O;N+=P){var U=m[N+0],B=m[N+1],M=m[N+2];I(m,N,m)&&z.push([U,B,M])}var j=Q(z,Math.max(2,y)).vboxes;return j?j.map((function(m){return m})).slice(0,y):[]}J.exports=function(m,y,k,I){return E(m,y,k,I).map((function(m){return m.color}))},J.exports.bins=function(m,y,k,I){var z=E(m,y,k,I),P=(z=z.map((function(m){return{color:m.color,size:m.vbox.count()*m.vbox.volume(),amount:0}}))).reduce((function(m,y){return m+y.size}),0);return z.forEach((function(m){m.amount=m.size/P})),z};var tt=J.exports;const et={decode(m){const y=new $(m),k={width:y.width,height:y.height,data:new Uint8Array(y.width*y.height*4)};return y.decodeAndBlitFrameRGBA(0,k.data),k},encode(m,y){const k=[m.data],I=new Uint8Array(m.width*m.height*k.length+1024),z=new W(I,m.width,m.height,{loop:y.loop});return k.forEach((k=>{const I=((m,y)=>{const k=Math.pow(2,Math.ceil(Math.log(y)/Math.log(2)));let I=tt(m,y).map((m=>[m[0],m[1],m[2],255]));if(0===I.length&&(I=tt(m,y,10,(()=>!0)).map((m=>[m[0],m[1],m[2],255]))),I.length<k){const m=I.length>0?I[I.length-1]:[0,0,0,0],y=I.length;I.length=k,I.fill(m,y,k)}I[I.length-1]=[0,0,0,0];for(let m=0;m<I.length;m+=1)for(let y=0;y<4;y+=1){const k=I[m][y];null==k||Number.isNaN(k)||k<0?I[m][y]=0:k>255&&(I[m][y]=255)}return I})(k,16),P=((m,y)=>{const k=new Array(m.length/4),I=new Map;y.forEach(((m,y)=>I.set(m,y)));for(let z=0;z<m.length;z+=4){const P=[m[z],m[z+1],m[z+2],m[z+3]];if(I.has(P))k[z/4]=I.get(P);else{let m=1e3,N=0;y.map(((y,k)=>{const I=Math.sqrt(Math.pow(P[0]-y[0],2)+Math.pow(P[1]-y[1],2)+Math.pow(P[2]-y[2],2)+Math.pow(P[3]-y[3],2));I<m&&(m=I,N=k)})),I.set(P,N),k[z/4]=N}}return k})(k,I);z.addFrame(0,0,m.width,m.height,P,{palette:I.map((([m,y,k])=>((m,y,k)=>(m<<16)+(y<<8)+k)(m,y,k))),delay:y.delay,transparent:I.length-1,disposal:2})})),I.slice(0,z.end())}};var vt={exports:{}};!function(m){function e(m){var y,k,I,z,P,N=Math.floor,O=new Array(64),U=new Array(64),B=new Array(64),M=new Array(64),j=new Array(65535),G=new Array(65535),H=new Array(64),V=new Array(64),q=[],Z=0,$=7,W=new Array(64),X=new Array(64),J=new Array(64),Y=new Array(256),K=new Array(2048),Q=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],tt=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],et=[0,1,2,3,4,5,6,7,8,9,10,11],vt=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],yt=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],xt=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],kt=[0,1,2,3,4,5,6,7,8,9,10,11],Et=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],It=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function R(m,y){for(var k=0,I=0,z=new Array,P=1;P<=16;P++){for(var N=1;N<=m[P];N++)z[y[I]]=[],z[y[I]][0]=k,z[y[I]][1]=P,I++,k++;k*=2}return z}function S(m){for(var y=m[0],k=m[1]-1;k>=0;)y&1<<k&&(Z|=1<<$),k--,--$<0&&(255==Z?(T(255),T(0)):T(Z),$=7,Z=0)}function T(m){q.push(m)}function C(m){T(m>>8&255),T(255&m)}function L(m,y,k,I,z){for(var P,N=z[0],O=z[240],U=function(m,y){var k,I,z,P,N,O,U,B,M,j,G=0;for(M=0;M<8;++M){k=m[G],I=m[G+1],z=m[G+2],P=m[G+3],N=m[G+4],O=m[G+5],U=m[G+6];var V=k+(B=m[G+7]),q=k-B,Z=I+U,$=I-U,W=z+O,X=z-O,J=P+N,Y=P-N,K=V+J,Q=V-J,tt=Z+W,et=Z-W;m[G]=K+tt,m[G+4]=K-tt;var vt=.707106781*(et+Q);m[G+2]=Q+vt,m[G+6]=Q-vt;var yt=.382683433*((K=Y+X)-(et=$+q)),xt=.5411961*K+yt,kt=1.306562965*et+yt,Et=.707106781*(tt=X+$),It=q+Et,zt=q-Et;m[G+5]=zt+xt,m[G+3]=zt-xt,m[G+1]=It+kt,m[G+7]=It-kt,G+=8}for(G=0,M=0;M<8;++M){k=m[G],I=m[G+8],z=m[G+16],P=m[G+24],N=m[G+32],O=m[G+40],U=m[G+48];var Ut=k+(B=m[G+56]),Bt=k-B,jt=I+U,Wt=I-U,Xt=z+O,Jt=z-O,Yt=P+N,Kt=P-N,te=Ut+Yt,ee=Ut-Yt,re=jt+Xt,ie=jt-Xt;m[G]=te+re,m[G+32]=te-re;var ne=.707106781*(ie+ee);m[G+16]=ee+ne,m[G+48]=ee-ne;var ae=.382683433*((te=Kt+Jt)-(ie=Wt+Bt)),he=.5411961*te+ae,le=1.306562965*ie+ae,fe=.707106781*(re=Jt+Wt),ce=Bt+fe,de=Bt-fe;m[G+40]=de+he,m[G+24]=de-he,m[G+8]=ce+le,m[G+56]=ce-le,G++}for(M=0;M<64;++M)j=m[M]*y[M],H[M]=j>0?j+.5|0:j-.5|0;return H}(m,y),B=0;B<64;++B)V[Q[B]]=U[B];var M=V[0]-k;k=V[0],0==M?S(I[0]):(S(I[G[P=32767+M]]),S(j[P]));for(var q=63;q>0&&0==V[q];q--);if(0==q)return S(N),k;for(var Z,$=1;$<=q;){for(var W=$;0==V[$]&&$<=q;++$);var X=$-W;if(X>=16){Z=X>>4;for(var J=1;J<=Z;++J)S(O);X&=15}P=32767+V[$],S(z[(X<<4)+G[P]]),S(j[P]),$++}return 63!=q&&S(N),k}function D(m){m<=0&&(m=1),m>100&&(m=100),P!=m&&(function(m){for(var y=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],k=0;k<64;k++){var I=N((y[k]*m+50)/100);I<1?I=1:I>255&&(I=255),O[Q[k]]=I}for(var z=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],P=0;P<64;P++){var j=N((z[P]*m+50)/100);j<1?j=1:j>255&&(j=255),U[Q[P]]=j}for(var G=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],H=0,V=0;V<8;V++)for(var q=0;q<8;q++)B[H]=1/(O[Q[H]]*G[V]*G[q]*8),M[H]=1/(U[Q[H]]*G[V]*G[q]*8),H++}(m<50?Math.floor(5e3/m):Math.floor(200-2*m)),P=m)}this.encode=function(m,P){var N;(new Date).getTime(),P&&D(P),q=new Array,Z=0,$=7,C(65496),C(65504),C(16),T(74),T(70),T(73),T(70),T(0),T(1),T(1),T(0),C(1),C(1),T(0),T(0),void 0!==(N=m.comments)&&N.constructor===Array&&N.forEach((m=>{if("string"==typeof m){C(65534);var y,k=m.length;for(C(k+2),y=0;y<k;y++)T(m.charCodeAt(y))}})),function(m){if(m){C(65505),69===m[0]&&120===m[1]&&105===m[2]&&102===m[3]?C(m.length+2):(C(m.length+5+2),T(69),T(120),T(105),T(102),T(0));for(var y=0;y<m.length;y++)T(m[y])}}(m.exifBuffer),function(){C(65499),C(132),T(0);for(var m=0;m<64;m++)T(O[m]);T(1);for(var y=0;y<64;y++)T(U[y])}(),function(m,y){C(65472),C(17),T(8),C(y),C(m),T(3),T(1),T(17),T(0),T(2),T(17),T(1),T(3),T(17),T(1)}(m.width,m.height),function(){C(65476),C(418),T(0);for(var m=0;m<16;m++)T(tt[m+1]);for(var y=0;y<=11;y++)T(et[y]);T(16);for(var k=0;k<16;k++)T(vt[k+1]);for(var I=0;I<=161;I++)T(yt[I]);T(1);for(var z=0;z<16;z++)T(xt[z+1]);for(var P=0;P<=11;P++)T(kt[P]);T(17);for(var N=0;N<16;N++)T(Et[N+1]);for(var O=0;O<=161;O++)T(It[O])}(),C(65498),C(12),T(3),T(1),T(0),T(2),T(17),T(3),T(17),T(0),T(63),T(0);var j=0,G=0,H=0;Z=0,$=7,this.encode.displayName="_encode_";for(var V,Y,Q,zt,Ut,Bt,jt,Wt,Xt,Jt=m.data,Yt=m.width,Kt=m.height,te=4*Yt,ee=0;ee<Kt;){for(V=0;V<te;){for(Bt=Ut=te*ee+V,jt=-1,Wt=0,Xt=0;Xt<64;Xt++)Bt=Ut+(Wt=Xt>>3)*te+(jt=4*(7&Xt)),ee+Wt>=Kt&&(Bt-=te*(ee+1+Wt-Kt)),V+jt>=te&&(Bt-=V+jt-te+4),Y=Jt[Bt++],Q=Jt[Bt++],zt=Jt[Bt++],W[Xt]=(K[Y]+K[Q+256>>0]+K[zt+512>>0]>>16)-128,X[Xt]=(K[Y+768>>0]+K[Q+1024>>0]+K[zt+1280>>0]>>16)-128,J[Xt]=(K[Y+1280>>0]+K[Q+1536>>0]+K[zt+1792>>0]>>16)-128;j=L(W,B,j,y,I),G=L(X,M,G,k,z),H=L(J,M,H,k,z),V+=32}ee+=8}if($>=0){var re=[];re[1]=$+1,re[0]=(1<<$+1)-1,S(re)}return C(65497),new Uint8Array(q)},(new Date).getTime(),m||(m=50),function(){for(var m=String.fromCharCode,y=0;y<256;y++)Y[y]=m(y)}(),y=R(tt,et),k=R(xt,kt),I=R(vt,yt),z=R(Et,It),function(){for(var m=1,y=2,k=1;k<=15;k++){for(var I=m;I<y;I++)G[32767+I]=k,j[32767+I]=[],j[32767+I][1]=k,j[32767+I][0]=I;for(var z=-(y-1);z<=-m;z++)G[32767+z]=k,j[32767+z]=[],j[32767+z][1]=k,j[32767+z][0]=y-1+z;m<<=1,y<<=1}}(),function(){for(var m=0;m<256;m++)K[m]=19595*m,K[m+256>>0]=38470*m,K[m+512>>0]=7471*m+32768,K[m+768>>0]=-11059*m,K[m+1024>>0]=-21709*m,K[m+1280>>0]=32768*m+8421375,K[m+1536>>0]=-27439*m,K[m+1792>>0]=-5329*m}(),D(m),(new Date).getTime()}vt.exports=function(m,y){return void 0===y&&(y=50),{data:new e(y).encode(m,y),width:m.width,height:m.height}}}();var yt,xt,kt={exports:{}};yt=kt,xt=function(){var m=new Int32Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),y=4017,k=799,I=3406,z=2276,P=1567,N=3784,O=5793,U=2896;function f(){}function l(m,y){for(var k,I,z=0,P=[],N=16;N>0&&!m[N-1];)N--;P.push({children:[],index:0});var O,U=P[0];for(k=0;k<N;k++){for(I=0;I<m[k];I++){for((U=P.pop()).children[U.index]=y[z];U.index>0;){if(0===P.length)throw new Error("Could not recreate Huffman Table");U=P.pop()}for(U.index++,P.push(U);P.length<=k;)P.push(O={children:[],index:0}),U.children[U.index]=O.children,U=O;z++}k+1<N&&(P.push(O={children:[],index:0}),U.children[U.index]=O.children,U=O)}return P[0].children}function d(y,k,I,z,P,N,O,U,B,M){I.precision,I.samplesPerLine,I.scanLines;var j=I.mcusPerLine,G=I.progressive;I.maxH,I.maxV;var H=k,V=0,q=0;function w(){if(q>0)return q--,V>>q&1;if(255==(V=y[k++])){var m=y[k++];if(m)throw new Error("unexpected marker: "+(V<<8|m).toString(16))}return q=7,V>>>7}function _(m){for(var y,k=m;null!==(y=w());){if("number"==typeof(k=k[y]))return k;if("object"!=typeof k)throw new Error("invalid huffman sequence")}return null}function v(m){for(var y=0;m>0;){var k=w();if(null===k)return;y=y<<1|k,m--}return y}function b(m){var y=v(m);return y>=1<<m-1?y:y+(-1<<m)+1}var Z,$=0,W=0;function A(m,y,k,I,z){var P=k%j,N=(k/j|0)*m.v+I,O=P*m.h+z;void 0===m.blocks[N]&&M.tolerantDecoding||y(m,m.blocks[N][O])}function x(m,y,k){var I=k/m.blocksPerLine|0,z=k%m.blocksPerLine;void 0===m.blocks[I]&&M.tolerantDecoding||y(m,m.blocks[I][z])}var X,J,Y,K,Q,tt,et=z.length;tt=G?0===N?0===U?function(m,y){var k=_(m.huffmanTableDC),I=0===k?0:b(k)<<B;y[0]=m.pred+=I}:function(m,y){y[0]|=w()<<B}:0===U?function(y,k){if($>0)$--;else for(var I=N,z=O;I<=z;){var P=_(y.huffmanTableAC),U=15&P,M=P>>4;if(0!==U)k[m[I+=M]]=b(U)*(1<<B),I++;else{if(M<15){$=v(M)+(1<<M)-1;break}I+=16}}}:function(y,k){for(var I=N,z=O,P=0;I<=z;){var U=m[I],M=k[U]<0?-1:1;switch(W){case 0:var j=_(y.huffmanTableAC),G=15&j;if(P=j>>4,0===G)P<15?($=v(P)+(1<<P),W=4):(P=16,W=1);else{if(1!==G)throw new Error("invalid ACn encoding");Z=b(G),W=P?2:3}continue;case 1:case 2:k[U]?k[U]+=(w()<<B)*M:0==--P&&(W=2==W?3:0);break;case 3:k[U]?k[U]+=(w()<<B)*M:(k[U]=Z<<B,W=0);break;case 4:k[U]&&(k[U]+=(w()<<B)*M)}I++}4===W&&0==--$&&(W=0)}:function(y,k){var I=_(y.huffmanTableDC),z=0===I?0:b(I);k[0]=y.pred+=z;for(var P=1;P<64;){var N=_(y.huffmanTableAC),O=15&N,U=N>>4;if(0!==O)k[m[P+=U]]=b(O),P++;else{if(U<15)break;P+=16}}};var vt,yt,xt,kt,Et=0;for(yt=1==et?z[0].blocksPerLine*z[0].blocksPerColumn:j*I.mcusPerColumn,P||(P=yt);Et<yt;){for(J=0;J<et;J++)z[J].pred=0;if($=0,1==et)for(X=z[0],Q=0;Q<P;Q++)x(X,tt,Et),Et++;else for(Q=0;Q<P;Q++){for(J=0;J<et;J++)for(xt=(X=z[J]).h,kt=X.v,Y=0;Y<kt;Y++)for(K=0;K<xt;K++)A(X,tt,Et,Y,K);if(++Et===yt)break}if(Et===yt)do{if(255===y[k]&&0!==y[k+1])break;k+=1}while(k<y.length-2);if(q=0,(vt=y[k]<<8|y[k+1])<65280)throw new Error("marker was not found");if(!(vt>=65488&&vt<=65495))break;k+=2}return k-H}function u(m,B){var M,j,G=[],H=B.blocksPerLine,V=B.blocksPerColumn,q=H<<3,Z=new Int32Array(64),$=new Uint8Array(64);function b(m,M,j){var G,H,V,q,Z,$,W,X,J,Y,K=B.quantizationTable,Q=j;for(Y=0;Y<64;Y++)Q[Y]=m[Y]*K[Y];for(Y=0;Y<8;++Y){var tt=8*Y;0!=Q[1+tt]||0!=Q[2+tt]||0!=Q[3+tt]||0!=Q[4+tt]||0!=Q[5+tt]||0!=Q[6+tt]||0!=Q[7+tt]?(G=O*Q[0+tt]+128>>8,H=O*Q[4+tt]+128>>8,V=Q[2+tt],q=Q[6+tt],Z=U*(Q[1+tt]-Q[7+tt])+128>>8,X=U*(Q[1+tt]+Q[7+tt])+128>>8,$=Q[3+tt]<<4,W=Q[5+tt]<<4,J=G-H+1>>1,G=G+H+1>>1,H=J,J=V*N+q*P+128>>8,V=V*P-q*N+128>>8,q=J,J=Z-W+1>>1,Z=Z+W+1>>1,W=J,J=X+$+1>>1,$=X-$+1>>1,X=J,J=G-q+1>>1,G=G+q+1>>1,q=J,J=H-V+1>>1,H=H+V+1>>1,V=J,J=Z*z+X*I+2048>>12,Z=Z*I-X*z+2048>>12,X=J,J=$*k+W*y+2048>>12,$=$*y-W*k+2048>>12,W=J,Q[0+tt]=G+X,Q[7+tt]=G-X,Q[1+tt]=H+W,Q[6+tt]=H-W,Q[2+tt]=V+$,Q[5+tt]=V-$,Q[3+tt]=q+Z,Q[4+tt]=q-Z):(J=O*Q[0+tt]+512>>10,Q[0+tt]=J,Q[1+tt]=J,Q[2+tt]=J,Q[3+tt]=J,Q[4+tt]=J,Q[5+tt]=J,Q[6+tt]=J,Q[7+tt]=J)}for(Y=0;Y<8;++Y){var et=Y;0!=Q[8+et]||0!=Q[16+et]||0!=Q[24+et]||0!=Q[32+et]||0!=Q[40+et]||0!=Q[48+et]||0!=Q[56+et]?(G=O*Q[0+et]+2048>>12,H=O*Q[32+et]+2048>>12,V=Q[16+et],q=Q[48+et],Z=U*(Q[8+et]-Q[56+et])+2048>>12,X=U*(Q[8+et]+Q[56+et])+2048>>12,$=Q[24+et],W=Q[40+et],J=G-H+1>>1,G=G+H+1>>1,H=J,J=V*N+q*P+2048>>12,V=V*P-q*N+2048>>12,q=J,J=Z-W+1>>1,Z=Z+W+1>>1,W=J,J=X+$+1>>1,$=X-$+1>>1,X=J,J=G-q+1>>1,G=G+q+1>>1,q=J,J=H-V+1>>1,H=H+V+1>>1,V=J,J=Z*z+X*I+2048>>12,Z=Z*I-X*z+2048>>12,X=J,J=$*k+W*y+2048>>12,$=$*y-W*k+2048>>12,W=J,Q[0+et]=G+X,Q[56+et]=G-X,Q[8+et]=H+W,Q[48+et]=H-W,Q[16+et]=V+$,Q[40+et]=V-$,Q[24+et]=q+Z,Q[32+et]=q-Z):(J=O*j[Y+0]+8192>>14,Q[0+et]=J,Q[8+et]=J,Q[16+et]=J,Q[24+et]=J,Q[32+et]=J,Q[40+et]=J,Q[48+et]=J,Q[56+et]=J)}for(Y=0;Y<64;++Y){var vt=128+(Q[Y]+8>>4);M[Y]=vt<0?0:vt>255?255:vt}}w(q*V*8);for(var W=0;W<V;W++){var X=W<<3;for(M=0;M<8;M++)G.push(new Uint8Array(q));for(var J=0;J<H;J++){b(B.blocks[W][J],$,Z);var Y=0,K=J<<3;for(j=0;j<8;j++){var Q=G[X+j];for(M=0;M<8;M++)Q[K+M]=$[Y++]}}}return G}function c(m){return m<0?0:m>255?255:m}f.prototype={load:function(m){var y=new XMLHttpRequest;y.open("GET",m,!0),y.responseType="arraybuffer",y.onload=function(){var m=new Uint8Array(y.response||y.mozResponseArrayBuffer);this.parse(m),this.onload&&this.onload()}.bind(this),y.send(null)},parse:function(y){var k=1e3*this.opts.maxResolutionInMP*1e3,I=0;function n(){var m=y[I]<<8|y[I+1];return I+=2,m}function a(m){var y,k,I=1,z=1;for(k in m.components)m.components.hasOwnProperty(k)&&(I<(y=m.components[k]).h&&(I=y.h),z<y.v&&(z=y.v));var P=Math.ceil(m.samplesPerLine/8/I),N=Math.ceil(m.scanLines/8/z);for(k in m.components)if(m.components.hasOwnProperty(k)){y=m.components[k];var O=Math.ceil(Math.ceil(m.samplesPerLine/8)*y.h/I),U=Math.ceil(Math.ceil(m.scanLines/8)*y.v/z),B=P*y.h,M=N*y.v,j=[];w(M*B*256);for(var G=0;G<M;G++){for(var H=[],V=0;V<B;V++)H.push(new Int32Array(64));j.push(H)}y.blocksPerLine=O,y.blocksPerColumn=U,y.blocks=j}m.maxH=I,m.maxV=z,m.mcusPerLine=P,m.mcusPerColumn=N}y.length;var z,P,N,O,U=null,B=null,M=[],j=[],G=[],H=[],V=n(),q=-1;if(this.comments=[],65496!=V)throw new Error("SOI not found");for(V=n();65497!=V;){switch(V){case 65280:break;case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var Z=(void 0,void 0,N=n(),O=y.subarray(I,I+N-2),I+=O.length,O);if(65534===V){var $=String.fromCharCode.apply(null,Z);this.comments.push($)}65504===V&&74===Z[0]&&70===Z[1]&&73===Z[2]&&70===Z[3]&&0===Z[4]&&(U={version:{major:Z[5],minor:Z[6]},densityUnits:Z[7],xDensity:Z[8]<<8|Z[9],yDensity:Z[10]<<8|Z[11],thumbWidth:Z[12],thumbHeight:Z[13],thumbData:Z.subarray(14,14+3*Z[12]*Z[13])}),65505===V&&69===Z[0]&&120===Z[1]&&105===Z[2]&&102===Z[3]&&0===Z[4]&&(this.exifBuffer=Z.subarray(5,Z.length)),65518===V&&65===Z[0]&&100===Z[1]&&111===Z[2]&&98===Z[3]&&101===Z[4]&&0===Z[5]&&(B={version:Z[6],flags0:Z[7]<<8|Z[8],flags1:Z[9]<<8|Z[10],transformCode:Z[11]});break;case 65499:for(var W=n()+I-2;I<W;){var X=y[I++];w(256);var J=new Int32Array(64);if(X>>4==0)for(ee=0;ee<64;ee++)J[m[ee]]=y[I++];else{if(X>>4!=1)throw new Error("DQT: invalid table spec");for(ee=0;ee<64;ee++)J[m[ee]]=n()}M[15&X]=J}break;case 65472:case 65473:case 65474:n(),(z={}).extended=65473===V,z.progressive=65474===V,z.precision=y[I++],z.scanLines=n(),z.samplesPerLine=n(),z.components={},z.componentsOrder=[];var Y=z.scanLines*z.samplesPerLine;if(Y>k){var K=Math.ceil((Y-k)/1e6);throw new Error(`maxResolutionInMP limit exceeded by ${K}MP`)}var Q,tt=y[I++];for(Kt=0;Kt<tt;Kt++){Q=y[I];var et=y[I+1]>>4,vt=15&y[I+1],yt=y[I+2];if(et<=0||vt<=0)throw new Error("Invalid sampling factor, expected values above 0");z.componentsOrder.push(Q),z.components[Q]={h:et,v:vt,quantizationIdx:yt},I+=3}a(z),j.push(z);break;case 65476:var xt=n();for(Kt=2;Kt<xt;){var kt=y[I++],Et=new Uint8Array(16),It=0;for(ee=0;ee<16;ee++,I++)It+=Et[ee]=y[I];w(16+It);var zt=new Uint8Array(It);for(ee=0;ee<It;ee++,I++)zt[ee]=y[I];Kt+=17+It,(kt>>4==0?H:G)[15&kt]=l(Et,zt)}break;case 65501:n(),P=n();break;case 65500:n(),n();break;case 65498:n();var Ut=y[I++],Bt=[];for(Kt=0;Kt<Ut;Kt++){re=z.components[y[I++]];var jt=y[I++];re.huffmanTableDC=H[jt>>4],re.huffmanTableAC=G[15&jt],Bt.push(re)}var Wt=y[I++],Xt=y[I++],Jt=y[I++],Yt=d(y,I,z,Bt,P,Wt,Xt,Jt>>4,15&Jt,this.opts);I+=Yt;break;case 65535:255!==y[I]&&I--;break;default:if(255==y[I-3]&&y[I-2]>=192&&y[I-2]<=254){I-=3;break}if(224===V||225==V){if(-1!==q)throw new Error(`first unknown JPEG marker at offset ${q.toString(16)}, second unknown JPEG marker ${V.toString(16)} at offset ${(I-1).toString(16)}`);q=I-1;const m=n();if(255===y[I+m-2]){I+=m-2;break}}throw new Error("unknown JPEG marker "+V.toString(16))}V=n()}if(1!=j.length)throw new Error("only single frame JPEGs supported");for(var Kt=0;Kt<j.length;Kt++){var te=j[Kt].components;for(var ee in te)te[ee].quantizationTable=M[te[ee].quantizationIdx],delete te[ee].quantizationIdx}for(this.width=z.samplesPerLine,this.height=z.scanLines,this.jfif=U,this.adobe=B,this.components=[],Kt=0;Kt<z.componentsOrder.length;Kt++){var re=z.components[z.componentsOrder[Kt]];this.components.push({lines:u(0,re),scaleX:re.h/z.maxH,scaleY:re.v/z.maxV})}},getData:function(m,y){var k,I,z,P,N,O,U,B,M,j,G,H,V,q,Z,$,W,X,J,Y,K,Q=this.width/m,tt=this.height/y,et=0,vt=m*y*this.components.length;w(vt);var yt=new Uint8Array(vt);switch(this.components.length){case 1:for(k=this.components[0],j=0;j<y;j++)for(N=k.lines[0|j*k.scaleY*tt],M=0;M<m;M++)G=N[0|M*k.scaleX*Q],yt[et++]=G;break;case 2:for(k=this.components[0],I=this.components[1],j=0;j<y;j++)for(N=k.lines[0|j*k.scaleY*tt],O=I.lines[0|j*I.scaleY*tt],M=0;M<m;M++)G=N[0|M*k.scaleX*Q],yt[et++]=G,G=O[0|M*I.scaleX*Q],yt[et++]=G;break;case 3:for(K=!0,this.adobe&&this.adobe.transformCode?K=!0:void 0!==this.opts.colorTransform&&(K=!!this.opts.colorTransform),k=this.components[0],I=this.components[1],z=this.components[2],j=0;j<y;j++)for(N=k.lines[0|j*k.scaleY*tt],O=I.lines[0|j*I.scaleY*tt],U=z.lines[0|j*z.scaleY*tt],M=0;M<m;M++)K?(G=N[0|M*k.scaleX*Q],H=O[0|M*I.scaleX*Q],X=c(G+1.402*((V=U[0|M*z.scaleX*Q])-128)),J=c(G-.3441363*(H-128)-.71413636*(V-128)),Y=c(G+1.772*(H-128))):(X=N[0|M*k.scaleX*Q],J=O[0|M*I.scaleX*Q],Y=U[0|M*z.scaleX*Q]),yt[et++]=X,yt[et++]=J,yt[et++]=Y;break;case 4:if(!this.adobe)throw new Error("Unsupported color mode (4 components)");for(K=!1,this.adobe&&this.adobe.transformCode?K=!0:void 0!==this.opts.colorTransform&&(K=!!this.opts.colorTransform),k=this.components[0],I=this.components[1],z=this.components[2],P=this.components[3],j=0;j<y;j++)for(N=k.lines[0|j*k.scaleY*tt],O=I.lines[0|j*I.scaleY*tt],U=z.lines[0|j*z.scaleY*tt],B=P.lines[0|j*P.scaleY*tt],M=0;M<m;M++)K?(G=N[0|M*k.scaleX*Q],H=O[0|M*I.scaleX*Q],V=U[0|M*z.scaleX*Q],q=B[0|M*P.scaleX*Q],Z=255-c(G+1.402*(V-128)),$=255-c(G-.3441363*(H-128)-.71413636*(V-128)),W=255-c(G+1.772*(H-128))):(Z=N[0|M*k.scaleX*Q],$=O[0|M*I.scaleX*Q],W=U[0|M*z.scaleX*Q],q=B[0|M*P.scaleX*Q]),yt[et++]=255-Z,yt[et++]=255-$,yt[et++]=255-W,yt[et++]=255-q;break;default:throw new Error("Unsupported color mode")}return yt},copyToImageData:function(m,y){var k,I,z,P,N,O,U,B,M,j=m.width,G=m.height,H=m.data,V=this.getData(j,G),q=0,Z=0;switch(this.components.length){case 1:for(I=0;I<G;I++)for(k=0;k<j;k++)z=V[q++],H[Z++]=z,H[Z++]=z,H[Z++]=z,y&&(H[Z++]=255);break;case 3:for(I=0;I<G;I++)for(k=0;k<j;k++)U=V[q++],B=V[q++],M=V[q++],H[Z++]=U,H[Z++]=B,H[Z++]=M,y&&(H[Z++]=255);break;case 4:for(I=0;I<G;I++)for(k=0;k<j;k++)N=V[q++],O=V[q++],z=V[q++],U=255-c(N*(1-(P=V[q++])/255)+P),B=255-c(O*(1-P/255)+P),M=255-c(z*(1-P/255)+P),H[Z++]=U,H[Z++]=B,H[Z++]=M,y&&(H[Z++]=255);break;default:throw new Error("Unsupported color mode")}}};var B=0,M=0;function w(m=0){var y=B+m;if(y>M){var k=Math.ceil((y-M)/1024/1024);throw new Error(`maxMemoryUsageInMB limit exceeded by at least ${k}MB`)}B=y}return f.resetMaxMemoryUsage=function(m){B=0,M=m},f.getBytesAllocated=function(){return B},f.requestMemoryAllocation=w,f}(),yt.exports=function(m,y={}){var k={colorTransform:void 0,useTArray:!1,formatAsRGBA:!0,tolerantDecoding:!0,maxResolutionInMP:100,maxMemoryUsageInMB:512,...y},I=new Uint8Array(m),z=new xt;z.opts=k,xt.resetMaxMemoryUsage(1024*k.maxMemoryUsageInMB*1024),z.parse(I);var P=k.formatAsRGBA?4:3,N=z.width*z.height*P;try{xt.requestMemoryAllocation(N);var O={width:z.width,height:z.height,exifBuffer:z.exifBuffer,data:k.useTArray?new Uint8Array(N):Buffer.alloc(N)};z.comments.length>0&&(O.comments=z.comments)}catch(m){if(m instanceof RangeError)throw new Error("Could not allocate enough memory for the image. Required: "+N);if(m instanceof ReferenceError&&"Buffer is not defined"===m.message)throw new Error("Buffer is not globally defined in this environment. Consider setting useTArray to true");throw m}return z.copyToImageData(O,k.formatAsRGBA),O};var Et={encode:vt.exports,decode:kt.exports};const It={decode(m){const y=Et.decode(m,{useTArray:!0,colorTransform:!0});return{width:y.width,height:y.height,data:y.data}},encode(m,y){const k=Et.encode(m,y.quality);return new Uint8Array(k.data)}};var zt={};!function(m){var y="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function r(m,y){return Object.prototype.hasOwnProperty.call(m,y)}m.assign=function(m){for(var y=Array.prototype.slice.call(arguments,1);y.length;){var k=y.shift();if(k){if("object"!=typeof k)throw new TypeError(k+"must be non-object");for(var I in k)r(k,I)&&(m[I]=k[I])}}return m},m.shrinkBuf=function(m,y){return m.length===y?m:m.subarray?m.subarray(0,y):(m.length=y,m)};var k={arraySet:function(m,y,k,I,z){if(y.subarray&&m.subarray)m.set(y.subarray(k,k+I),z);else for(var P=0;P<I;P++)m[z+P]=y[k+P]},flattenChunks:function(m){var y,k,I,z,P,N;for(I=0,y=0,k=m.length;y<k;y++)I+=m[y].length;for(N=new Uint8Array(I),z=0,y=0,k=m.length;y<k;y++)P=m[y],N.set(P,z),z+=P.length;return N}},I={arraySet:function(m,y,k,I,z){for(var P=0;P<I;P++)m[z+P]=y[k+P]},flattenChunks:function(m){return[].concat.apply([],m)}};m.setTyped=function(y){y?(m.Buf8=Uint8Array,m.Buf16=Uint16Array,m.Buf32=Int32Array,m.assign(m,k)):(m.Buf8=Array,m.Buf16=Array,m.Buf32=Array,m.assign(m,I))},m.setTyped(y)}(zt);var Ut={},Bt={},jt={},Wt=zt;function F(m){for(var y=m.length;--y>=0;)m[y]=0}var Xt=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],Jt=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],Yt=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],Kt=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],te=new Array(576);F(te);var ee=new Array(60);F(ee);var re=new Array(512);F(re);var ie=new Array(256);F(ie);var ne=new Array(29);F(ne);var ae,he,le,fe=new Array(30);function rt(m,y,k,I,z){this.static_tree=m,this.extra_bits=y,this.extra_base=k,this.elems=I,this.max_length=z,this.has_stree=m&&m.length}function it(m,y){this.dyn_tree=m,this.max_code=0,this.stat_desc=y}function nt(m){return m<256?re[m]:re[256+(m>>>7)]}function at(m,y){m.pending_buf[m.pending++]=255&y,m.pending_buf[m.pending++]=y>>>8&255}function st(m,y,k){m.bi_valid>16-k?(m.bi_buf|=y<<m.bi_valid&65535,at(m,m.bi_buf),m.bi_buf=y>>16-m.bi_valid,m.bi_valid+=k-16):(m.bi_buf|=y<<m.bi_valid&65535,m.bi_valid+=k)}function ot(m,y,k){st(m,k[2*y],k[2*y+1])}function ht(m,y){var k=0;do{k|=1&m,m>>>=1,k<<=1}while(--y>0);return k>>>1}function ft(m,y,k){var I,z,P=new Array(16),N=0;for(I=1;I<=15;I++)P[I]=N=N+k[I-1]<<1;for(z=0;z<=y;z++){var O=m[2*z+1];0!==O&&(m[2*z]=ht(P[O]++,O))}}function lt(m){var y;for(y=0;y<286;y++)m.dyn_ltree[2*y]=0;for(y=0;y<30;y++)m.dyn_dtree[2*y]=0;for(y=0;y<19;y++)m.bl_tree[2*y]=0;m.dyn_ltree[512]=1,m.opt_len=m.static_len=0,m.last_lit=m.matches=0}function dt(m){m.bi_valid>8?at(m,m.bi_buf):m.bi_valid>0&&(m.pending_buf[m.pending++]=m.bi_buf),m.bi_buf=0,m.bi_valid=0}function ut(m,y,k,I){var z=2*y,P=2*k;return m[z]<m[P]||m[z]===m[P]&&I[y]<=I[k]}function ct(m,y,k){for(var I=m.heap[k],z=k<<1;z<=m.heap_len&&(z<m.heap_len&&ut(y,m.heap[z+1],m.heap[z],m.depth)&&z++,!ut(y,I,m.heap[z],m.depth));)m.heap[k]=m.heap[z],k=z,z<<=1;m.heap[k]=I}function pt(m,y,k){var I,z,P,N,O=0;if(0!==m.last_lit)do{I=m.pending_buf[m.d_buf+2*O]<<8|m.pending_buf[m.d_buf+2*O+1],z=m.pending_buf[m.l_buf+O],O++,0===I?ot(m,z,y):(ot(m,(P=ie[z])+256+1,y),0!==(N=Xt[P])&&st(m,z-=ne[P],N),ot(m,P=nt(--I),k),0!==(N=Jt[P])&&st(m,I-=fe[P],N))}while(O<m.last_lit);ot(m,256,y)}function gt(m,y){var k,I,z,P=y.dyn_tree,N=y.stat_desc.static_tree,O=y.stat_desc.has_stree,U=y.stat_desc.elems,B=-1;for(m.heap_len=0,m.heap_max=573,k=0;k<U;k++)0!==P[2*k]?(m.heap[++m.heap_len]=B=k,m.depth[k]=0):P[2*k+1]=0;for(;m.heap_len<2;)P[2*(z=m.heap[++m.heap_len]=B<2?++B:0)]=1,m.depth[z]=0,m.opt_len--,O&&(m.static_len-=N[2*z+1]);for(y.max_code=B,k=m.heap_len>>1;k>=1;k--)ct(m,P,k);z=U;do{k=m.heap[1],m.heap[1]=m.heap[m.heap_len--],ct(m,P,1),I=m.heap[1],m.heap[--m.heap_max]=k,m.heap[--m.heap_max]=I,P[2*z]=P[2*k]+P[2*I],m.depth[z]=(m.depth[k]>=m.depth[I]?m.depth[k]:m.depth[I])+1,P[2*k+1]=P[2*I+1]=z,m.heap[1]=z++,ct(m,P,1)}while(m.heap_len>=2);m.heap[--m.heap_max]=m.heap[1],function(m,y){var k,I,z,P,N,O,U=y.dyn_tree,B=y.max_code,M=y.stat_desc.static_tree,j=y.stat_desc.has_stree,G=y.stat_desc.extra_bits,H=y.stat_desc.extra_base,V=y.stat_desc.max_length,q=0;for(P=0;P<=15;P++)m.bl_count[P]=0;for(U[2*m.heap[m.heap_max]+1]=0,k=m.heap_max+1;k<573;k++)(P=U[2*U[2*(I=m.heap[k])+1]+1]+1)>V&&(P=V,q++),U[2*I+1]=P,I>B||(m.bl_count[P]++,N=0,I>=H&&(N=G[I-H]),O=U[2*I],m.opt_len+=O*(P+N),j&&(m.static_len+=O*(M[2*I+1]+N)));if(0!==q){do{for(P=V-1;0===m.bl_count[P];)P--;m.bl_count[P]--,m.bl_count[P+1]+=2,m.bl_count[V]--,q-=2}while(q>0);for(P=V;0!==P;P--)for(I=m.bl_count[P];0!==I;)(z=m.heap[--k])>B||(U[2*z+1]!==P&&(m.opt_len+=(P-U[2*z+1])*U[2*z],U[2*z+1]=P),I--)}}(m,y),ft(P,B,m.bl_count)}function wt(m,y,k){var I,z,P=-1,N=y[1],O=0,U=7,B=4;for(0===N&&(U=138,B=3),y[2*(k+1)+1]=65535,I=0;I<=k;I++)z=N,N=y[2*(I+1)+1],++O<U&&z===N||(O<B?m.bl_tree[2*z]+=O:0!==z?(z!==P&&m.bl_tree[2*z]++,m.bl_tree[32]++):O<=10?m.bl_tree[34]++:m.bl_tree[36]++,O=0,P=z,0===N?(U=138,B=3):z===N?(U=6,B=3):(U=7,B=4))}function _t(m,y,k){var I,z,P=-1,N=y[1],O=0,U=7,B=4;for(0===N&&(U=138,B=3),I=0;I<=k;I++)if(z=N,N=y[2*(I+1)+1],!(++O<U&&z===N)){if(O<B)do{ot(m,z,m.bl_tree)}while(0!=--O);else 0!==z?(z!==P&&(ot(m,z,m.bl_tree),O--),ot(m,16,m.bl_tree),st(m,O-3,2)):O<=10?(ot(m,17,m.bl_tree),st(m,O-3,3)):(ot(m,18,m.bl_tree),st(m,O-11,7));O=0,P=z,0===N?(U=138,B=3):z===N?(U=6,B=3):(U=7,B=4)}}F(fe);var ce=!1;function bt(m,y,k,I){st(m,0+(I?1:0),3),function(m,y,k,I){dt(m),at(m,k),at(m,~k),Wt.arraySet(m.pending_buf,m.window,y,k,m.pending),m.pending+=k}(m,y,k)}jt._tr_init=function(m){ce||(function(){var m,y,k,I,z,P=new Array(16);for(k=0,I=0;I<28;I++)for(ne[I]=k,m=0;m<1<<Xt[I];m++)ie[k++]=I;for(ie[k-1]=I,z=0,I=0;I<16;I++)for(fe[I]=z,m=0;m<1<<Jt[I];m++)re[z++]=I;for(z>>=7;I<30;I++)for(fe[I]=z<<7,m=0;m<1<<Jt[I]-7;m++)re[256+z++]=I;for(y=0;y<=15;y++)P[y]=0;for(m=0;m<=143;)te[2*m+1]=8,m++,P[8]++;for(;m<=255;)te[2*m+1]=9,m++,P[9]++;for(;m<=279;)te[2*m+1]=7,m++,P[7]++;for(;m<=287;)te[2*m+1]=8,m++,P[8]++;for(ft(te,287,P),m=0;m<30;m++)ee[2*m+1]=5,ee[2*m]=ht(m,5);ae=new rt(te,Xt,257,286,15),he=new rt(ee,Jt,0,30,15),le=new rt(new Array(0),Yt,0,19,7)}(),ce=!0),m.l_desc=new it(m.dyn_ltree,ae),m.d_desc=new it(m.dyn_dtree,he),m.bl_desc=new it(m.bl_tree,le),m.bi_buf=0,m.bi_valid=0,lt(m)},jt._tr_stored_block=bt,jt._tr_flush_block=function(m,y,k,I){var z,P,N=0;m.level>0?(2===m.strm.data_type&&(m.strm.data_type=function(m){var y,k=4093624447;for(y=0;y<=31;y++,k>>>=1)if(1&k&&0!==m.dyn_ltree[2*y])return 0;if(0!==m.dyn_ltree[18]||0!==m.dyn_ltree[20]||0!==m.dyn_ltree[26])return 1;for(y=32;y<256;y++)if(0!==m.dyn_ltree[2*y])return 1;return 0}(m)),gt(m,m.l_desc),gt(m,m.d_desc),N=function(m){var y;for(wt(m,m.dyn_ltree,m.l_desc.max_code),wt(m,m.dyn_dtree,m.d_desc.max_code),gt(m,m.bl_desc),y=18;y>=3&&0===m.bl_tree[2*Kt[y]+1];y--);return m.opt_len+=3*(y+1)+5+5+4,y}(m),z=m.opt_len+3+7>>>3,(P=m.static_len+3+7>>>3)<=z&&(z=P)):z=P=k+5,k+4<=z&&-1!==y?bt(m,y,k,I):4===m.strategy||P===z?(st(m,2+(I?1:0),3),pt(m,te,ee)):(st(m,4+(I?1:0),3),function(m,y,k,I){var z;for(st(m,y-257,5),st(m,k-1,5),st(m,I-4,4),z=0;z<I;z++)st(m,m.bl_tree[2*Kt[z]+1],3);_t(m,m.dyn_ltree,y-1),_t(m,m.dyn_dtree,k-1)}(m,m.l_desc.max_code+1,m.d_desc.max_code+1,N+1),pt(m,m.dyn_ltree,m.dyn_dtree)),lt(m),I&&dt(m)},jt._tr_tally=function(m,y,k){return m.pending_buf[m.d_buf+2*m.last_lit]=y>>>8&255,m.pending_buf[m.d_buf+2*m.last_lit+1]=255&y,m.pending_buf[m.l_buf+m.last_lit]=255&k,m.last_lit++,0===y?m.dyn_ltree[2*k]++:(m.matches++,y--,m.dyn_ltree[2*(ie[k]+256+1)]++,m.dyn_dtree[2*nt(y)]++),m.last_lit===m.lit_bufsize-1},jt._tr_align=function(m){st(m,2,3),ot(m,256,te),function(m){16===m.bi_valid?(at(m,m.bi_buf),m.bi_buf=0,m.bi_valid=0):m.bi_valid>=8&&(m.pending_buf[m.pending++]=255&m.bi_buf,m.bi_buf>>=8,m.bi_valid-=8)}(m)};var de,mt=function(m,y,k,I){for(var z=65535&m|0,P=m>>>16&65535|0,N=0;0!==k;){k-=N=k>2e3?2e3:k;do{P=P+(z=z+y[I++]|0)|0}while(--N);z%=65521,P%=65521}return z|P<<16|0},ue=function(){for(var m,y=[],k=0;k<256;k++){m=k;for(var I=0;I<8;I++)m=1&m?3988292384^m>>>1:m>>>1;y[k]=m}return y}(),At=function(m,y,k,I){var z=ue,P=I+k;m^=-1;for(var N=I;N<P;N++)m=m>>>8^z[255&(m^y[N])];return-1^m},pe={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},ge=zt,we=jt,Te=mt,Ie=At,Ce=pe;function Pt(m,y){return m.msg=Ce[y],y}function Mt(m){return(m<<1)-(m>4?9:0)}function Rt(m){for(var y=m.length;--y>=0;)m[y]=0}function St(m){var y=m.state,k=y.pending;k>m.avail_out&&(k=m.avail_out),0!==k&&(ge.arraySet(m.output,y.pending_buf,y.pending_out,k,m.next_out),m.next_out+=k,y.pending_out+=k,m.total_out+=k,m.avail_out-=k,y.pending-=k,0===y.pending&&(y.pending_out=0))}function Tt(m,y){we._tr_flush_block(m,m.block_start>=0?m.block_start:-1,m.strstart-m.block_start,y),m.block_start=m.strstart,St(m.strm)}function Ct(m,y){m.pending_buf[m.pending++]=y}function Lt(m,y){m.pending_buf[m.pending++]=y>>>8&255,m.pending_buf[m.pending++]=255&y}function Dt(m,y){var k,I,z=m.max_chain_length,P=m.strstart,N=m.prev_length,O=m.nice_match,U=m.strstart>m.w_size-262?m.strstart-(m.w_size-262):0,B=m.window,M=m.w_mask,j=m.prev,G=m.strstart+258,H=B[P+N-1],V=B[P+N];m.prev_length>=m.good_match&&(z>>=2),O>m.lookahead&&(O=m.lookahead);do{if(B[(k=y)+N]===V&&B[k+N-1]===H&&B[k]===B[P]&&B[++k]===B[P+1]){P+=2,k++;do{}while(B[++P]===B[++k]&&B[++P]===B[++k]&&B[++P]===B[++k]&&B[++P]===B[++k]&&B[++P]===B[++k]&&B[++P]===B[++k]&&B[++P]===B[++k]&&B[++P]===B[++k]&&P<G);if(I=258-(G-P),P=G-258,I>N){if(m.match_start=y,N=I,I>=O)break;H=B[P+N-1],V=B[P+N]}}}while((y=j[y&M])>U&&0!=--z);return N<=m.lookahead?N:m.lookahead}function Ht(m){var y,k,I,z,P,N,O,U,B,M,j=m.w_size;do{if(z=m.window_size-m.lookahead-m.strstart,m.strstart>=j+(j-262)){ge.arraySet(m.window,m.window,j,j,0),m.match_start-=j,m.strstart-=j,m.block_start-=j,y=k=m.hash_size;do{I=m.head[--y],m.head[y]=I>=j?I-j:0}while(--k);y=k=j;do{I=m.prev[--y],m.prev[y]=I>=j?I-j:0}while(--k);z+=j}if(0===m.strm.avail_in)break;if(N=m.strm,O=m.window,U=m.strstart+m.lookahead,B=z,M=void 0,(M=N.avail_in)>B&&(M=B),k=0===M?0:(N.avail_in-=M,ge.arraySet(O,N.input,N.next_in,M,U),1===N.state.wrap?N.adler=Te(N.adler,O,M,U):2===N.state.wrap&&(N.adler=Ie(N.adler,O,M,U)),N.next_in+=M,N.total_in+=M,M),m.lookahead+=k,m.lookahead+m.insert>=3)for(P=m.strstart-m.insert,m.ins_h=m.window[P],m.ins_h=(m.ins_h<<m.hash_shift^m.window[P+1])&m.hash_mask;m.insert&&(m.ins_h=(m.ins_h<<m.hash_shift^m.window[P+3-1])&m.hash_mask,m.prev[P&m.w_mask]=m.head[m.ins_h],m.head[m.ins_h]=P,P++,m.insert--,!(m.lookahead+m.insert<3)););}while(m.lookahead<262&&0!==m.strm.avail_in)}function Nt(m,y){for(var k,I;;){if(m.lookahead<262){if(Ht(m),m.lookahead<262&&0===y)return 1;if(0===m.lookahead)break}if(k=0,m.lookahead>=3&&(m.ins_h=(m.ins_h<<m.hash_shift^m.window[m.strstart+3-1])&m.hash_mask,k=m.prev[m.strstart&m.w_mask]=m.head[m.ins_h],m.head[m.ins_h]=m.strstart),0!==k&&m.strstart-k<=m.w_size-262&&(m.match_length=Dt(m,k)),m.match_length>=3)if(I=we._tr_tally(m,m.strstart-m.match_start,m.match_length-3),m.lookahead-=m.match_length,m.match_length<=m.max_lazy_match&&m.lookahead>=3){m.match_length--;do{m.strstart++,m.ins_h=(m.ins_h<<m.hash_shift^m.window[m.strstart+3-1])&m.hash_mask,k=m.prev[m.strstart&m.w_mask]=m.head[m.ins_h],m.head[m.ins_h]=m.strstart}while(0!=--m.match_length);m.strstart++}else m.strstart+=m.match_length,m.match_length=0,m.ins_h=m.window[m.strstart],m.ins_h=(m.ins_h<<m.hash_shift^m.window[m.strstart+1])&m.hash_mask;else I=we._tr_tally(m,0,m.window[m.strstart]),m.lookahead--,m.strstart++;if(I&&(Tt(m,!1),0===m.strm.avail_out))return 1}return m.insert=m.strstart<2?m.strstart:2,4===y?(Tt(m,!0),0===m.strm.avail_out?3:4):m.last_lit&&(Tt(m,!1),0===m.strm.avail_out)?1:2}function Gt(m,y){for(var k,I,z;;){if(m.lookahead<262){if(Ht(m),m.lookahead<262&&0===y)return 1;if(0===m.lookahead)break}if(k=0,m.lookahead>=3&&(m.ins_h=(m.ins_h<<m.hash_shift^m.window[m.strstart+3-1])&m.hash_mask,k=m.prev[m.strstart&m.w_mask]=m.head[m.ins_h],m.head[m.ins_h]=m.strstart),m.prev_length=m.match_length,m.prev_match=m.match_start,m.match_length=2,0!==k&&m.prev_length<m.max_lazy_match&&m.strstart-k<=m.w_size-262&&(m.match_length=Dt(m,k),m.match_length<=5&&(1===m.strategy||3===m.match_length&&m.strstart-m.match_start>4096)&&(m.match_length=2)),m.prev_length>=3&&m.match_length<=m.prev_length){z=m.strstart+m.lookahead-3,I=we._tr_tally(m,m.strstart-1-m.prev_match,m.prev_length-3),m.lookahead-=m.prev_length-1,m.prev_length-=2;do{++m.strstart<=z&&(m.ins_h=(m.ins_h<<m.hash_shift^m.window[m.strstart+3-1])&m.hash_mask,k=m.prev[m.strstart&m.w_mask]=m.head[m.ins_h],m.head[m.ins_h]=m.strstart)}while(0!=--m.prev_length);if(m.match_available=0,m.match_length=2,m.strstart++,I&&(Tt(m,!1),0===m.strm.avail_out))return 1}else if(m.match_available){if((I=we._tr_tally(m,0,m.window[m.strstart-1]))&&Tt(m,!1),m.strstart++,m.lookahead--,0===m.strm.avail_out)return 1}else m.match_available=1,m.strstart++,m.lookahead--}return m.match_available&&(I=we._tr_tally(m,0,m.window[m.strstart-1]),m.match_available=0),m.insert=m.strstart<2?m.strstart:2,4===y?(Tt(m,!0),0===m.strm.avail_out?3:4):m.last_lit&&(Tt(m,!1),0===m.strm.avail_out)?1:2}function Ot(m,y,k,I,z){this.good_length=m,this.max_lazy=y,this.nice_length=k,this.max_chain=I,this.func=z}function Ft(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=8,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new ge.Buf16(1146),this.dyn_dtree=new ge.Buf16(122),this.bl_tree=new ge.Buf16(78),Rt(this.dyn_ltree),Rt(this.dyn_dtree),Rt(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new ge.Buf16(16),this.heap=new ge.Buf16(573),Rt(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new ge.Buf16(573),Rt(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Zt(m){var y;return m&&m.state?(m.total_in=m.total_out=0,m.data_type=2,(y=m.state).pending=0,y.pending_out=0,y.wrap<0&&(y.wrap=-y.wrap),y.status=y.wrap?42:113,m.adler=2===y.wrap?0:1,y.last_flush=0,we._tr_init(y),0):Pt(m,-2)}function qt(m){var y,k=Zt(m);return 0===k&&((y=m.state).window_size=2*y.w_size,Rt(y.head),y.max_lazy_match=de[y.level].max_lazy,y.good_match=de[y.level].good_length,y.nice_match=de[y.level].nice_length,y.max_chain_length=de[y.level].max_chain,y.strstart=0,y.block_start=0,y.lookahead=0,y.insert=0,y.match_length=y.prev_length=2,y.match_available=0,y.ins_h=0),k}function Vt(m,y,k,I,z,P){if(!m)return-2;var N=1;if(-1===y&&(y=6),I<0?(N=0,I=-I):I>15&&(N=2,I-=16),z<1||z>9||8!==k||I<8||I>15||y<0||y>9||P<0||P>4)return Pt(m,-2);8===I&&(I=9);var O=new Ft;return m.state=O,O.strm=m,O.wrap=N,O.gzhead=null,O.w_bits=I,O.w_size=1<<O.w_bits,O.w_mask=O.w_size-1,O.hash_bits=z+7,O.hash_size=1<<O.hash_bits,O.hash_mask=O.hash_size-1,O.hash_shift=~~((O.hash_bits+3-1)/3),O.window=new ge.Buf8(2*O.w_size),O.head=new ge.Buf16(O.hash_size),O.prev=new ge.Buf16(O.w_size),O.lit_bufsize=1<<z+6,O.pending_buf_size=4*O.lit_bufsize,O.pending_buf=new ge.Buf8(O.pending_buf_size),O.d_buf=1*O.lit_bufsize,O.l_buf=3*O.lit_bufsize,O.level=y,O.strategy=P,O.method=k,qt(m)}de=[new Ot(0,0,0,0,(function(m,y){var k=65535;for(k>m.pending_buf_size-5&&(k=m.pending_buf_size-5);;){if(m.lookahead<=1){if(Ht(m),0===m.lookahead&&0===y)return 1;if(0===m.lookahead)break}m.strstart+=m.lookahead,m.lookahead=0;var I=m.block_start+k;if((0===m.strstart||m.strstart>=I)&&(m.lookahead=m.strstart-I,m.strstart=I,Tt(m,!1),0===m.strm.avail_out))return 1;if(m.strstart-m.block_start>=m.w_size-262&&(Tt(m,!1),0===m.strm.avail_out))return 1}return m.insert=0,4===y?(Tt(m,!0),0===m.strm.avail_out?3:4):(m.strstart>m.block_start&&(Tt(m,!1),m.strm.avail_out),1)})),new Ot(4,4,8,4,Nt),new Ot(4,5,16,8,Nt),new Ot(4,6,32,32,Nt),new Ot(4,4,16,16,Gt),new Ot(8,16,32,32,Gt),new Ot(8,16,128,128,Gt),new Ot(8,32,128,256,Gt),new Ot(32,128,258,1024,Gt),new Ot(32,258,258,4096,Gt)],Bt.deflateInit=function(m,y){return Vt(m,y,8,15,8,0)},Bt.deflateInit2=Vt,Bt.deflateReset=qt,Bt.deflateResetKeep=Zt,Bt.deflateSetHeader=function(m,y){return m&&m.state?2!==m.state.wrap?-2:(m.state.gzhead=y,0):-2},Bt.deflate=function(m,y){var k,I,z,P;if(!m||!m.state||y>5||y<0)return m?Pt(m,-2):-2;if(I=m.state,!m.output||!m.input&&0!==m.avail_in||666===I.status&&4!==y)return Pt(m,0===m.avail_out?-5:-2);if(I.strm=m,k=I.last_flush,I.last_flush=y,42===I.status)if(2===I.wrap)m.adler=0,Ct(I,31),Ct(I,139),Ct(I,8),I.gzhead?(Ct(I,(I.gzhead.text?1:0)+(I.gzhead.hcrc?2:0)+(I.gzhead.extra?4:0)+(I.gzhead.name?8:0)+(I.gzhead.comment?16:0)),Ct(I,255&I.gzhead.time),Ct(I,I.gzhead.time>>8&255),Ct(I,I.gzhead.time>>16&255),Ct(I,I.gzhead.time>>24&255),Ct(I,9===I.level?2:I.strategy>=2||I.level<2?4:0),Ct(I,255&I.gzhead.os),I.gzhead.extra&&I.gzhead.extra.length&&(Ct(I,255&I.gzhead.extra.length),Ct(I,I.gzhead.extra.length>>8&255)),I.gzhead.hcrc&&(m.adler=Ie(m.adler,I.pending_buf,I.pending,0)),I.gzindex=0,I.status=69):(Ct(I,0),Ct(I,0),Ct(I,0),Ct(I,0),Ct(I,0),Ct(I,9===I.level?2:I.strategy>=2||I.level<2?4:0),Ct(I,3),I.status=113);else{var N=8+(I.w_bits-8<<4)<<8;N|=(I.strategy>=2||I.level<2?0:I.level<6?1:6===I.level?2:3)<<6,0!==I.strstart&&(N|=32),N+=31-N%31,I.status=113,Lt(I,N),0!==I.strstart&&(Lt(I,m.adler>>>16),Lt(I,65535&m.adler)),m.adler=1}if(69===I.status)if(I.gzhead.extra){for(z=I.pending;I.gzindex<(65535&I.gzhead.extra.length)&&(I.pending!==I.pending_buf_size||(I.gzhead.hcrc&&I.pending>z&&(m.adler=Ie(m.adler,I.pending_buf,I.pending-z,z)),St(m),z=I.pending,I.pending!==I.pending_buf_size));)Ct(I,255&I.gzhead.extra[I.gzindex]),I.gzindex++;I.gzhead.hcrc&&I.pending>z&&(m.adler=Ie(m.adler,I.pending_buf,I.pending-z,z)),I.gzindex===I.gzhead.extra.length&&(I.gzindex=0,I.status=73)}else I.status=73;if(73===I.status)if(I.gzhead.name){z=I.pending;do{if(I.pending===I.pending_buf_size&&(I.gzhead.hcrc&&I.pending>z&&(m.adler=Ie(m.adler,I.pending_buf,I.pending-z,z)),St(m),z=I.pending,I.pending===I.pending_buf_size)){P=1;break}P=I.gzindex<I.gzhead.name.length?255&I.gzhead.name.charCodeAt(I.gzindex++):0,Ct(I,P)}while(0!==P);I.gzhead.hcrc&&I.pending>z&&(m.adler=Ie(m.adler,I.pending_buf,I.pending-z,z)),0===P&&(I.gzindex=0,I.status=91)}else I.status=91;if(91===I.status)if(I.gzhead.comment){z=I.pending;do{if(I.pending===I.pending_buf_size&&(I.gzhead.hcrc&&I.pending>z&&(m.adler=Ie(m.adler,I.pending_buf,I.pending-z,z)),St(m),z=I.pending,I.pending===I.pending_buf_size)){P=1;break}P=I.gzindex<I.gzhead.comment.length?255&I.gzhead.comment.charCodeAt(I.gzindex++):0,Ct(I,P)}while(0!==P);I.gzhead.hcrc&&I.pending>z&&(m.adler=Ie(m.adler,I.pending_buf,I.pending-z,z)),0===P&&(I.status=103)}else I.status=103;if(103===I.status&&(I.gzhead.hcrc?(I.pending+2>I.pending_buf_size&&St(m),I.pending+2<=I.pending_buf_size&&(Ct(I,255&m.adler),Ct(I,m.adler>>8&255),m.adler=0,I.status=113)):I.status=113),0!==I.pending){if(St(m),0===m.avail_out)return I.last_flush=-1,0}else if(0===m.avail_in&&Mt(y)<=Mt(k)&&4!==y)return Pt(m,-5);if(666===I.status&&0!==m.avail_in)return Pt(m,-5);if(0!==m.avail_in||0!==I.lookahead||0!==y&&666!==I.status){var O=2===I.strategy?function(m,y){for(var k;;){if(0===m.lookahead&&(Ht(m),0===m.lookahead)){if(0===y)return 1;break}if(m.match_length=0,k=we._tr_tally(m,0,m.window[m.strstart]),m.lookahead--,m.strstart++,k&&(Tt(m,!1),0===m.strm.avail_out))return 1}return m.insert=0,4===y?(Tt(m,!0),0===m.strm.avail_out?3:4):m.last_lit&&(Tt(m,!1),0===m.strm.avail_out)?1:2}(I,y):3===I.strategy?function(m,y){for(var k,I,z,P,N=m.window;;){if(m.lookahead<=258){if(Ht(m),m.lookahead<=258&&0===y)return 1;if(0===m.lookahead)break}if(m.match_length=0,m.lookahead>=3&&m.strstart>0&&(I=N[z=m.strstart-1])===N[++z]&&I===N[++z]&&I===N[++z]){P=m.strstart+258;do{}while(I===N[++z]&&I===N[++z]&&I===N[++z]&&I===N[++z]&&I===N[++z]&&I===N[++z]&&I===N[++z]&&I===N[++z]&&z<P);m.match_length=258-(P-z),m.match_length>m.lookahead&&(m.match_length=m.lookahead)}if(m.match_length>=3?(k=we._tr_tally(m,1,m.match_length-3),m.lookahead-=m.match_length,m.strstart+=m.match_length,m.match_length=0):(k=we._tr_tally(m,0,m.window[m.strstart]),m.lookahead--,m.strstart++),k&&(Tt(m,!1),0===m.strm.avail_out))return 1}return m.insert=0,4===y?(Tt(m,!0),0===m.strm.avail_out?3:4):m.last_lit&&(Tt(m,!1),0===m.strm.avail_out)?1:2}(I,y):de[I.level].func(I,y);if(3!==O&&4!==O||(I.status=666),1===O||3===O)return 0===m.avail_out&&(I.last_flush=-1),0;if(2===O&&(1===y?we._tr_align(I):5!==y&&(we._tr_stored_block(I,0,0,!1),3===y&&(Rt(I.head),0===I.lookahead&&(I.strstart=0,I.block_start=0,I.insert=0))),St(m),0===m.avail_out))return I.last_flush=-1,0}return 4!==y?0:I.wrap<=0?1:(2===I.wrap?(Ct(I,255&m.adler),Ct(I,m.adler>>8&255),Ct(I,m.adler>>16&255),Ct(I,m.adler>>24&255),Ct(I,255&m.total_in),Ct(I,m.total_in>>8&255),Ct(I,m.total_in>>16&255),Ct(I,m.total_in>>24&255)):(Lt(I,m.adler>>>16),Lt(I,65535&m.adler)),St(m),I.wrap>0&&(I.wrap=-I.wrap),0!==I.pending?0:1)},Bt.deflateEnd=function(m){var y;return m&&m.state?42!==(y=m.state.status)&&69!==y&&73!==y&&91!==y&&103!==y&&113!==y&&666!==y?Pt(m,-2):(m.state=null,113===y?Pt(m,-3):0):-2},Bt.deflateSetDictionary=function(m,y){var k,I,z,P,N,O,U,B,M=y.length;if(!m||!m.state)return-2;if(2===(P=(k=m.state).wrap)||1===P&&42!==k.status||k.lookahead)return-2;for(1===P&&(m.adler=Te(m.adler,y,M,0)),k.wrap=0,M>=k.w_size&&(0===P&&(Rt(k.head),k.strstart=0,k.block_start=0,k.insert=0),B=new ge.Buf8(k.w_size),ge.arraySet(B,y,M-k.w_size,k.w_size,0),y=B,M=k.w_size),N=m.avail_in,O=m.next_in,U=m.input,m.avail_in=M,m.next_in=0,m.input=y,Ht(k);k.lookahead>=3;){I=k.strstart,z=k.lookahead-2;do{k.ins_h=(k.ins_h<<k.hash_shift^k.window[I+3-1])&k.hash_mask,k.prev[I&k.w_mask]=k.head[k.ins_h],k.head[k.ins_h]=I,I++}while(--z);k.strstart=I,k.lookahead=2,Ht(k)}return k.strstart+=k.lookahead,k.block_start=k.strstart,k.insert=k.lookahead,k.lookahead=0,k.match_length=k.prev_length=2,k.match_available=0,m.next_in=O,m.input=U,m.avail_in=N,k.wrap=P,0},Bt.deflateInfo="pako deflate (from Nodeca project)";var Se={},ze=zt,Ne=!0,Ue=!0;try{String.fromCharCode.apply(null,[0])}catch(B){Ne=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(B){Ue=!1}for(var Le=new ze.Buf8(256),Me=0;Me<256;Me++)Le[Me]=Me>=252?6:Me>=248?5:Me>=240?4:Me>=224?3:Me>=192?2:1;function $t(m,y){if(y<65534&&(m.subarray&&Ue||!m.subarray&&Ne))return String.fromCharCode.apply(null,ze.shrinkBuf(m,y));for(var k="",I=0;I<y;I++)k+=String.fromCharCode(m[I]);return k}Le[254]=Le[254]=1,Se.string2buf=function(m){var y,k,I,z,P,N=m.length,O=0;for(z=0;z<N;z++)55296==(64512&(k=m.charCodeAt(z)))&&z+1<N&&56320==(64512&(I=m.charCodeAt(z+1)))&&(k=65536+(k-55296<<10)+(I-56320),z++),O+=k<128?1:k<2048?2:k<65536?3:4;for(y=new ze.Buf8(O),P=0,z=0;P<O;z++)55296==(64512&(k=m.charCodeAt(z)))&&z+1<N&&56320==(64512&(I=m.charCodeAt(z+1)))&&(k=65536+(k-55296<<10)+(I-56320),z++),k<128?y[P++]=k:k<2048?(y[P++]=192|k>>>6,y[P++]=128|63&k):k<65536?(y[P++]=224|k>>>12,y[P++]=128|k>>>6&63,y[P++]=128|63&k):(y[P++]=240|k>>>18,y[P++]=128|k>>>12&63,y[P++]=128|k>>>6&63,y[P++]=128|63&k);return y},Se.buf2binstring=function(m){return $t(m,m.length)},Se.binstring2buf=function(m){for(var y=new ze.Buf8(m.length),k=0,I=y.length;k<I;k++)y[k]=m.charCodeAt(k);return y},Se.buf2string=function(m,y){var k,I,z,P,N=y||m.length,O=new Array(2*N);for(I=0,k=0;k<N;)if((z=m[k++])<128)O[I++]=z;else if((P=Le[z])>4)O[I++]=65533,k+=P-1;else{for(z&=2===P?31:3===P?15:7;P>1&&k<N;)z=z<<6|63&m[k++],P--;P>1?O[I++]=65533:z<65536?O[I++]=z:(z-=65536,O[I++]=55296|z>>10&1023,O[I++]=56320|1023&z)}return $t(O,I)},Se.utf8border=function(m,y){var k;for((y=y||m.length)>m.length&&(y=m.length),k=y-1;k>=0&&128==(192&m[k]);)k--;return k<0||0===k?y:k+Le[m[k]]>y?k:y};var Qt=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0},Re=Bt,Fe=zt,De=Se,je=pe,Ve=Qt,qe=Object.prototype.toString;function se(m){if(!(this instanceof se))return new se(m);this.options=Fe.assign({level:-1,method:8,chunkSize:16384,windowBits:15,memLevel:8,strategy:0,to:""},m||{});var y=this.options;y.raw&&y.windowBits>0?y.windowBits=-y.windowBits:y.gzip&&y.windowBits>0&&y.windowBits<16&&(y.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Ve,this.strm.avail_out=0;var k=Re.deflateInit2(this.strm,y.level,y.method,y.windowBits,y.memLevel,y.strategy);if(0!==k)throw new Error(je[k]);if(y.header&&Re.deflateSetHeader(this.strm,y.header),y.dictionary){var I;if(I="string"==typeof y.dictionary?De.string2buf(y.dictionary):"[object ArrayBuffer]"===qe.call(y.dictionary)?new Uint8Array(y.dictionary):y.dictionary,0!==(k=Re.deflateSetDictionary(this.strm,I)))throw new Error(je[k]);this._dict_set=!0}}function oe(m,y){var k=new se(y);if(k.push(m,!0),k.err)throw k.msg||je[k.err];return k.result}se.prototype.push=function(m,y){var k,I,z=this.strm,P=this.options.chunkSize;if(this.ended)return!1;I=y===~~y?y:!0===y?4:0,"string"==typeof m?z.input=De.string2buf(m):"[object ArrayBuffer]"===qe.call(m)?z.input=new Uint8Array(m):z.input=m,z.next_in=0,z.avail_in=z.input.length;do{if(0===z.avail_out&&(z.output=new Fe.Buf8(P),z.next_out=0,z.avail_out=P),1!==(k=Re.deflate(z,I))&&0!==k)return this.onEnd(k),this.ended=!0,!1;0!==z.avail_out&&(0!==z.avail_in||4!==I&&2!==I)||("string"===this.options.to?this.onData(De.buf2binstring(Fe.shrinkBuf(z.output,z.next_out))):this.onData(Fe.shrinkBuf(z.output,z.next_out)))}while((z.avail_in>0||0===z.avail_out)&&1!==k);return 4===I?(k=Re.deflateEnd(this.strm),this.onEnd(k),this.ended=!0,0===k):2!==I||(this.onEnd(0),z.avail_out=0,!0)},se.prototype.onData=function(m){this.chunks.push(m)},se.prototype.onEnd=function(m){0===m&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=Fe.flattenChunks(this.chunks)),this.chunks=[],this.err=m,this.msg=this.strm.msg},Ut.Deflate=se,Ut.deflate=oe,Ut.deflateRaw=function(m,y){return(y=y||{}).raw=!0,oe(m,y)},Ut.gzip=function(m,y){return(y=y||{}).gzip=!0,oe(m,y)};var Ze={},$e={},We=zt,Xe=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],Ye=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],Qe=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],tr=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64],sr=zt,hr=mt,lr=At,ve=function(m,y){var k,I,z,P,N,O,U,B,M,j,G,H,V,q,Z,$,W,X,J,Y,K,Q,tt,et,vt;k=m.state,I=m.next_in,et=m.input,z=I+(m.avail_in-5),P=m.next_out,vt=m.output,N=P-(y-m.avail_out),O=P+(m.avail_out-257),U=k.dmax,B=k.wsize,M=k.whave,j=k.wnext,G=k.window,H=k.hold,V=k.bits,q=k.lencode,Z=k.distcode,$=(1<<k.lenbits)-1,W=(1<<k.distbits)-1;t:do{V<15&&(H+=et[I++]<<V,V+=8,H+=et[I++]<<V,V+=8),X=q[H&$];e:for(;;){if(H>>>=J=X>>>24,V-=J,0==(J=X>>>16&255))vt[P++]=65535&X;else{if(!(16&J)){if(0==(64&J)){X=q[(65535&X)+(H&(1<<J)-1)];continue e}if(32&J){k.mode=12;break t}m.msg="invalid literal/length code",k.mode=30;break t}Y=65535&X,(J&=15)&&(V<J&&(H+=et[I++]<<V,V+=8),Y+=H&(1<<J)-1,H>>>=J,V-=J),V<15&&(H+=et[I++]<<V,V+=8,H+=et[I++]<<V,V+=8),X=Z[H&W];r:for(;;){if(H>>>=J=X>>>24,V-=J,!(16&(J=X>>>16&255))){if(0==(64&J)){X=Z[(65535&X)+(H&(1<<J)-1)];continue r}m.msg="invalid distance code",k.mode=30;break t}if(K=65535&X,V<(J&=15)&&(H+=et[I++]<<V,(V+=8)<J&&(H+=et[I++]<<V,V+=8)),(K+=H&(1<<J)-1)>U){m.msg="invalid distance too far back",k.mode=30;break t}if(H>>>=J,V-=J,K>(J=P-N)){if((J=K-J)>M&&k.sane){m.msg="invalid distance too far back",k.mode=30;break t}if(Q=0,tt=G,0===j){if(Q+=B-J,J<Y){Y-=J;do{vt[P++]=G[Q++]}while(--J);Q=P-K,tt=vt}}else if(j<J){if(Q+=B+j-J,(J-=j)<Y){Y-=J;do{vt[P++]=G[Q++]}while(--J);if(Q=0,j<Y){Y-=J=j;do{vt[P++]=G[Q++]}while(--J);Q=P-K,tt=vt}}}else if(Q+=j-J,J<Y){Y-=J;do{vt[P++]=G[Q++]}while(--J);Q=P-K,tt=vt}for(;Y>2;)vt[P++]=tt[Q++],vt[P++]=tt[Q++],vt[P++]=tt[Q++],Y-=3;Y&&(vt[P++]=tt[Q++],Y>1&&(vt[P++]=tt[Q++]))}else{Q=P-K;do{vt[P++]=vt[Q++],vt[P++]=vt[Q++],vt[P++]=vt[Q++],Y-=3}while(Y>2);Y&&(vt[P++]=vt[Q++],Y>1&&(vt[P++]=vt[Q++]))}break}}break}}while(I<z&&P<O);I-=Y=V>>3,H&=(1<<(V-=Y<<3))-1,m.next_in=I,m.next_out=P,m.avail_in=I<z?z-I+5:5-(I-z),m.avail_out=P<O?O-P+257:257-(P-O),k.hold=H,k.bits=V},be=function(m,y,k,I,z,P,N,O){var U,B,M,j,G,H,V,q,Z,$=O.bits,W=0,X=0,J=0,Y=0,K=0,Q=0,tt=0,et=0,vt=0,yt=0,xt=null,kt=0,Et=new We.Buf16(16),It=new We.Buf16(16),zt=null,Ut=0;for(W=0;W<=15;W++)Et[W]=0;for(X=0;X<I;X++)Et[y[k+X]]++;for(K=$,Y=15;Y>=1&&0===Et[Y];Y--);if(K>Y&&(K=Y),0===Y)return z[P++]=20971520,z[P++]=20971520,O.bits=1,0;for(J=1;J<Y&&0===Et[J];J++);for(K<J&&(K=J),et=1,W=1;W<=15;W++)if(et<<=1,(et-=Et[W])<0)return-1;if(et>0&&(0===m||1!==Y))return-1;for(It[1]=0,W=1;W<15;W++)It[W+1]=It[W]+Et[W];for(X=0;X<I;X++)0!==y[k+X]&&(N[It[y[k+X]]++]=X);if(0===m?(xt=zt=N,H=19):1===m?(xt=Xe,kt-=257,zt=Ye,Ut-=257,H=256):(xt=Qe,zt=tr,H=-1),yt=0,X=0,W=J,G=P,Q=K,tt=0,M=-1,j=(vt=1<<K)-1,1===m&&vt>852||2===m&&vt>592)return 1;for(;;){V=W-tt,N[X]<H?(q=0,Z=N[X]):N[X]>H?(q=zt[Ut+N[X]],Z=xt[kt+N[X]]):(q=96,Z=0),U=1<<W-tt,J=B=1<<Q;do{z[G+(yt>>tt)+(B-=U)]=V<<24|q<<16|Z|0}while(0!==B);for(U=1<<W-1;yt&U;)U>>=1;if(0!==U?(yt&=U-1,yt+=U):yt=0,X++,0==--Et[W]){if(W===Y)break;W=y[k+N[X]]}if(W>K&&(yt&j)!==M){for(0===tt&&(tt=K),G+=J,et=1<<(Q=W-tt);Q+tt<Y&&!((et-=Et[Q+tt])<=0);)Q++,et<<=1;if(vt+=1<<Q,1===m&&vt>852||2===m&&vt>592)return 1;z[M=yt&j]=K<<24|Q<<16|G-P|0}}return 0!==yt&&(z[G+yt]=W-tt<<24|64<<16|0),O.bits=K,0};function me(m){return(m>>>24&255)+(m>>>8&65280)+((65280&m)<<8)+((255&m)<<24)}function ye(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new sr.Buf16(320),this.work=new sr.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function ke(m){var y;return m&&m.state?(y=m.state,m.total_in=m.total_out=y.total=0,m.msg="",y.wrap&&(m.adler=1&y.wrap),y.mode=1,y.last=0,y.havedict=0,y.dmax=32768,y.head=null,y.hold=0,y.bits=0,y.lencode=y.lendyn=new sr.Buf32(852),y.distcode=y.distdyn=new sr.Buf32(592),y.sane=1,y.back=-1,0):-2}function Ae(m){var y;return m&&m.state?((y=m.state).wsize=0,y.whave=0,y.wnext=0,ke(m)):-2}function xe(m,y){var k,I;return m&&m.state?(I=m.state,y<0?(k=0,y=-y):(k=1+(y>>4),y<48&&(y&=15)),y&&(y<8||y>15)?-2:(null!==I.window&&I.wbits!==y&&(I.window=null),I.wrap=k,I.wbits=y,Ae(m))):-2}function Ee(m,y){var k,I;return m?(I=new ye,m.state=I,I.window=null,0!==(k=xe(m,y))&&(m.state=null),k):-2}var fr,gr,mr=!0;function Be(m){if(mr){var y;for(fr=new sr.Buf32(512),gr=new sr.Buf32(32),y=0;y<144;)m.lens[y++]=8;for(;y<256;)m.lens[y++]=9;for(;y<280;)m.lens[y++]=7;for(;y<288;)m.lens[y++]=8;for(be(1,m.lens,0,288,fr,0,m.work,{bits:9}),y=0;y<32;)m.lens[y++]=5;be(2,m.lens,0,32,gr,0,m.work,{bits:5}),mr=!1}m.lencode=fr,m.lenbits=9,m.distcode=gr,m.distbits=5}function Pe(m,y,k,I){var z,P=m.state;return null===P.window&&(P.wsize=1<<P.wbits,P.wnext=0,P.whave=0,P.window=new sr.Buf8(P.wsize)),I>=P.wsize?(sr.arraySet(P.window,y,k-P.wsize,P.wsize,0),P.wnext=0,P.whave=P.wsize):((z=P.wsize-P.wnext)>I&&(z=I),sr.arraySet(P.window,y,k-I,z,P.wnext),(I-=z)?(sr.arraySet(P.window,y,k-I,I,0),P.wnext=I,P.whave=P.wsize):(P.wnext+=z,P.wnext===P.wsize&&(P.wnext=0),P.whave<P.wsize&&(P.whave+=z))),0}$e.inflateReset=Ae,$e.inflateReset2=xe,$e.inflateResetKeep=ke,$e.inflateInit=function(m){return Ee(m,15)},$e.inflateInit2=Ee,$e.inflate=function(m,y){var k,I,z,P,N,O,U,B,M,j,G,H,V,q,Z,$,W,X,J,Y,K,Q,tt,et,vt=0,yt=new sr.Buf8(4),xt=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!m||!m.state||!m.output||!m.input&&0!==m.avail_in)return-2;12===(k=m.state).mode&&(k.mode=13),N=m.next_out,z=m.output,U=m.avail_out,P=m.next_in,I=m.input,O=m.avail_in,B=k.hold,M=k.bits,j=O,G=U,Q=0;t:for(;;)switch(k.mode){case 1:if(0===k.wrap){k.mode=13;break}for(;M<16;){if(0===O)break t;O--,B+=I[P++]<<M,M+=8}if(2&k.wrap&&35615===B){k.check=0,yt[0]=255&B,yt[1]=B>>>8&255,k.check=lr(k.check,yt,2,0),B=0,M=0,k.mode=2;break}if(k.flags=0,k.head&&(k.head.done=!1),!(1&k.wrap)||(((255&B)<<8)+(B>>8))%31){m.msg="incorrect header check",k.mode=30;break}if(8!=(15&B)){m.msg="unknown compression method",k.mode=30;break}if(M-=4,K=8+(15&(B>>>=4)),0===k.wbits)k.wbits=K;else if(K>k.wbits){m.msg="invalid window size",k.mode=30;break}k.dmax=1<<K,m.adler=k.check=1,k.mode=512&B?10:12,B=0,M=0;break;case 2:for(;M<16;){if(0===O)break t;O--,B+=I[P++]<<M,M+=8}if(k.flags=B,8!=(255&k.flags)){m.msg="unknown compression method",k.mode=30;break}if(57344&k.flags){m.msg="unknown header flags set",k.mode=30;break}k.head&&(k.head.text=B>>8&1),512&k.flags&&(yt[0]=255&B,yt[1]=B>>>8&255,k.check=lr(k.check,yt,2,0)),B=0,M=0,k.mode=3;case 3:for(;M<32;){if(0===O)break t;O--,B+=I[P++]<<M,M+=8}k.head&&(k.head.time=B),512&k.flags&&(yt[0]=255&B,yt[1]=B>>>8&255,yt[2]=B>>>16&255,yt[3]=B>>>24&255,k.check=lr(k.check,yt,4,0)),B=0,M=0,k.mode=4;case 4:for(;M<16;){if(0===O)break t;O--,B+=I[P++]<<M,M+=8}k.head&&(k.head.xflags=255&B,k.head.os=B>>8),512&k.flags&&(yt[0]=255&B,yt[1]=B>>>8&255,k.check=lr(k.check,yt,2,0)),B=0,M=0,k.mode=5;case 5:if(1024&k.flags){for(;M<16;){if(0===O)break t;O--,B+=I[P++]<<M,M+=8}k.length=B,k.head&&(k.head.extra_len=B),512&k.flags&&(yt[0]=255&B,yt[1]=B>>>8&255,k.check=lr(k.check,yt,2,0)),B=0,M=0}else k.head&&(k.head.extra=null);k.mode=6;case 6:if(1024&k.flags&&((H=k.length)>O&&(H=O),H&&(k.head&&(K=k.head.extra_len-k.length,k.head.extra||(k.head.extra=new Array(k.head.extra_len)),sr.arraySet(k.head.extra,I,P,H,K)),512&k.flags&&(k.check=lr(k.check,I,H,P)),O-=H,P+=H,k.length-=H),k.length))break t;k.length=0,k.mode=7;case 7:if(2048&k.flags){if(0===O)break t;H=0;do{K=I[P+H++],k.head&&K&&k.length<65536&&(k.head.name+=String.fromCharCode(K))}while(K&&H<O);if(512&k.flags&&(k.check=lr(k.check,I,H,P)),O-=H,P+=H,K)break t}else k.head&&(k.head.name=null);k.length=0,k.mode=8;case 8:if(4096&k.flags){if(0===O)break t;H=0;do{K=I[P+H++],k.head&&K&&k.length<65536&&(k.head.comment+=String.fromCharCode(K))}while(K&&H<O);if(512&k.flags&&(k.check=lr(k.check,I,H,P)),O-=H,P+=H,K)break t}else k.head&&(k.head.comment=null);k.mode=9;case 9:if(512&k.flags){for(;M<16;){if(0===O)break t;O--,B+=I[P++]<<M,M+=8}if(B!==(65535&k.check)){m.msg="header crc mismatch",k.mode=30;break}B=0,M=0}k.head&&(k.head.hcrc=k.flags>>9&1,k.head.done=!0),m.adler=k.check=0,k.mode=12;break;case 10:for(;M<32;){if(0===O)break t;O--,B+=I[P++]<<M,M+=8}m.adler=k.check=me(B),B=0,M=0,k.mode=11;case 11:if(0===k.havedict)return m.next_out=N,m.avail_out=U,m.next_in=P,m.avail_in=O,k.hold=B,k.bits=M,2;m.adler=k.check=1,k.mode=12;case 12:if(5===y||6===y)break t;case 13:if(k.last){B>>>=7&M,M-=7&M,k.mode=27;break}for(;M<3;){if(0===O)break t;O--,B+=I[P++]<<M,M+=8}switch(k.last=1&B,M-=1,3&(B>>>=1)){case 0:k.mode=14;break;case 1:if(Be(k),k.mode=20,6===y){B>>>=2,M-=2;break t}break;case 2:k.mode=17;break;case 3:m.msg="invalid block type",k.mode=30}B>>>=2,M-=2;break;case 14:for(B>>>=7&M,M-=7&M;M<32;){if(0===O)break t;O--,B+=I[P++]<<M,M+=8}if((65535&B)!=(B>>>16^65535)){m.msg="invalid stored block lengths",k.mode=30;break}if(k.length=65535&B,B=0,M=0,k.mode=15,6===y)break t;case 15:k.mode=16;case 16:if(H=k.length){if(H>O&&(H=O),H>U&&(H=U),0===H)break t;sr.arraySet(z,I,P,H,N),O-=H,P+=H,U-=H,N+=H,k.length-=H;break}k.mode=12;break;case 17:for(;M<14;){if(0===O)break t;O--,B+=I[P++]<<M,M+=8}if(k.nlen=257+(31&B),B>>>=5,M-=5,k.ndist=1+(31&B),B>>>=5,M-=5,k.ncode=4+(15&B),B>>>=4,M-=4,k.nlen>286||k.ndist>30){m.msg="too many length or distance symbols",k.mode=30;break}k.have=0,k.mode=18;case 18:for(;k.have<k.ncode;){for(;M<3;){if(0===O)break t;O--,B+=I[P++]<<M,M+=8}k.lens[xt[k.have++]]=7&B,B>>>=3,M-=3}for(;k.have<19;)k.lens[xt[k.have++]]=0;if(k.lencode=k.lendyn,k.lenbits=7,tt={bits:k.lenbits},Q=be(0,k.lens,0,19,k.lencode,0,k.work,tt),k.lenbits=tt.bits,Q){m.msg="invalid code lengths set",k.mode=30;break}k.have=0,k.mode=19;case 19:for(;k.have<k.nlen+k.ndist;){for(;$=(vt=k.lencode[B&(1<<k.lenbits)-1])>>>16&255,W=65535&vt,!((Z=vt>>>24)<=M);){if(0===O)break t;O--,B+=I[P++]<<M,M+=8}if(W<16)B>>>=Z,M-=Z,k.lens[k.have++]=W;else{if(16===W){for(et=Z+2;M<et;){if(0===O)break t;O--,B+=I[P++]<<M,M+=8}if(B>>>=Z,M-=Z,0===k.have){m.msg="invalid bit length repeat",k.mode=30;break}K=k.lens[k.have-1],H=3+(3&B),B>>>=2,M-=2}else if(17===W){for(et=Z+3;M<et;){if(0===O)break t;O--,B+=I[P++]<<M,M+=8}M-=Z,K=0,H=3+(7&(B>>>=Z)),B>>>=3,M-=3}else{for(et=Z+7;M<et;){if(0===O)break t;O--,B+=I[P++]<<M,M+=8}M-=Z,K=0,H=11+(127&(B>>>=Z)),B>>>=7,M-=7}if(k.have+H>k.nlen+k.ndist){m.msg="invalid bit length repeat",k.mode=30;break}for(;H--;)k.lens[k.have++]=K}}if(30===k.mode)break;if(0===k.lens[256]){m.msg="invalid code -- missing end-of-block",k.mode=30;break}if(k.lenbits=9,tt={bits:k.lenbits},Q=be(1,k.lens,0,k.nlen,k.lencode,0,k.work,tt),k.lenbits=tt.bits,Q){m.msg="invalid literal/lengths set",k.mode=30;break}if(k.distbits=6,k.distcode=k.distdyn,tt={bits:k.distbits},Q=be(2,k.lens,k.nlen,k.ndist,k.distcode,0,k.work,tt),k.distbits=tt.bits,Q){m.msg="invalid distances set",k.mode=30;break}if(k.mode=20,6===y)break t;case 20:k.mode=21;case 21:if(O>=6&&U>=258){m.next_out=N,m.avail_out=U,m.next_in=P,m.avail_in=O,k.hold=B,k.bits=M,ve(m,G),N=m.next_out,z=m.output,U=m.avail_out,P=m.next_in,I=m.input,O=m.avail_in,B=k.hold,M=k.bits,12===k.mode&&(k.back=-1);break}for(k.back=0;$=(vt=k.lencode[B&(1<<k.lenbits)-1])>>>16&255,W=65535&vt,!((Z=vt>>>24)<=M);){if(0===O)break t;O--,B+=I[P++]<<M,M+=8}if($&&0==(240&$)){for(X=Z,J=$,Y=W;$=(vt=k.lencode[Y+((B&(1<<X+J)-1)>>X)])>>>16&255,W=65535&vt,!(X+(Z=vt>>>24)<=M);){if(0===O)break t;O--,B+=I[P++]<<M,M+=8}B>>>=X,M-=X,k.back+=X}if(B>>>=Z,M-=Z,k.back+=Z,k.length=W,0===$){k.mode=26;break}if(32&$){k.back=-1,k.mode=12;break}if(64&$){m.msg="invalid literal/length code",k.mode=30;break}k.extra=15&$,k.mode=22;case 22:if(k.extra){for(et=k.extra;M<et;){if(0===O)break t;O--,B+=I[P++]<<M,M+=8}k.length+=B&(1<<k.extra)-1,B>>>=k.extra,M-=k.extra,k.back+=k.extra}k.was=k.length,k.mode=23;case 23:for(;$=(vt=k.distcode[B&(1<<k.distbits)-1])>>>16&255,W=65535&vt,!((Z=vt>>>24)<=M);){if(0===O)break t;O--,B+=I[P++]<<M,M+=8}if(0==(240&$)){for(X=Z,J=$,Y=W;$=(vt=k.distcode[Y+((B&(1<<X+J)-1)>>X)])>>>16&255,W=65535&vt,!(X+(Z=vt>>>24)<=M);){if(0===O)break t;O--,B+=I[P++]<<M,M+=8}B>>>=X,M-=X,k.back+=X}if(B>>>=Z,M-=Z,k.back+=Z,64&$){m.msg="invalid distance code",k.mode=30;break}k.offset=W,k.extra=15&$,k.mode=24;case 24:if(k.extra){for(et=k.extra;M<et;){if(0===O)break t;O--,B+=I[P++]<<M,M+=8}k.offset+=B&(1<<k.extra)-1,B>>>=k.extra,M-=k.extra,k.back+=k.extra}if(k.offset>k.dmax){m.msg="invalid distance too far back",k.mode=30;break}k.mode=25;case 25:if(0===U)break t;if(H=G-U,k.offset>H){if((H=k.offset-H)>k.whave&&k.sane){m.msg="invalid distance too far back",k.mode=30;break}H>k.wnext?(H-=k.wnext,V=k.wsize-H):V=k.wnext-H,H>k.length&&(H=k.length),q=k.window}else q=z,V=N-k.offset,H=k.length;H>U&&(H=U),U-=H,k.length-=H;do{z[N++]=q[V++]}while(--H);0===k.length&&(k.mode=21);break;case 26:if(0===U)break t;z[N++]=k.length,U--,k.mode=21;break;case 27:if(k.wrap){for(;M<32;){if(0===O)break t;O--,B|=I[P++]<<M,M+=8}if(G-=U,m.total_out+=G,k.total+=G,G&&(m.adler=k.check=k.flags?lr(k.check,z,G,N-G):hr(k.check,z,G,N-G)),G=U,(k.flags?B:me(B))!==k.check){m.msg="incorrect data check",k.mode=30;break}B=0,M=0}k.mode=28;case 28:if(k.wrap&&k.flags){for(;M<32;){if(0===O)break t;O--,B+=I[P++]<<M,M+=8}if(B!==(4294967295&k.total)){m.msg="incorrect length check",k.mode=30;break}B=0,M=0}k.mode=29;case 29:Q=1;break t;case 30:Q=-3;break t;case 31:return-4;default:return-2}return m.next_out=N,m.avail_out=U,m.next_in=P,m.avail_in=O,k.hold=B,k.bits=M,(k.wsize||G!==m.avail_out&&k.mode<30&&(k.mode<27||4!==y))&&Pe(m,m.output,m.next_out,G-m.avail_out),j-=m.avail_in,G-=m.avail_out,m.total_in+=j,m.total_out+=G,k.total+=G,k.wrap&&G&&(m.adler=k.check=k.flags?lr(k.check,z,G,m.next_out-G):hr(k.check,z,G,m.next_out-G)),m.data_type=k.bits+(k.last?64:0)+(12===k.mode?128:0)+(20===k.mode||15===k.mode?256:0),(0===j&&0===G||4===y)&&0===Q&&(Q=-5),Q},$e.inflateEnd=function(m){if(!m||!m.state)return-2;var y=m.state;return y.window&&(y.window=null),m.state=null,0},$e.inflateGetHeader=function(m,y){var k;return m&&m.state?0==(2&(k=m.state).wrap)?-2:(k.head=y,y.done=!1,0):-2},$e.inflateSetDictionary=function(m,y){var k,I=y.length;return m&&m.state?0!==(k=m.state).wrap&&11!==k.mode?-2:11===k.mode&&hr(1,y,I,0)!==k.check?-3:Pe(m,y,I,I)?(k.mode=31,-4):(k.havedict=1,0):-2},$e.inflateInfo="pako inflate (from Nodeca project)";var br={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8},vr=$e,wr=zt,yr=Se,xr=br,kr=pe,Ar=Qt,He=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1},Er=Object.prototype.toString;function Ge(m){if(!(this instanceof Ge))return new Ge(m);this.options=wr.assign({chunkSize:16384,windowBits:0,to:""},m||{});var y=this.options;y.raw&&y.windowBits>=0&&y.windowBits<16&&(y.windowBits=-y.windowBits,0===y.windowBits&&(y.windowBits=-15)),!(y.windowBits>=0&&y.windowBits<16)||m&&m.windowBits||(y.windowBits+=32),y.windowBits>15&&y.windowBits<48&&0==(15&y.windowBits)&&(y.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Ar,this.strm.avail_out=0;var k=vr.inflateInit2(this.strm,y.windowBits);if(k!==xr.Z_OK)throw new Error(kr[k]);if(this.header=new He,vr.inflateGetHeader(this.strm,this.header),y.dictionary&&("string"==typeof y.dictionary?y.dictionary=yr.string2buf(y.dictionary):"[object ArrayBuffer]"===Er.call(y.dictionary)&&(y.dictionary=new Uint8Array(y.dictionary)),y.raw&&(k=vr.inflateSetDictionary(this.strm,y.dictionary))!==xr.Z_OK))throw new Error(kr[k])}function Oe(m,y){var k=new Ge(y);if(k.push(m,!0),k.err)throw k.msg||kr[k.err];return k.result}Ge.prototype.push=function(m,y){var k,I,z,P,N,O=this.strm,U=this.options.chunkSize,B=this.options.dictionary,M=!1;if(this.ended)return!1;I=y===~~y?y:!0===y?xr.Z_FINISH:xr.Z_NO_FLUSH,"string"==typeof m?O.input=yr.binstring2buf(m):"[object ArrayBuffer]"===Er.call(m)?O.input=new Uint8Array(m):O.input=m,O.next_in=0,O.avail_in=O.input.length;do{if(0===O.avail_out&&(O.output=new wr.Buf8(U),O.next_out=0,O.avail_out=U),(k=vr.inflate(O,xr.Z_NO_FLUSH))===xr.Z_NEED_DICT&&B&&(k=vr.inflateSetDictionary(this.strm,B)),k===xr.Z_BUF_ERROR&&!0===M&&(k=xr.Z_OK,M=!1),k!==xr.Z_STREAM_END&&k!==xr.Z_OK)return this.onEnd(k),this.ended=!0,!1;O.next_out&&(0!==O.avail_out&&k!==xr.Z_STREAM_END&&(0!==O.avail_in||I!==xr.Z_FINISH&&I!==xr.Z_SYNC_FLUSH)||("string"===this.options.to?(z=yr.utf8border(O.output,O.next_out),P=O.next_out-z,N=yr.buf2string(O.output,z),O.next_out=P,O.avail_out=U-P,P&&wr.arraySet(O.output,O.output,z,P,0),this.onData(N)):this.onData(wr.shrinkBuf(O.output,O.next_out)))),0===O.avail_in&&0===O.avail_out&&(M=!0)}while((O.avail_in>0||0===O.avail_out)&&k!==xr.Z_STREAM_END);return k===xr.Z_STREAM_END&&(I=xr.Z_FINISH),I===xr.Z_FINISH?(k=vr.inflateEnd(this.strm),this.onEnd(k),this.ended=!0,k===xr.Z_OK):I!==xr.Z_SYNC_FLUSH||(this.onEnd(xr.Z_OK),O.avail_out=0,!0)},Ge.prototype.onData=function(m){this.chunks.push(m)},Ge.prototype.onEnd=function(m){m===xr.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=wr.flattenChunks(this.chunks)),this.chunks=[],this.err=m,this.msg=this.strm.msg},Ze.Inflate=Ge,Ze.inflate=Oe,Ze.inflateRaw=function(m,y){return(y=y||{}).raw=!0,Oe(m,y)},Ze.ungzip=Oe;var Tr={};(0,zt.assign)(Tr,Ut,Ze,br);var Ir,Cr,Sr,zr=Tr,Pr={toRGBA8:function(m){var y=m.width,k=m.height;if(null==m.tabs.acTL)return[Pr.toRGBA8.decodeImage(m.data,y,k,m).buffer];var I=[];null==m.frames[0].data&&(m.frames[0].data=m.data);for(var z=y*k*4,P=new Uint8Array(z),N=new Uint8Array(z),O=new Uint8Array(z),U=0;U<m.frames.length;U++){var B=m.frames[U],M=B.rect.x,j=B.rect.y,G=B.rect.width,H=B.rect.height,V=Pr.toRGBA8.decodeImage(B.data,G,H,m);if(0!=U)for(var q=0;q<z;q++)O[q]=P[q];if(0==B.blend?Pr._copyTile(V,G,H,P,y,k,M,j,0):1==B.blend&&Pr._copyTile(V,G,H,P,y,k,M,j,1),I.push(P.buffer.slice(0)),0==B.dispose);else if(1==B.dispose)Pr._copyTile(N,G,H,P,y,k,M,j,0);else if(2==B.dispose)for(q=0;q<z;q++)P[q]=O[q]}return I}};Pr.toRGBA8.decodeImage=function(m,y,k,I){var z=y*k,P=Pr.decode._getBPP(I),N=Math.ceil(y*P/8),O=new Uint8Array(4*z),U=new Uint32Array(O.buffer),B=I.ctype,M=I.depth,j=Pr._bin.readUshort;if(6==B){var G=z<<2;if(8==M)for(var H=0;H<G;H+=4)O[H]=m[H],O[H+1]=m[H+1],O[H+2]=m[H+2],O[H+3]=m[H+3];if(16==M)for(H=0;H<G;H++)O[H]=m[H<<1]}else if(2==B){var V=I.tabs.tRNS;if(null==V){if(8==M)for(H=0;H<z;H++){var q=3*H;U[H]=255<<24|m[q+2]<<16|m[q+1]<<8|m[q]}if(16==M)for(H=0;H<z;H++)q=6*H,U[H]=255<<24|m[q+4]<<16|m[q+2]<<8|m[q]}else{var Z=V[0],$=V[1],W=V[2];if(8==M)for(H=0;H<z;H++){var X=H<<2;q=3*H,U[H]=255<<24|m[q+2]<<16|m[q+1]<<8|m[q],m[q]==Z&&m[q+1]==$&&m[q+2]==W&&(O[X+3]=0)}if(16==M)for(H=0;H<z;H++)X=H<<2,q=6*H,U[H]=255<<24|m[q+4]<<16|m[q+2]<<8|m[q],j(m,q)==Z&&j(m,q+2)==$&&j(m,q+4)==W&&(O[X+3]=0)}}else if(3==B){var J=I.tabs.PLTE,Y=I.tabs.tRNS,K=Y?Y.length:0;if(1==M)for(var Q=0;Q<k;Q++){var tt=Q*N,et=Q*y;for(H=0;H<y;H++){X=et+H<<2;var vt=3*(yt=m[tt+(H>>3)]>>7-((7&H)<<0)&1);O[X]=J[vt],O[X+1]=J[vt+1],O[X+2]=J[vt+2],O[X+3]=yt<K?Y[yt]:255}}if(2==M)for(Q=0;Q<k;Q++)for(tt=Q*N,et=Q*y,H=0;H<y;H++)X=et+H<<2,vt=3*(yt=m[tt+(H>>2)]>>6-((3&H)<<1)&3),O[X]=J[vt],O[X+1]=J[vt+1],O[X+2]=J[vt+2],O[X+3]=yt<K?Y[yt]:255;if(4==M)for(Q=0;Q<k;Q++)for(tt=Q*N,et=Q*y,H=0;H<y;H++)X=et+H<<2,vt=3*(yt=m[tt+(H>>1)]>>4-((1&H)<<2)&15),O[X]=J[vt],O[X+1]=J[vt+1],O[X+2]=J[vt+2],O[X+3]=yt<K?Y[yt]:255;if(8==M)for(H=0;H<z;H++){var yt;X=H<<2,vt=3*(yt=m[H]),O[X]=J[vt],O[X+1]=J[vt+1],O[X+2]=J[vt+2],O[X+3]=yt<K?Y[yt]:255}}else if(4==B){if(8==M)for(H=0;H<z;H++){X=H<<2;var xt=m[kt=H<<1];O[X]=xt,O[X+1]=xt,O[X+2]=xt,O[X+3]=m[kt+1]}if(16==M)for(H=0;H<z;H++){var kt;X=H<<2,xt=m[kt=H<<2],O[X]=xt,O[X+1]=xt,O[X+2]=xt,O[X+3]=m[kt+2]}}else if(0==B)for(Z=I.tabs.tRNS?I.tabs.tRNS:-1,Q=0;Q<k;Q++){var Et=Q*N,It=Q*y;if(1==M)for(var zt=0;zt<y;zt++){var Ut=(xt=255*(m[Et+(zt>>>3)]>>>7-(7&zt)&1))==255*Z?0:255;U[It+zt]=Ut<<24|xt<<16|xt<<8|xt}else if(2==M)for(zt=0;zt<y;zt++)Ut=(xt=85*(m[Et+(zt>>>2)]>>>6-((3&zt)<<1)&3))==85*Z?0:255,U[It+zt]=Ut<<24|xt<<16|xt<<8|xt;else if(4==M)for(zt=0;zt<y;zt++)Ut=(xt=17*(m[Et+(zt>>>1)]>>>4-((1&zt)<<2)&15))==17*Z?0:255,U[It+zt]=Ut<<24|xt<<16|xt<<8|xt;else if(8==M)for(zt=0;zt<y;zt++)Ut=(xt=m[Et+zt])==Z?0:255,U[It+zt]=Ut<<24|xt<<16|xt<<8|xt;else if(16==M)for(zt=0;zt<y;zt++)xt=m[Et+(zt<<1)],Ut=j(m,Et+(zt<<H))==Z?0:255,U[It+zt]=Ut<<24|xt<<16|xt<<8|xt}return O},Pr.decode=function(m){for(var y,k=new Uint8Array(m),I=8,z=Pr._bin,P=z.readUshort,N=z.readUint,O={tabs:{},frames:[]},U=new Uint8Array(k.length),B=0,M=0,j=[137,80,78,71,13,10,26,10],G=0;G<8;G++)if(k[G]!=j[G])throw"The input is not a PNG file!";for(;I<k.length;){var H=z.readUint(k,I);I+=4;var V=z.readASCII(k,I,4);if(I+=4,"IHDR"==V)Pr.decode._IHDR(k,I,O);else if("IDAT"==V){for(G=0;G<H;G++)U[B+G]=k[I+G];B+=H}else if("acTL"==V)O.tabs[V]={num_frames:N(k,I),num_plays:N(k,I+4)},y=new Uint8Array(k.length);else if("fcTL"==V){var q;0!=M&&((q=O.frames[O.frames.length-1]).data=Pr.decode._decompress(O,y.slice(0,M),q.rect.width,q.rect.height),M=0);var Z={x:N(k,I+12),y:N(k,I+16),width:N(k,I+4),height:N(k,I+8)},$=P(k,I+22);$=P(k,I+20)/(0==$?100:$);var W={rect:Z,delay:Math.round(1e3*$),dispose:k[I+24],blend:k[I+25]};O.frames.push(W)}else if("fdAT"==V){for(G=0;G<H-4;G++)y[M+G]=k[I+G+4];M+=H-4}else if("pHYs"==V)O.tabs[V]=[z.readUint(k,I),z.readUint(k,I+4),k[I+8]];else if("cHRM"==V)for(O.tabs[V]=[],G=0;G<8;G++)O.tabs[V].push(z.readUint(k,I+4*G));else if("tEXt"==V){null==O.tabs[V]&&(O.tabs[V]={});var X=z.nextZero(k,I),J=z.readASCII(k,I,X-I),Y=z.readASCII(k,X+1,I+H-X-1);O.tabs[V][J]=Y}else if("iTXt"==V){null==O.tabs[V]&&(O.tabs[V]={}),X=0;var K=I;X=z.nextZero(k,K),J=z.readASCII(k,K,X-K),k[K=X+1],k[K+1],K+=2,X=z.nextZero(k,K),z.readASCII(k,K,X-K),K=X+1,X=z.nextZero(k,K),z.readUTF8(k,K,X-K),K=X+1,Y=z.readUTF8(k,K,H-(K-I)),O.tabs[V][J]=Y}else if("PLTE"==V)O.tabs[V]=z.readBytes(k,I,H);else if("hIST"==V){var Q=O.tabs.PLTE.length/3;for(O.tabs[V]=[],G=0;G<Q;G++)O.tabs[V].push(P(k,I+2*G))}else if("tRNS"==V)3==O.ctype?O.tabs[V]=z.readBytes(k,I,H):0==O.ctype?O.tabs[V]=P(k,I):2==O.ctype&&(O.tabs[V]=[P(k,I),P(k,I+2),P(k,I+4)]);else if("gAMA"==V)O.tabs[V]=z.readUint(k,I)/1e5;else if("sRGB"==V)O.tabs[V]=k[I];else if("bKGD"==V)0==O.ctype||4==O.ctype?O.tabs[V]=[P(k,I)]:2==O.ctype||6==O.ctype?O.tabs[V]=[P(k,I),P(k,I+2),P(k,I+4)]:3==O.ctype&&(O.tabs[V]=k[I]);else if("IEND"==V)break;I+=H,z.readUint(k,I),I+=4}return 0!=M&&((q=O.frames[O.frames.length-1]).data=Pr.decode._decompress(O,y.slice(0,M),q.rect.width,q.rect.height),M=0),O.data=Pr.decode._decompress(O,U,O.width,O.height),delete O.compress,delete O.interlace,delete O.filter,O},Pr.decode._decompress=function(m,y,k,I){var z=Pr.decode._getBPP(m),P=Math.ceil(k*z/8),N=new Uint8Array((P+1+m.interlace)*I);return y=Pr.decode._inflate(y,N),0==m.interlace?y=Pr.decode._filterZero(y,m,0,k,I):1==m.interlace&&(y=Pr.decode._readInterlace(y,m)),y},Pr.decode._inflate=function(m,y){return Pr.inflateRaw(new Uint8Array(m.buffer,2,m.length-6),y)},Pr.inflateRaw=((Sr={}).H={},Sr.H.N=function(m,y){var k,I,z=Uint8Array,P=0,N=0,O=0,U=0,B=0,M=0,j=0,G=0,H=0;if(3==m[0]&&0==m[1])return y||new z(0);var V=Sr.H,q=V.b,Z=V.e,$=V.R,W=V.n,X=V.A,J=V.Z,Y=V.m,K=null==y;for(K&&(y=new z(m.length>>>2<<3));0==P;)if(P=q(m,H,1),N=q(m,H+1,2),H+=3,0!=N){if(K&&(y=Sr.H.W(y,G+(1<<17))),1==N&&(k=Y.J,I=Y.h,M=511,j=31),2==N){O=Z(m,H,5)+257,U=Z(m,H+5,5)+1,B=Z(m,H+10,4)+4,H+=14;for(var Q=1,tt=0;tt<38;tt+=2)Y.Q[tt]=0,Y.Q[tt+1]=0;for(tt=0;tt<B;tt++){var et=Z(m,H+3*tt,3);Y.Q[1+(Y.X[tt]<<1)]=et,et>Q&&(Q=et)}H+=3*B,W(Y.Q,Q),X(Y.Q,Q,Y.u),k=Y.w,I=Y.d,H=$(Y.u,(1<<Q)-1,O+U,m,H,Y.v);var vt=V.V(Y.v,0,O,Y.C);M=(1<<vt)-1;var yt=V.V(Y.v,O,U,Y.D);j=(1<<yt)-1,W(Y.C,vt),X(Y.C,vt,k),W(Y.D,yt),X(Y.D,yt,I)}for(;;){var xt=k[J(m,H)&M];H+=15&xt;var kt=xt>>>4;if(kt>>>8==0)y[G++]=kt;else{if(256==kt)break;var Et=G+kt-254;if(kt>264){var It=Y.q[kt-257];Et=G+(It>>>3)+Z(m,H,7&It),H+=7&It}var zt=I[J(m,H)&j];H+=15&zt;var Ut=zt>>>4,Bt=Y.c[Ut],jt=(Bt>>>4)+q(m,H,15&Bt);for(H+=15&Bt;G<Et;)y[G]=y[G++-jt],y[G]=y[G++-jt],y[G]=y[G++-jt],y[G]=y[G++-jt];G=Et}}}else{0!=(7&H)&&(H+=8-(7&H));var Wt=4+(H>>>3),Xt=m[Wt-4]|m[Wt-3]<<8;K&&(y=Sr.H.W(y,G+Xt)),y.set(new z(m.buffer,m.byteOffset+Wt,Xt),G),H=Wt+Xt<<3,G+=Xt}return y.length==G?y:y.slice(0,G)},Sr.H.W=function(m,y){var k=m.length;if(y<=k)return m;var I=new Uint8Array(k<<1);return I.set(m,0),I},Sr.H.R=function(m,y,k,I,z,P){for(var N=Sr.H.e,O=Sr.H.Z,U=0;U<k;){var B=m[O(I,z)&y];z+=15&B;var M=B>>>4;if(M<=15)P[U]=M,U++;else{var j=0,G=0;16==M?(G=3+N(I,z,2),z+=2,j=P[U-1]):17==M?(G=3+N(I,z,3),z+=3):18==M&&(G=11+N(I,z,7),z+=7);for(var H=U+G;U<H;)P[U]=j,U++}}return z},Sr.H.V=function(m,y,k,I){for(var z=0,P=0,N=I.length>>>1;P<k;){var O=m[P+y];I[P<<1]=0,I[1+(P<<1)]=O,O>z&&(z=O),P++}for(;P<N;)I[P<<1]=0,I[1+(P<<1)]=0,P++;return z},Sr.H.n=function(m,y){for(var k,I,z,P,N=Sr.H.m,O=m.length,U=N.j,B=0;B<=y;B++)U[B]=0;for(B=1;B<O;B+=2)U[m[B]]++;var M=N.K;for(k=0,U[0]=0,I=1;I<=y;I++)k=k+U[I-1]<<1,M[I]=k;for(z=0;z<O;z+=2)0!=(P=m[z+1])&&(m[z]=M[P],M[P]++)},Sr.H.A=function(m,y,k){for(var I=m.length,z=Sr.H.m.r,P=0;P<I;P+=2)if(0!=m[P+1])for(var N=P>>1,O=m[P+1],U=N<<4|O,B=y-O,M=m[P]<<B,j=M+(1<<B);M!=j;)k[z[M]>>>15-y]=U,M++},Sr.H.l=function(m,y){for(var k=Sr.H.m.r,I=15-y,z=0;z<m.length;z+=2){var P=m[z]<<y-m[z+1];m[z]=k[P]>>>I}},Sr.H.M=function(m,y,k){k<<=7&y;var I=y>>>3;m[I]|=k,m[I+1]|=k>>>8},Sr.H.I=function(m,y,k){k<<=7&y;var I=y>>>3;m[I]|=k,m[I+1]|=k>>>8,m[I+2]|=k>>>16},Sr.H.e=function(m,y,k){return(m[y>>>3]|m[1+(y>>>3)]<<8)>>>(7&y)&(1<<k)-1},Sr.H.b=function(m,y,k){return(m[y>>>3]|m[1+(y>>>3)]<<8|m[2+(y>>>3)]<<16)>>>(7&y)&(1<<k)-1},Sr.H.Z=function(m,y){return(m[y>>>3]|m[1+(y>>>3)]<<8|m[2+(y>>>3)]<<16)>>>(7&y)},Sr.H.i=function(m,y){return(m[y>>>3]|m[1+(y>>>3)]<<8|m[2+(y>>>3)]<<16|m[3+(y>>>3)]<<24)>>>(7&y)},Sr.H.m=(Ir=Uint16Array,Cr=Uint32Array,{K:new Ir(16),j:new Ir(16),X:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],S:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],T:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],q:new Ir(32),p:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],z:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],c:new Cr(32),J:new Ir(512),_:[],h:new Ir(32),$:[],w:new Ir(32768),C:[],v:[],d:new Ir(32768),D:[],u:new Ir(512),Q:[],r:new Ir(32768),s:new Cr(286),Y:new Cr(30),a:new Cr(19),t:new Cr(15e3),k:new Ir(65536),g:new Ir(32768)}),function(){for(var m=Sr.H.m,y=0;y<32768;y++){var k=y;k=(4278255360&(k=(4042322160&(k=(3435973836&(k=(2863311530&k)>>>1|(1431655765&k)<<1))>>>2|(858993459&k)<<2))>>>4|(252645135&k)<<4))>>>8|(16711935&k)<<8,m.r[y]=(k>>>16|k<<16)>>>17}function i(m,y,k){for(;0!=y--;)m.push(0,k)}for(y=0;y<32;y++)m.q[y]=m.S[y]<<3|m.T[y],m.c[y]=m.p[y]<<4|m.z[y];i(m._,144,8),i(m._,112,9),i(m._,24,7),i(m._,8,8),Sr.H.n(m._,9),Sr.H.A(m._,9,m.J),Sr.H.l(m._,9),i(m.$,32,5),Sr.H.n(m.$,5),Sr.H.A(m.$,5,m.h),Sr.H.l(m.$,5),i(m.Q,19,0),i(m.C,286,0),i(m.D,30,0),i(m.v,320,0)}(),Sr.H.N),Pr.decode._readInterlace=function(m,y){for(var k=y.width,I=y.height,z=Pr.decode._getBPP(y),P=z>>3,N=Math.ceil(k*z/8),O=new Uint8Array(I*N),U=0,B=[0,0,4,0,2,0,1],M=[0,4,0,2,0,1,0],j=[8,8,8,4,4,2,2],G=[8,8,4,4,2,2,1],H=0;H<7;){for(var V=j[H],q=G[H],Z=0,$=0,W=B[H];W<I;)W+=V,$++;for(var X=M[H];X<k;)X+=q,Z++;var J=Math.ceil(Z*z/8);Pr.decode._filterZero(m,y,U,Z,$);for(var Y=0,K=B[H];K<I;){for(var Q=M[H],tt=U+Y*J<<3;Q<k;){var et;if(1==z&&(et=(et=m[tt>>3])>>7-(7&tt)&1,O[K*N+(Q>>3)]|=et<<7-((7&Q)<<0)),2==z&&(et=(et=m[tt>>3])>>6-(7&tt)&3,O[K*N+(Q>>2)]|=et<<6-((3&Q)<<1)),4==z&&(et=(et=m[tt>>3])>>4-(7&tt)&15,O[K*N+(Q>>1)]|=et<<4-((1&Q)<<2)),z>=8)for(var vt=K*N+Q*P,yt=0;yt<P;yt++)O[vt+yt]=m[(tt>>3)+yt];tt+=z,Q+=q}Y++,K+=V}Z*$!=0&&(U+=$*(1+J)),H+=1}return O},Pr.decode._getBPP=function(m){return[1,null,3,1,2,null,4][m.ctype]*m.depth},Pr.decode._filterZero=function(m,y,k,I,z){var P=Pr.decode._getBPP(y),N=Math.ceil(I*P/8),O=Pr.decode._paeth;P=Math.ceil(P/8);var U=0,B=1,M=m[k],j=0;if(M>1&&(m[k]=[0,0,1][M-2]),3==M)for(j=P;j<N;j++)m[j+1]=m[j+1]+(m[j+1-P]>>>1)&255;for(var G=0;G<z;G++)if(j=0,0==(M=m[(B=(U=k+G*N)+G+1)-1]))for(;j<N;j++)m[U+j]=m[B+j];else if(1==M){for(;j<P;j++)m[U+j]=m[B+j];for(;j<N;j++)m[U+j]=m[B+j]+m[U+j-P]}else if(2==M)for(;j<N;j++)m[U+j]=m[B+j]+m[U+j-N];else if(3==M){for(;j<P;j++)m[U+j]=m[B+j]+(m[U+j-N]>>>1);for(;j<N;j++)m[U+j]=m[B+j]+(m[U+j-N]+m[U+j-P]>>>1)}else{for(;j<P;j++)m[U+j]=m[B+j]+O(0,m[U+j-N],0);for(;j<N;j++)m[U+j]=m[B+j]+O(m[U+j-P],m[U+j-N],m[U+j-P-N])}return m},Pr.decode._paeth=function(m,y,k){var I=m+y-k,z=I-m,P=I-y,N=I-k;return z*z<=P*P&&z*z<=N*N?m:P*P<=N*N?y:k},Pr.decode._IHDR=function(m,y,k){var I=Pr._bin;k.width=I.readUint(m,y),y+=4,k.height=I.readUint(m,y),y+=4,k.depth=m[y],y++,k.ctype=m[y],y++,k.compress=m[y],y++,k.filter=m[y],y++,k.interlace=m[y],y++},Pr._bin={nextZero:function(m,y){for(;0!=m[y];)y++;return y},readUshort:function(m,y){return m[y]<<8|m[y+1]},writeUshort:function(m,y,k){m[y]=k>>8&255,m[y+1]=255&k},readUint:function(m,y){return 16777216*m[y]+(m[y+1]<<16|m[y+2]<<8|m[y+3])},writeUint:function(m,y,k){m[y]=k>>24&255,m[y+1]=k>>16&255,m[y+2]=k>>8&255,m[y+3]=255&k},readASCII:function(m,y,k){for(var I="",z=0;z<k;z++)I+=String.fromCharCode(m[y+z]);return I},writeASCII:function(m,y,k){for(var I=0;I<k.length;I++)m[y+I]=k.charCodeAt(I)},readBytes:function(m,y,k){for(var I=[],z=0;z<k;z++)I.push(m[y+z]);return I},pad:function(m){return m.length<2?"0"+m:m},readUTF8:function(m,y,k){for(var I,z="",P=0;P<k;P++)z+="%"+Pr._bin.pad(m[y+P].toString(16));try{I=decodeURIComponent(z)}catch(I){return Pr._bin.readASCII(m,y,k)}return I}},Pr._copyTile=function(m,y,k,I,z,P,N,O,U){for(var B=Math.min(y,z),M=Math.min(k,P),j=0,G=0,H=0;H<M;H++)for(var V=0;V<B;V++)if(N>=0&&O>=0?(j=H*y+V<<2,G=(O+H)*z+N+V<<2):(j=(-O+H)*y-N+V<<2,G=H*z+V<<2),0==U)I[G]=m[j],I[G+1]=m[j+1],I[G+2]=m[j+2],I[G+3]=m[j+3];else if(1==U){var q=m[j+3]*(1/255),Z=m[j]*q,$=m[j+1]*q,W=m[j+2]*q,X=I[G+3]*(1/255),J=I[G]*X,Y=I[G+1]*X,K=I[G+2]*X,Q=1-q,tt=q+X*Q,et=0==tt?0:1/tt;I[G+3]=255*tt,I[G+0]=(Z+J*Q)*et,I[G+1]=($+Y*Q)*et,I[G+2]=(W+K*Q)*et}else if(2==U)q=m[j+3],Z=m[j],$=m[j+1],W=m[j+2],X=I[G+3],J=I[G],Y=I[G+1],K=I[G+2],q==X&&Z==J&&$==Y&&W==K?(I[G]=0,I[G+1]=0,I[G+2]=0,I[G+3]=0):(I[G]=Z,I[G+1]=$,I[G+2]=W,I[G+3]=q);else if(3==U){if(q=m[j+3],Z=m[j],$=m[j+1],W=m[j+2],X=I[G+3],J=I[G],Y=I[G+1],K=I[G+2],q==X&&Z==J&&$==Y&&W==K)continue;if(q<220&&X>20)return!1}return!0},Pr.encode=function(m,y,k,I,z,P,N){null==I&&(I=0),null==N&&(N=!1);var O=Pr.encode.compress(m,y,k,I,[!1,!1,!1,0,N]);return Pr.encode.compressPNG(O,-1),Pr.encode._main(O,y,k,z,P)},Pr.encodeLL=function(m,y,k,I,z,P,N,O){for(var U={ctype:0+(1==I?0:2)+(0==z?0:4),depth:P,frames:[]},B=(I+z)*P,M=B*y,j=0;j<m.length;j++)U.frames.push({rect:{x:0,y:0,width:y,height:k},img:new Uint8Array(m[j]),blend:0,dispose:1,bpp:Math.ceil(B/8),bpl:Math.ceil(M/8)});return Pr.encode.compressPNG(U,0,!0),Pr.encode._main(U,y,k,N,O)},Pr.encode._main=function(m,y,k,I,z){null==z&&(z={});var P=Pr.crc.crc,N=Pr._bin.writeUint,O=Pr._bin.writeUshort,U=Pr._bin.writeASCII,B=8,M=m.frames.length>1,j=!1,G=33+(M?20:0);if(null!=z.sRGB&&(G+=13),null!=z.pHYs&&(G+=21),3==m.ctype){for(var H=m.plte.length,V=0;V<H;V++)m.plte[V]>>>24!=255&&(j=!0);G+=8+3*H+4+(j?8+1*H+4:0)}for(var q=0;q<m.frames.length;q++)M&&(G+=38),G+=(tt=m.frames[q]).cimg.length+12,0!=q&&(G+=4);G+=12;var Z=new Uint8Array(G),$=[137,80,78,71,13,10,26,10];for(V=0;V<8;V++)Z[V]=$[V];if(N(Z,B,13),U(Z,B+=4,"IHDR"),N(Z,B+=4,y),N(Z,B+=4,k),Z[B+=4]=m.depth,Z[++B]=m.ctype,Z[++B]=0,Z[++B]=0,Z[++B]=0,N(Z,++B,P(Z,B-17,17)),B+=4,null!=z.sRGB&&(N(Z,B,1),U(Z,B+=4,"sRGB"),Z[B+=4]=z.sRGB,N(Z,++B,P(Z,B-5,5)),B+=4),null!=z.pHYs&&(N(Z,B,9),U(Z,B+=4,"pHYs"),N(Z,B+=4,z.pHYs[0]),N(Z,B+=4,z.pHYs[1]),Z[B+=4]=z.pHYs[2],N(Z,++B,P(Z,B-13,13)),B+=4),M&&(N(Z,B,8),U(Z,B+=4,"acTL"),N(Z,B+=4,m.frames.length),N(Z,B+=4,null!=z.loop?z.loop:0),N(Z,B+=4,P(Z,B-12,12)),B+=4),3==m.ctype){for(N(Z,B,3*(H=m.plte.length)),U(Z,B+=4,"PLTE"),B+=4,V=0;V<H;V++){var W=3*V,X=m.plte[V],J=255&X,Y=X>>>8&255,K=X>>>16&255;Z[B+W+0]=J,Z[B+W+1]=Y,Z[B+W+2]=K}if(N(Z,B+=3*H,P(Z,B-3*H-4,3*H+4)),B+=4,j){for(N(Z,B,H),U(Z,B+=4,"tRNS"),B+=4,V=0;V<H;V++)Z[B+V]=m.plte[V]>>>24&255;N(Z,B+=H,P(Z,B-H-4,H+4)),B+=4}}var Q=0;for(q=0;q<m.frames.length;q++){var tt=m.frames[q];M&&(N(Z,B,26),U(Z,B+=4,"fcTL"),N(Z,B+=4,Q++),N(Z,B+=4,tt.rect.width),N(Z,B+=4,tt.rect.height),N(Z,B+=4,tt.rect.x),N(Z,B+=4,tt.rect.y),O(Z,B+=4,I[q]),O(Z,B+=2,1e3),Z[B+=2]=tt.dispose,Z[++B]=tt.blend,N(Z,++B,P(Z,B-30,30)),B+=4);var et=tt.cimg;N(Z,B,(H=et.length)+(0==q?0:4));var vt=B+=4;U(Z,B,0==q?"IDAT":"fdAT"),B+=4,0!=q&&(N(Z,B,Q++),B+=4),Z.set(et,B),N(Z,B+=H,P(Z,vt,B-vt)),B+=4}return N(Z,B,0),U(Z,B+=4,"IEND"),N(Z,B+=4,P(Z,B-4,4)),B+=4,Z.buffer},Pr.encode.compressPNG=function(m,y,k){for(var I=0;I<m.frames.length;I++){var z=m.frames[I];z.rect.width;var P=z.rect.height,N=new Uint8Array(P*z.bpl+P);z.cimg=Pr.encode._filterZero(z.img,P,z.bpp,z.bpl,N,y,k)}},Pr.encode.compress=function(m,y,k,I,z){for(var P=z[0],N=z[1],O=z[2],U=z[3],B=z[4],M=6,j=8,G=255,H=0;H<m.length;H++)for(var V=new Uint8Array(m[H]),q=V.length,Z=0;Z<q;Z+=4)G&=V[Z+3];var $=255!=G,W=Pr.encode.framize(m,y,k,P,N,O),X={},J=[],Y=[];if(0!=I){var K=[];for(Z=0;Z<W.length;Z++)K.push(W[Z].img.buffer);var Q=Pr.encode.concatRGBA(K),tt=Pr.quantize(Q,I),et=0,vt=new Uint8Array(tt.abuf);for(Z=0;Z<W.length;Z++){var yt=(ne=W[Z].img).length;for(Y.push(new Uint8Array(tt.inds.buffer,et>>2,yt>>2)),H=0;H<yt;H+=4)ne[H]=vt[et+H],ne[H+1]=vt[et+H+1],ne[H+2]=vt[et+H+2],ne[H+3]=vt[et+H+3];et+=yt}for(Z=0;Z<tt.plte.length;Z++)J.push(tt.plte[Z].est.rgba)}else for(H=0;H<W.length;H++){var xt=W[H],kt=new Uint32Array(xt.img.buffer),Et=xt.rect.width,It=(q=kt.length,new Uint8Array(q));for(Y.push(It),Z=0;Z<q;Z++){var zt=kt[Z];if(0!=Z&&zt==kt[Z-1])It[Z]=It[Z-1];else if(Z>Et&&zt==kt[Z-Et])It[Z]=It[Z-Et];else{var Ut=X[zt];if(null==Ut&&(X[zt]=Ut=J.length,J.push(zt),J.length>=300))break;It[Z]=Ut}}}var Bt=J.length;for(Bt<=256&&0==B&&(j=Bt<=2?1:Bt<=4?2:Bt<=16?4:8,j=Math.max(j,U)),H=0;H<W.length;H++){(xt=W[H]).rect.x,xt.rect.y,Et=xt.rect.width;var jt=xt.rect.height,Wt=xt.img;new Uint32Array(Wt.buffer);var Xt=4*Et,Jt=4;if(Bt<=256&&0==B){Xt=Math.ceil(j*Et/8);for(var Yt=new Uint8Array(Xt*jt),Kt=Y[H],te=0;te<jt;te++){Z=te*Xt;var ee=te*Et;if(8==j)for(var re=0;re<Et;re++)Yt[Z+re]=Kt[ee+re];else if(4==j)for(re=0;re<Et;re++)Yt[Z+(re>>1)]|=Kt[ee+re]<<4-4*(1&re);else if(2==j)for(re=0;re<Et;re++)Yt[Z+(re>>2)]|=Kt[ee+re]<<6-2*(3&re);else if(1==j)for(re=0;re<Et;re++)Yt[Z+(re>>3)]|=Kt[ee+re]<<7-1*(7&re)}Wt=Yt,M=3,Jt=1}else if(0==$&&1==W.length){Yt=new Uint8Array(Et*jt*3);var ie=Et*jt;for(Z=0;Z<ie;Z++){var ne,ae=4*Z;Yt[ne=3*Z]=Wt[ae],Yt[ne+1]=Wt[ae+1],Yt[ne+2]=Wt[ae+2]}Wt=Yt,M=2,Jt=3,Xt=3*Et}xt.img=Wt,xt.bpl=Xt,xt.bpp=Jt}return{ctype:M,depth:j,plte:J,frames:W}},Pr.encode.framize=function(m,y,k,I,z,P){for(var N=[],O=0;O<m.length;O++){var U,B=new Uint8Array(m[O]),M=new Uint32Array(B.buffer),j=0,G=0,H=y,V=k,q=I?1:0;if(0!=O){for(var Z=P||I||1==O||0!=N[O-2].dispose?1:2,$=0,W=1e9,X=0;X<Z;X++){for(var J=new Uint8Array(m[O-1-X]),Y=new Uint32Array(m[O-1-X]),K=y,Q=k,tt=-1,et=-1,vt=0;vt<k;vt++)for(var yt=0;yt<y;yt++)M[Bt=vt*y+yt]!=Y[Bt]&&(yt<K&&(K=yt),yt>tt&&(tt=yt),vt<Q&&(Q=vt),vt>et&&(et=vt));-1==tt&&(K=Q=tt=et=0),z&&(1==(1&K)&&K--,1==(1&Q)&&Q--);var xt=(tt-K+1)*(et-Q+1);xt<W&&(W=xt,$=X,j=K,G=Q,H=tt-K+1,V=et-Q+1)}J=new Uint8Array(m[O-1-$]),1==$&&(N[O-1].dispose=2),U=new Uint8Array(H*V*4),Pr._copyTile(J,y,k,U,H,V,-j,-G,0),1==(q=Pr._copyTile(B,y,k,U,H,V,-j,-G,3)?1:0)?Pr.encode._prepareDiff(B,y,k,U,{x:j,y:G,width:H,height:V}):Pr._copyTile(B,y,k,U,H,V,-j,-G,0)}else U=B.slice(0);N.push({rect:{x:j,y:G,width:H,height:V},img:U,blend:q,dispose:0})}if(I)for(O=0;O<N.length;O++)if(1!=(jt=N[O]).blend){var kt=jt.rect,Et=N[O-1].rect,It=Math.min(kt.x,Et.x),zt=Math.min(kt.y,Et.y),Ut={x:It,y:zt,width:Math.max(kt.x+kt.width,Et.x+Et.width)-It,height:Math.max(kt.y+kt.height,Et.y+Et.height)-zt};N[O-1].dispose=1,O-1!=0&&Pr.encode._updateFrame(m,y,k,N,O-1,Ut,z),Pr.encode._updateFrame(m,y,k,N,O,Ut,z)}if(1!=m.length)for(var Bt=0;Bt<N.length;Bt++){var jt;(jt=N[Bt]).rect.width,jt.rect.height}return N},Pr.encode._updateFrame=function(m,y,k,I,z,P,N){for(var O=Uint8Array,U=Uint32Array,B=new O(m[z-1]),M=new U(m[z-1]),j=z+1<m.length?new O(m[z+1]):null,G=new O(m[z]),H=new U(G.buffer),V=y,q=k,Z=-1,$=-1,W=0;W<P.height;W++)for(var X=0;X<P.width;X++){var J=P.x+X,Y=P.y+W,K=Y*y+J,Q=H[K];0==Q||0==I[z-1].dispose&&M[K]==Q&&(null==j||0!=j[4*K+3])||(J<V&&(V=J),J>Z&&(Z=J),Y<q&&(q=Y),Y>$&&($=Y))}-1==Z&&(V=q=Z=$=0),N&&(1==(1&V)&&V--,1==(1&q)&&q--),P={x:V,y:q,width:Z-V+1,height:$-q+1};var tt=I[z];tt.rect=P,tt.blend=1,tt.img=new Uint8Array(P.width*P.height*4),0==I[z-1].dispose?(Pr._copyTile(B,y,k,tt.img,P.width,P.height,-P.x,-P.y,0),Pr.encode._prepareDiff(G,y,k,tt.img,P)):Pr._copyTile(G,y,k,tt.img,P.width,P.height,-P.x,-P.y,0)},Pr.encode._prepareDiff=function(m,y,k,I,z){Pr._copyTile(m,y,k,I,z.width,z.height,-z.x,-z.y,2)},Pr.encode._filterZero=function(m,y,k,I,z,P,N){var O,U=[],B=[0,1,2,3,4];-1!=P?B=[P]:(y*I>5e5||1==k)&&(B=[0]),N&&(O={level:0});for(var M=N&&null!=UZIP?UZIP:zr,j=0;j<B.length;j++){for(var G=0;G<y;G++)Pr.encode._filterLine(z,m,G,I,k,B[j]);U.push(M.deflate(z,O))}var H,V=1e9;for(j=0;j<U.length;j++)U[j].length<V&&(H=j,V=U[j].length);return U[H]},Pr.encode._filterLine=function(m,y,k,I,z,P){var N=k*I,O=N+k,U=Pr.decode._paeth;if(m[O]=P,O++,0==P)if(I<500)for(var B=0;B<I;B++)m[O+B]=y[N+B];else m.set(new Uint8Array(y.buffer,N,I),O);else if(1==P){for(B=0;B<z;B++)m[O+B]=y[N+B];for(B=z;B<I;B++)m[O+B]=y[N+B]-y[N+B-z]+256&255}else if(0==k){for(B=0;B<z;B++)m[O+B]=y[N+B];if(2==P)for(B=z;B<I;B++)m[O+B]=y[N+B];if(3==P)for(B=z;B<I;B++)m[O+B]=y[N+B]-(y[N+B-z]>>1)+256&255;if(4==P)for(B=z;B<I;B++)m[O+B]=y[N+B]-U(y[N+B-z],0,0)+256&255}else{if(2==P)for(B=0;B<I;B++)m[O+B]=y[N+B]+256-y[N+B-I]&255;if(3==P){for(B=0;B<z;B++)m[O+B]=y[N+B]+256-(y[N+B-I]>>1)&255;for(B=z;B<I;B++)m[O+B]=y[N+B]+256-(y[N+B-I]+y[N+B-z]>>1)&255}if(4==P){for(B=0;B<z;B++)m[O+B]=y[N+B]+256-U(0,y[N+B-I],0)&255;for(B=z;B<I;B++)m[O+B]=y[N+B]+256-U(y[N+B-z],y[N+B-I],y[N+B-z-I])&255}}},Pr.crc={table:function(){for(var m=new Uint32Array(256),y=0;y<256;y++){for(var k=y,I=0;I<8;I++)1&k?k=3988292384^k>>>1:k>>>=1;m[y]=k}return m}(),update:function(m,y,k,I){for(var z=0;z<I;z++)m=Pr.crc.table[255&(m^y[k+z])]^m>>>8;return m},crc:function(m,y,k){return 4294967295^Pr.crc.update(4294967295,m,y,k)}},Pr.quantize=function(m,y){var k=new Uint8Array(m),I=k.slice(0),z=new Uint32Array(I.buffer),P=Pr.quantize.getKDtree(I,y),N=P[0],O=P[1];Pr.quantize.planeDst;for(var U=k,B=z,M=U.length,j=new Uint8Array(k.length>>2),G=0;G<M;G+=4){var H=U[G]*(1/255),V=U[G+1]*(1/255),q=U[G+2]*(1/255),Z=U[G+3]*(1/255),$=Pr.quantize.getNearest(N,H,V,q,Z);j[G>>2]=$.ind,B[G>>2]=$.est.rgba}return{abuf:I.buffer,inds:j,plte:O}},Pr.quantize.getKDtree=function(m,y,k){null==k&&(k=1e-4);var I=new Uint32Array(m.buffer),z={i0:0,i1:m.length,bst:null,est:null,tdst:0,left:null,right:null};z.bst=Pr.quantize.stats(m,z.i0,z.i1),z.est=Pr.quantize.estats(z.bst);for(var P=[z];P.length<y;){for(var N=0,O=0,U=0;U<P.length;U++)P[U].est.L>N&&(N=P[U].est.L,O=U);if(N<k)break;var B=P[O],M=Pr.quantize.splitPixels(m,I,B.i0,B.i1,B.est.e,B.est.eMq255);if(B.i0>=M||B.i1<=M)B.est.L=0;else{var j={i0:B.i0,i1:M,bst:null,est:null,tdst:0,left:null,right:null};j.bst=Pr.quantize.stats(m,j.i0,j.i1),j.est=Pr.quantize.estats(j.bst);var G={i0:M,i1:B.i1,bst:null,est:null,tdst:0,left:null,right:null};for(G.bst={R:[],m:[],N:B.bst.N-j.bst.N},U=0;U<16;U++)G.bst.R[U]=B.bst.R[U]-j.bst.R[U];for(U=0;U<4;U++)G.bst.m[U]=B.bst.m[U]-j.bst.m[U];G.est=Pr.quantize.estats(G.bst),B.left=j,B.right=G,P[O]=j,P.push(G)}}for(P.sort((function(m,y){return y.bst.N-m.bst.N})),U=0;U<P.length;U++)P[U].ind=U;return[z,P]},Pr.quantize.getNearest=function(m,y,k,I,z){if(null==m.left)return m.tdst=Pr.quantize.dist(m.est.q,y,k,I,z),m;var P=Pr.quantize.planeDst(m.est,y,k,I,z),N=m.left,O=m.right;P>0&&(N=m.right,O=m.left);var U=Pr.quantize.getNearest(N,y,k,I,z);if(U.tdst<=P*P)return U;var B=Pr.quantize.getNearest(O,y,k,I,z);return B.tdst<U.tdst?B:U},Pr.quantize.planeDst=function(m,y,k,I,z){var P=m.e;return P[0]*y+P[1]*k+P[2]*I+P[3]*z-m.eMq},Pr.quantize.dist=function(m,y,k,I,z){var P=y-m[0],N=k-m[1],O=I-m[2],U=z-m[3];return P*P+N*N+O*O+U*U},Pr.quantize.splitPixels=function(m,y,k,I,z,P){var N=Pr.quantize.vecDot;for(I-=4;k<I;){for(;N(m,k,z)<=P;)k+=4;for(;N(m,I,z)>P;)I-=4;if(k>=I)break;var O=y[k>>2];y[k>>2]=y[I>>2],y[I>>2]=O,k+=4,I-=4}for(;N(m,k,z)>P;)k-=4;return k+4},Pr.quantize.vecDot=function(m,y,k){return m[y]*k[0]+m[y+1]*k[1]+m[y+2]*k[2]+m[y+3]*k[3]},Pr.quantize.stats=function(m,y,k){for(var I=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],z=[0,0,0,0],P=k-y>>2,N=y;N<k;N+=4){var O=m[N]*(1/255),U=m[N+1]*(1/255),B=m[N+2]*(1/255),M=m[N+3]*(1/255);z[0]+=O,z[1]+=U,z[2]+=B,z[3]+=M,I[0]+=O*O,I[1]+=O*U,I[2]+=O*B,I[3]+=O*M,I[5]+=U*U,I[6]+=U*B,I[7]+=U*M,I[10]+=B*B,I[11]+=B*M,I[15]+=M*M}return I[4]=I[1],I[8]=I[2],I[9]=I[6],I[12]=I[3],I[13]=I[7],I[14]=I[11],{R:I,m:z,N:P}},Pr.quantize.estats=function(m){var y=m.R,k=m.m,I=m.N,z=k[0],P=k[1],N=k[2],O=k[3],U=0==I?0:1/I,B=[y[0]-z*z*U,y[1]-z*P*U,y[2]-z*N*U,y[3]-z*O*U,y[4]-P*z*U,y[5]-P*P*U,y[6]-P*N*U,y[7]-P*O*U,y[8]-N*z*U,y[9]-N*P*U,y[10]-N*N*U,y[11]-N*O*U,y[12]-O*z*U,y[13]-O*P*U,y[14]-O*N*U,y[15]-O*O*U],M=B,j=Pr.M4,G=[.5,.5,.5,.5],H=0,V=0;if(0!=I)for(var q=0;q<10&&(G=j.multVec(M,G),V=Math.sqrt(j.dot(G,G)),G=j.sml(1/V,G),!(Math.abs(V-H)<1e-9));q++)H=V;var Z=[z*U,P*U,N*U,O*U];return{Cov:B,q:Z,e:G,L:H,eMq255:j.dot(j.sml(255,Z),G),eMq:j.dot(G,Z),rgba:(Math.round(255*Z[3])<<24|Math.round(255*Z[2])<<16|Math.round(255*Z[1])<<8|Math.round(255*Z[0])<<0)>>>0}},Pr.M4={multVec:function(m,y){return[m[0]*y[0]+m[1]*y[1]+m[2]*y[2]+m[3]*y[3],m[4]*y[0]+m[5]*y[1]+m[6]*y[2]+m[7]*y[3],m[8]*y[0]+m[9]*y[1]+m[10]*y[2]+m[11]*y[3],m[12]*y[0]+m[13]*y[1]+m[14]*y[2]+m[15]*y[3]]},dot:function(m,y){return m[0]*y[0]+m[1]*y[1]+m[2]*y[2]+m[3]*y[3]},sml:function(m,y){return[m*y[0],m*y[1],m*y[2],m*y[3]]}},Pr.encode.concatRGBA=function(m){for(var y=0,k=0;k<m.length;k++)y+=m[k].byteLength;var I=new Uint8Array(y),z=0;for(k=0;k<m.length;k++){for(var P=new Uint8Array(m[k]),N=P.length,O=0;O<N;O+=4){var U=P[O],B=P[O+1],M=P[O+2],j=P[O+3];0==j&&(U=B=M=0),I[z+O]=U,I[z+O+1]=B,I[z+O+2]=M,I[z+O+3]=j}z+=N}return I.buffer};const Nr={decode(m){const y=Pr.decode(m);return{width:y.width,height:y.height,data:new Uint8Array(Pr.toRGBA8(y)[0])}},encode(m){const y=Pr.encode([m.data],m.width,m.height,0);return new Uint8Array(y)}};var Or={256:"imageWidth",257:"imageLength",258:"bitsPerSample",259:"compression",262:"photometricInterpretation",273:"stripOffsets",278:"rowsPerStrip",279:"stripByteCounts",296:"resolutionUnit",320:"colorMap"};function Ke(m){var y=0,k=void 0,I={},z=void 0;function a(y,I){var z=y,P=y+I;if(k)return m.subarray(z,P);for(var N=m.subarray(z,P),O=new Uint8Array(P-z),U=0;U<N.byteLength;U++)O[N.byteLength-U-1]=N[U];return O}function s(y){var I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,z=arguments[2];if(k){var P=new DataView(m.buffer);if(I>1||z){for(var N=new Uint16Array(I),O=0;O<I;O++)N[O]=P.getUint16(y+(O<<1));return N}return P.getUint16(y)}var U=new DataView(a(y,I<<1).buffer);if(I>1||z){for(var B=new Uint16Array(I),M=0;M<I;M++)B[M]=U.getUint16(M<<1);return B}return U.getUint16(0)}function o(y){var I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,z=arguments[2];if(k){var P=new DataView(m.buffer);if(I>1||z){for(var N=new Uint32Array(I),O=0;O<I;O++)N[O]=P.getUint32(y+(O<<2));return N}return P.getUint32(y)}var U=new DataView(a(y,I<<2).buffer);if(I>1||z){for(var B=new Uint32Array(I),M=0;M<I;M++)B[M]=U.getUint32(M<<2);return B}return U.getUint32(0)}function h(m,y,z,P){var N=Or[m];N&&(I[N]=function(m,y,I){var z,P=function(m,y){switch(m){case 1:return y;case 3:return y<<1;case 4:default:return y<<2;case 5:return y<<3}}(m,y);P>4&&(I=o(I)),z=P<4?4/P:y;var N=void 0;switch(m){case 1:break;case 3:N=s(I,z,!0);break;case 4:N=o(I,z,!0)}if(N)return P<4?k?N.slice(0,z-y):N.slice(z-y):N}(y,z,P))}function f(y){for(var k=new Uint8Array(y.stripByteCounts.reduce((function(m,y){return m+y}),0)),I=0,z=0;z<y.stripOffsets.length;z++){var P=m.subarray(y.stripOffsets[z],y.stripOffsets[z]+y.stripByteCounts[z]);k.set(P,I),I+=P.byteLength}return k}if(77===m[0]&&77===m[1])k=!0;else{if(73!==m[0]||73!==m[1])throw new Error("Invalid byte order "+m[0]+m[1]);k=!1}if(42!==a(2,2)[1])throw new Error("not tiff");for(var P=[],N=o(4);0!==N;N=o(y)){var O=s(y=N);I={},y+=2;for(var U=0;U<O;U++)h(s(y),s(y+=2),o(y+=2),y+=4),y+=4;z=f(I),P.push({stripData:z,ifdEntries:I})}return P}function Je(m,y){var k=m.colorMap,I=m.bitsPerSample,z=m.photometricInterpretation,P=void 0;if(y=function(m,y){var k=m.compression;if(k&&1!==k[0])throw 2===k[0]?new Error("CCITT group3 decompressionion is not implemented."):5===k[0]?new Error("LZW decompressionion is not implemented."):6===k[0]?new Error("JPEG decompressionion is not implemented."):7===k[0]?new Error("JPEG2 decompressionion is not implemented."):8===k[0]?new Error("Zip (Adove Deflate) decompressionion is not implemented."):32773===k[0]?new Error("Packbits decompression is not implemented."):new Error("Unknown compression type: "+k[0]);return y}(m,y),!I)throw new Error("Bilevel image decode is not implemented.");if(k)throw new Error("Palette-color image decode is not implemented.");if(z[0]=4===I.length)return y;if(z[0]=3===I.length){P=new Uint8Array(y.length/3*4);for(var N=0;N<y.length/3;N++)P[4*N]=y[3*N],P[4*N+1]=y[3*N+1],P[4*N+2]=y[3*N+2],P[4*N+3]=255;return P}if(z[0]<2&&1===I.length&&4===I[0]){P=new Uint8Array(4*y.length);for(var O=0;O<y.length;O++)P[4*O]=y[O]<<4,P[4*O+1]=y[O+1]<<4,P[4*O+2]=y[O+2]<<4,P[4*O+3]=255;return P}if(z[0]<2&&1===I.length&&8===I[0]){P=new Uint8Array(4*y.length);for(var U=0;U<y.length;U++)P[4*U]=y[U],P[4*U+1]=y[U+1],P[4*U+2]=y[U+2],P[4*U+3]=255;return P}throw new Error("Can't detect image type. PhotometricInterpretation: "+z[0]+", BitsPerSample: "+I)}var $e_decode=function(m){var y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{singlePage:!0},k=Ke(new Uint8Array(m)),I=k.map((function(m){return{width:m.ifdEntries.imageWidth[0],height:m.ifdEntries.imageLength[0],data:Je(m.ifdEntries,m.stripData),ifdEntries:m.ifdEntries}}));if(y.singlePage){if(!I||!I.length)throw new Error("No pages");return I[0]}return I};const Ur={decode(m){const y=$e_decode(m,{singlePage:!0});return{width:y.width,height:y.height,data:y.data}},encode(){throw new Error("Encoding is not supported for TIFF images!")}},Lr={[G.JPEG]:It,[G.PNG]:Nr,[G.GIF]:et,[G.BMP]:Z,[G.TIFF]:Ur},er=(m,y,k)=>{const I=[],z=[],P=[],N=[];for(let O=0;O<y*k;O++)I.push(m[4*O]),z.push(m[4*O+1]),P.push(m[4*O+2]),N.push(m[4*O+3]);return[I,z,P,N]},rr=(m,y,k,I,z,P)=>{ir(m,y,k,I,(P[0]-1)/2),ir(y,m,k,I,(P[1]-1)/2),ir(m,y,k,I,(P[2]-1)/2)},ir=(m,y,k,I,z)=>{for(let k=0;k<m.length;k++)y[k]=m[k];nr(y,m,k,I,z),ar(m,y,k,I,z)},nr=(m,y,k,I,z)=>{const P=1/(z+z+1);for(let N=0;N<I;N++){let I=N*k,O=I,U=I+z;const B=m[I],M=m[I+k-1];let j=(z+1)*B;for(let y=0;y<z;y++)j+=m[I+y];for(let k=0;k<=z;k++)j+=m[U++]-B,y[I++]=j*P;for(let N=z+1;N<k-z;N++)j+=m[U++]-m[O++],y[I++]=j*P;for(let N=k-z;N<k;N++)j+=M-m[O++],y[I++]=j*P}},ar=(m,y,k,I,z)=>{const P=1/(z+z+1);for(let N=0;N<k;N++){let O=N,U=O,B=O+z*k;const M=m[O],j=m[O+k*(I-1)];let G=(z+1)*M;for(let y=0;y<z;y++)G+=m[O+y*k];for(let I=0;I<=z;I++)G+=m[B]-M,y[O]=G*P,B+=k,O+=k;for(let N=z+1;N<I-z;N++)G+=m[B]-m[U],y[O]=G*P,U+=k,B+=k,O+=k;for(let N=I-z;N<I;N++)G+=j-m[U],y[O]=G*P,U+=k,O+=k}},or=(m,y)=>m<1?Math.round(m*y):m,Br={"center bottom":{horizontalPosition:"center",verticalPosition:"bottom"},"center center":{horizontalPosition:"center",verticalPosition:"center"},"center top":{horizontalPosition:"center",verticalPosition:"top"},"left bottom":{horizontalPosition:"left",verticalPosition:"bottom"},"left center":{horizontalPosition:"left",verticalPosition:"center"},"left top":{horizontalPosition:"left",verticalPosition:"top"},"right bottom":{horizontalPosition:"right",verticalPosition:"bottom"},"right center":{horizontalPosition:"right",verticalPosition:"center"},"right top":{horizontalPosition:"right",verticalPosition:"top"},bottom:{horizontalPosition:"center",verticalPosition:"bottom"},center:{horizontalPosition:"center",verticalPosition:"center"},left:{horizontalPosition:"left",verticalPosition:"center"},right:{horizontalPosition:"right",verticalPosition:"center"},top:{horizontalPosition:"center",verticalPosition:"top"}},dr=(m,y,k,I,z,P)=>{const N=m/y,O=k/I;let U=k,B=I,M=0,j=0;if("contain"===z||"cover"===z){"contain"===z?N>=O?B=k/N:U=I*N:"cover"===z&&(N<O?(U=k,B=k/N):(U=I*N,B=I));const{horizontalPosition:m,verticalPosition:y}=(m=>Br[m]||Br.center)(P);"left"===m?M=0:"center"===m?M=k/2-U/2:"right"===m&&(M=k-U),"top"===y?j=0:"center"===y?j=I/2-B/2:"bottom"===y&&(j=I-B)}return{imageWidth:Math.round(U),imageHeight:Math.round(B),xOffset:Math.round(M),yOffset:Math.round(j)}},ur=(m,y,k,I,z)=>y===I?k:Math.round((m-y)*z+(I-m)*k),cr=(m,y,k,I,z,P,N,O,U,B)=>{const M=[0,0,0,0];for(let y=0;y<4;y+=1){let k=4*(O*m.width+z)+y,B=4*(O*m.width+P)+y;const j=ur(I,z,m.data[k],P,m.data[B]);if(U===O)M[y]=j;else{k=4*(U*m.width+z)+y,B=4*(U*m.width+P)+y;const G=ur(I,z,m.data[k],P,m.data[B]);M[y]=ur(N,O,j,U,G)}}M.every((m=>0===m))?y.set(B,k):y.set(M,k)},pr=(m,y)=>(k,I)=>({x:k+m,y:I+y}),Mr=new Set([G.JPEG,G.PNG,G.GIF,G.BMP,G.TIFF]),Rr=new Set([G.JPEG,G.PNG,G.GIF,G.BMP]);class _r{#t;#e;outputOptions;constructor(m,y,k={}){let I={};if(null==y?(this.#e=i$1(m),I=k||{}):"string"==typeof y?(this.#e=y,I=k||{}):(this.#e=i$1(m),"object"!=typeof y||Array.isArray(y)||(I=y||{})),!Mr.has(this.#e))throw new Error(`Unsupported input file type: ${this.#e}`);this.#t=Lr[this.#e].decode(m),this.outputOptions={background:I.background??[0,0,0,0],quality:I.quality??80,compressionLevel:I.compressionLevel??9,loop:I.loop??0,delay:I.delay??100}}get width(){return this.#t.width}get height(){return this.#t.height}crop(m,y,k,I){return((m,y,k)=>{const I=or(y.x,m.width),z=or(y.y,m.height),P=or(y.width,m.width),N=or(y.height,m.height),O=new Uint8Array(P*N*4);for(let m=0;m<O.length;m+=4)O.set(k,m);const U=P-I,B=N-z;for(let y=0;y<B;y+=1){const k=(z+y)*m.width+I<<2,N=k+(U<<2),B=m.data.subarray(k,N),M=y*P<<2;O.set(B,M)}m.data=O,m.width=P,m.height=N})(this.#t,{x:m,y:y,width:k,height:I},this.outputOptions.background),this}resize(m,y=null,k={}){let I=null,z={};if(null==y?(I=null,z=k||{}):"number"==typeof y?(I=y,z=k||{}):(I=null,"object"!=typeof y||Array.isArray(y)||(z=y||{})),!m&&!I)throw new Error("At least one dimension must be provided!");return((m,y,k,I,z)=>{if(!y&&!k)throw new Error("At least one dimension must be provided!");const{frameWidth:P,frameHeight:N}=((m,y,k,I,z)=>{if(k&&I){if("fill"===z||"contain"===z)return{frameWidth:k,frameHeight:I};if("inside"===z){const z=Math.min(k/m,I/y);return{frameWidth:Math.round(m*z),frameHeight:Math.round(y*z)}}if("outside"===z){const z=Math.max(k/m,I/y);return{frameWidth:Math.round(m*z),frameHeight:Math.round(y*z)}}}const P=m/y;return{frameWidth:k||Math.round(I*P),frameHeight:I||Math.round(k/P)}})(m.width,m.height,y,k,I.fit),{imageWidth:O,imageHeight:U,xOffset:B,yOffset:M}=dr(m.width,m.height,P,N,I.fit,I.position),j=new Uint8Array(P*N*4);for(let m=0;m<j.length;m+=4)j.set(z,m);for(let y=0;y<U&&y+M<N;y+=1)for(let k=0;k<O&&k+B<P;k+=1){if(k+B<0||k+B>=P||y+M<0||y+M>=N)continue;const I=4*((y+M)*P+(k+B)),G=k*m.width/O,H=Math.floor(G),V=Math.min(Math.ceil(G),m.width-1),q=y*m.height/U,Z=Math.floor(q),$=Math.min(Math.ceil(q),m.height-1);cr(m,j,I,G,H,V,q,Z,$,z)}m.data=j,m.width=P,m.height=N})(this.#t,m,I,{fit:z.fit??"cover",position:z.position??"center"},this.outputOptions.background),this}flip(m){return((m,y)=>{if("horizontal"===y||"both"===y)for(let y=0;y<m.height;y+=1){const k=y*m.width;for(let y=0;y<m.width/2;y+=1){const I=k+y<<2,z=m.data.slice(I,I+4),P=k+(m.width-1-y)<<2,N=m.data.slice(P,P+4);m.data.set(z,P),m.data.set(N,I)}}if("vertical"===y||"both"===y)for(let y=0;y<m.width;y+=1)for(let k=0;k<m.height/2;k+=1){const I=k*m.width+y<<2,z=m.data.slice(I,I+4),P=(m.height-1-k)*m.width+y<<2,N=m.data.slice(P,P+4);m.data.set(z,P),m.data.set(N,I)}})(this.#t,m),this}rotate(m){return((m,y,k)=>{const I=y%360*Math.PI/180,z=Math.cos(I),P=Math.sin(I),N=new Uint8Array(m.data.length);for(let m=0;m<N.length;m+=4)N.set(k,m);const O=pr(-m.width/2,-m.height/2),U=pr(m.width/2+.5,m.height/2+.5);for(let y=1;y<=m.height;y++)for(let k=1;k<=m.width;k++){const I=O(k,y),B=U(z*I.x-P*I.y,z*I.y+P*I.x),M=m.width*(y-1)+k-1<<2;if(B.x>=0&&B.x<m.width&&B.y>=0&&B.y<m.height){const y=(m.width*(0|B.y)+B.x|0)<<2,k=m.data.subarray(y,y+4);N.set(k,M)}}m.data=N})(this.#t,m,this.outputOptions.background),this}blur(m){return((m,y)=>{const k=er(m.data,m.width,m.height),I=er(m.data,m.width,m.height),z=((m,y)=>{const k=Math.sqrt(12*m*m/3+1);let I=Math.floor(k);I%2==0&&I--;const z=I+2,P=(12*m*m-3*I*I-12*I-9)/(-4*I-4),N=Math.round(P),O=[];for(let m=0;m<3;m++)O.push(m<N?I:z);return O})(y);rr(k[0],I[0],m.width,m.height,0,z),rr(k[1],I[1],m.width,m.height,0,z),rr(k[2],I[2],m.width,m.height,0,z),((m,y,k,I,z,P,N)=>{for(let O=0;O<y*k;O++)m[4*O]=I[O],m[4*O+1]=z[O],m[4*O+2]=P[O],m[4*O+3]=N[O]})(m.data,m.width,m.height,I[0],I[1],I[2],I[3])})(this.#t,m),this}toBuffer(m){const y=m||this.#e;if(!Rr.has(y))throw new Error(`Unsupported output file type: ${y}`);return Lr[y].encode(((m,y,k)=>{if(y===G.GIF){const y=m.data.slice(0),I=k.slice(0);I[3]=255;for(let m=0;m<y.length;m+=4)y[m+3]<128?y.set(I,m):y[m+3]=255;return{width:m.width,height:m.height,data:y}}if(y===G.JPEG){const y=m.data.slice(0);for(let m=3;m<y.length;m+=4)y[m]=255;return{width:m.width,height:m.height,data:y}}return m})(this.#t,y,this.outputOptions.background),this.outputOptions)}}var Fr;exports.MimeType=void 0,(Fr=exports.MimeType||(exports.MimeType={})).SVG="image/svg+xml",Fr.JPEG="image/jpeg",Fr.PNG="image/png",Fr.GIF="image/gif",Fr.WEBP="image/webp",Fr.BMP="image/bmp",Fr.TIFF="image/tiff",Fr.AVIF="image/avif";const Dr={name:"pureTransformer",supportedInputs:Mr,supportedOutputs:Rr,fallbackOutput:exports.MimeType.PNG,transform:async({data:m,contentType:y},{contentType:k,width:I,height:z,fit:P,position:N,background:O,quality:U,loop:B,delay:M,blurRadius:j,rotate:G,flip:H,crop:V,compressionLevel:q})=>{const Z=new _r(m,y,{background:O,loop:B,delay:M,quality:U,compressionLevel:q});return V&&Z.crop(V.x,V.y,V.width,V.height),null==I&&null==z||Z.resize(I,z,{fit:P,position:N}),H&&Z.flip(H),G&&0!==G&&Z.rotate(G),j&&j>0&&Z.blur(j),Z.toBuffer(k)}};class RemixImageError extends Error{errorCode;constructor(m,y){super(m),Object.setPrototypeOf(this,RemixImageError.prototype),this.errorCode=y||500}toString(){return this.message}}class UnsupportedImageError extends RemixImageError{constructor(m){super(m,415),Object.setPrototypeOf(this,UnsupportedImageError.prototype)}}const fetchResolver=async(m,y)=>{const k=new Request(y,{headers:{accept:"image/*"}}),I=await fetch(k);if(!I.ok)throw new RemixImageError("Failed to fetch image!");const z=await I.arrayBuffer();if(!z||z.byteLength<2)throw new RemixImageError("Invalid image retrieved from resolver!");return{buffer:new Uint8Array(z),contentType:I.headers.get("content-type")}};var jr={},Gr={get exports(){return jr},set exports(m){jr=m}},Hr={},Vr={},qr={};!function(m){const y=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",k="["+y+"]["+(y+"\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040")+"]*",I=new RegExp("^"+k+"$");m.isExist=function(m){return void 0!==m},m.isEmptyObject=function(m){return 0===Object.keys(m).length},m.merge=function(m,y,k){if(y){const I=Object.keys(y),z=I.length;for(let P=0;P<z;P++)m[I[P]]="strict"===k?[y[I[P]]]:y[I[P]]}},m.getValue=function(y){return m.isExist(y)?y:""},m.buildOptions=function(m,y,k){let I={};if(!m)return y;for(let z=0;z<k.length;z++)void 0!==m[k[z]]?I[k[z]]=m[k[z]]:I[k[z]]=y[k[z]];return I},m.isTagNameInArrayMode=function(m,y,k){return!1!==y&&(y instanceof RegExp?y.test(m):"function"==typeof y?!!y(m,k):"strict"===y)},m.isName=function(m){const y=I.exec(m);return!(null==y)},m.getAllMatches=function(m,y){const k=[];let I=y.exec(m);for(;I;){const z=[];z.startIndex=y.lastIndex-I[0].length;const P=I.length;for(let m=0;m<P;m++)z.push(I[m]);k.push(z),I=y.exec(m)}return k},m.nameRegexp=k}(qr);const Zr=qr,convertToJson=function(m,y,k){const I={};if(!y.alwaysCreateTextNode&&(!m.child||Zr.isEmptyObject(m.child))&&(!m.attrsMap||Zr.isEmptyObject(m.attrsMap)))return Zr.isExist(m.val)?m.val:"";if(Zr.isExist(m.val)&&("string"!=typeof m.val||""!==m.val&&m.val!==y.cdataPositionChar)){const z=Zr.isTagNameInArrayMode(m.tagname,y.arrayMode,k);I[y.textNodeName]=z?[m.val]:m.val}Zr.merge(I,m.attrsMap,y.arrayMode);const z=Object.keys(m.child);for(let P=0;P<z.length;P++){const N=z[P];if(m.child[N]&&m.child[N].length>1){I[N]=[];for(let k in m.child[N])m.child[N].hasOwnProperty(k)&&I[N].push(convertToJson(m.child[N][k],y,N))}else{const z=convertToJson(m.child[N][0],y,N),P=!0===y.arrayMode&&"object"==typeof z||Zr.isTagNameInArrayMode(N,y.arrayMode,k);I[N]=P?[z]:z}}return I};Vr.convertToJson=convertToJson;var $r={};const Wr=/^[-+]?0x[a-fA-F0-9]+$/,Xr=/^([\-\+])?(0*)(\.[0-9]+([eE]\-?[0-9]+)?|[0-9]+(\.[0-9]+([eE]\-?[0-9]+)?)?)$/;!Number.parseInt&&window.parseInt&&(Number.parseInt=window.parseInt),!Number.parseFloat&&window.parseFloat&&(Number.parseFloat=window.parseFloat);const Jr={hex:!0,leadingZeros:!0,decimalPoint:".",eNotation:!0};const Yr=qr,Kr=qr.buildOptions,xmlNode=function(m,y,k){this.tagname=m,this.parent=y,this.child={},this.attrsMap={},this.val=k,this.addChild=function(m){Array.isArray(this.child[m.tagname])?this.child[m.tagname].push(m):this.child[m.tagname]=[m]}},Qr=function toNumber$1(m,y={}){if(y=Object.assign({},Jr,y),!m||"string"!=typeof m)return m;let k=m.trim();if(void 0!==y.skipLike&&y.skipLike.test(k))return m;if(y.hex&&Wr.test(k))return Number.parseInt(k,16);{const I=Xr.exec(k);if(I){const z=I[1],P=I[2];let N=function trimZeros(m){if(m&&-1!==m.indexOf("."))return"."===(m=m.replace(/0+$/,""))?m="0":"."===m[0]?m="0"+m:"."===m[m.length-1]&&(m=m.substr(0,m.length-1)),m;return m}(I[3]);const O=I[4]||I[6];if(!y.leadingZeros&&P.length>0&&z&&"."!==k[2])return m;if(!y.leadingZeros&&P.length>0&&!z&&"."!==k[1])return m;{const I=Number(k),U=""+I;return-1!==U.search(/[eE]/)||O?y.eNotation?I:m:-1!==k.indexOf(".")?"0"===U&&""===N||U===N||z&&U==="-"+N?I:m:P?N===U||z+N===U?I:m:k===U||k===z+U?I:m}}return m}};"<((!\\[CDATA\\[([\\s\\S]*?)(]]>))|((NAME:)?(NAME))([^>]*)>|((\\/)(NAME)\\s*>))([^<]*)".replace(/NAME/g,Yr.nameRegexp),!Number.parseInt&&window.parseInt&&(Number.parseInt=window.parseInt),!Number.parseFloat&&window.parseFloat&&(Number.parseFloat=window.parseFloat);const ti={attributeNamePrefix:"@_",attrNodeName:!1,textNodeName:"#text",ignoreAttributes:!0,ignoreNameSpace:!1,allowBooleanAttributes:!1,parseNodeValue:!0,parseAttributeValue:!1,arrayMode:!1,trimValues:!0,cdataTagName:!1,cdataPositionChar:"\\c",numParseOptions:{hex:!0,leadingZeros:!0},tagValueProcessor:function(m,y){return m},attrValueProcessor:function(m,y){return m},stopNodes:[],alwaysCreateTextNode:!1};$r.defaultOptions=ti;const ei=["attributeNamePrefix","attrNodeName","textNodeName","ignoreAttributes","ignoreNameSpace","allowBooleanAttributes","parseNodeValue","parseAttributeValue","arrayMode","trimValues","cdataTagName","cdataPositionChar","tagValueProcessor","attrValueProcessor","parseTrueNumberOnly","numParseOptions","stopNodes","alwaysCreateTextNode"];function processTagValue(m,y,k){return y&&(k.trimValues&&(y=y.trim()),y=parseValue(y=k.tagValueProcessor(y,m),k.parseNodeValue,k.numParseOptions)),y}function resolveNameSpace(m,y){if(y.ignoreNameSpace){const y=m.split(":"),k="/"===m.charAt(0)?"/":"";if("xmlns"===y[0])return"";2===y.length&&(m=k+y[1])}return m}function parseValue(m,y,k){if(y&&"string"==typeof m){const y=m.trim();return"true"===y||"false"!==y&&Qr(m,k)}return Yr.isExist(m)?m:""}$r.props=ei;const ri=new RegExp("([^\\s=]+)\\s*(=\\s*(['\"])(.*?)\\3)?","g");function buildAttributesMap(m,y){if(!y.ignoreAttributes&&"string"==typeof m){m=m.replace(/\r?\n/g," ");const k=Yr.getAllMatches(m,ri),I=k.length,z={};for(let m=0;m<I;m++){const I=resolveNameSpace(k[m][1],y);I.length&&(void 0!==k[m][4]?(y.trimValues&&(k[m][4]=k[m][4].trim()),k[m][4]=y.attrValueProcessor(k[m][4],I),z[y.attributeNamePrefix+I]=parseValue(k[m][4],y.parseAttributeValue,y.numParseOptions)):y.allowBooleanAttributes&&(z[y.attributeNamePrefix+I]=!0))}if(!Object.keys(z).length)return;if(y.attrNodeName){const m={};return m[y.attrNodeName]=z,m}return z}}function closingIndexForOpeningTag(m,y){let k,I="";for(let z=y;z<m.length;z++){let y=m[z];if(k)y===k&&(k="");else if('"'===y||"'"===y)k=y;else{if(">"===y)return{data:I,index:z};"\t"===y&&(y=" ")}I+=y}}function findClosingIndex(m,y,k,I){const z=m.indexOf(y,k);if(-1===z)throw new Error(I);return z+y.length-1}$r.getTraversalObj=function(m,y){m=m.replace(/\r\n?/g,"\n"),y=Kr(y,ti,ei);const k=new xmlNode("!xml");let I=k,z="";for(let k=0;k<m.length;k++){if("<"===m[k])if("/"===m[k+1]){const P=findClosingIndex(m,">",k,"Closing Tag is not closed.");let N=m.substring(k+2,P).trim();if(y.ignoreNameSpace){const m=N.indexOf(":");-1!==m&&(N=N.substr(m+1))}I&&(I.val?I.val=Yr.getValue(I.val)+""+processTagValue(N,z,y):I.val=processTagValue(N,z,y)),y.stopNodes.length&&y.stopNodes.includes(I.tagname)&&(I.child=[],null==I.attrsMap&&(I.attrsMap={}),I.val=m.substr(I.startIndex+1,k-I.startIndex-1)),I=I.parent,z="",k=P}else if("?"===m[k+1])k=findClosingIndex(m,"?>",k,"Pi Tag is not closed.");else if("!--"===m.substr(k+1,3))k=findClosingIndex(m,"--\x3e",k,"Comment is not closed.");else if("!D"===m.substr(k+1,2)){const y=findClosingIndex(m,">",k,"DOCTYPE is not closed.");k=m.substring(k,y).indexOf("[")>=0?m.indexOf("]>",k)+1:y}else if("!["===m.substr(k+1,2)){const P=findClosingIndex(m,"]]>",k,"CDATA is not closed.")-2,N=m.substring(k+9,P);if(z&&(I.val=Yr.getValue(I.val)+""+processTagValue(I.tagname,z,y),z=""),y.cdataTagName){const m=new xmlNode(y.cdataTagName,I,N);I.addChild(m),I.val=Yr.getValue(I.val)+y.cdataPositionChar,N&&(m.val=N)}else I.val=(I.val||"")+(N||"");k=P+2}else{const P=closingIndexForOpeningTag(m,k+1);let N=P.data;const O=P.index,U=N.indexOf(" ");let B=N,M=!0;if(-1!==U&&(B=N.substr(0,U).replace(/\s\s*$/,""),N=N.substr(U+1)),y.ignoreNameSpace){const m=B.indexOf(":");-1!==m&&(B=B.substr(m+1),M=B!==P.data.substr(m+1))}if(I&&z&&"!xml"!==I.tagname&&(I.val=Yr.getValue(I.val)+""+processTagValue(I.tagname,z,y)),N.length>0&&N.lastIndexOf("/")===N.length-1){"/"===B[B.length-1]?(B=B.substr(0,B.length-1),N=B):N=N.substr(0,N.length-1);const m=new xmlNode(B,I,"");B!==N&&(m.attrsMap=buildAttributesMap(N,y)),I.addChild(m)}else{const m=new xmlNode(B,I);y.stopNodes.length&&y.stopNodes.includes(m.tagname)&&(m.startIndex=O),B!==N&&M&&(m.attrsMap=buildAttributesMap(N,y)),I.addChild(m),I=m}z="",k=O}else z+=m[k]}return k};var ii={};const ni=qr,ai={allowBooleanAttributes:!1},si=["allowBooleanAttributes"];function readPI(m,y){const k=y;for(;y<m.length;y++)if("?"!=m[y]&&" "!=m[y]);else{const I=m.substr(k,y-k);if(y>5&&"xml"===I)return getErrorObject("InvalidXml","XML declaration allowed only at the start of the document.",getLineNumberForPosition(m,y));if("?"==m[y]&&">"==m[y+1]){y++;break}}return y}function readCommentAndCDATA(m,y){if(m.length>y+5&&"-"===m[y+1]&&"-"===m[y+2]){for(y+=3;y<m.length;y++)if("-"===m[y]&&"-"===m[y+1]&&">"===m[y+2]){y+=2;break}}else if(m.length>y+8&&"D"===m[y+1]&&"O"===m[y+2]&&"C"===m[y+3]&&"T"===m[y+4]&&"Y"===m[y+5]&&"P"===m[y+6]&&"E"===m[y+7]){let k=1;for(y+=8;y<m.length;y++)if("<"===m[y])k++;else if(">"===m[y]&&(k--,0===k))break}else if(m.length>y+9&&"["===m[y+1]&&"C"===m[y+2]&&"D"===m[y+3]&&"A"===m[y+4]&&"T"===m[y+5]&&"A"===m[y+6]&&"["===m[y+7])for(y+=8;y<m.length;y++)if("]"===m[y]&&"]"===m[y+1]&&">"===m[y+2]){y+=2;break}return y}ii.validate=function(m,y){y=ni.buildOptions(y,ai,si);const k=[];let I=!1,z=!1;"\ufeff"===m[0]&&(m=m.substr(1));for(let N=0;N<m.length;N++)if("<"===m[N]&&"?"===m[N+1]){if(N+=2,N=readPI(m,N),N.err)return N}else{if("<"!==m[N]){if(" "===m[N]||"\t"===m[N]||"\n"===m[N]||"\r"===m[N])continue;return getErrorObject("InvalidChar","char '"+m[N]+"' is not expected.",getLineNumberForPosition(m,N))}{let O=N;if(N++,"!"===m[N]){N=readCommentAndCDATA(m,N);continue}{let U=!1;"/"===m[N]&&(U=!0,N++);let B="";for(;N<m.length&&">"!==m[N]&&" "!==m[N]&&"\t"!==m[N]&&"\n"!==m[N]&&"\r"!==m[N];N++)B+=m[N];if(B=B.trim(),"/"===B[B.length-1]&&(B=B.substring(0,B.length-1),N--),P=B,!ni.isName(P)){let y;return y=0===B.trim().length?"Invalid space after '<'.":"Tag '"+B+"' is an invalid name.",getErrorObject("InvalidTag",y,getLineNumberForPosition(m,N))}const M=readAttributeStr(m,N);if(!1===M)return getErrorObject("InvalidAttr","Attributes for '"+B+"' have open quote.",getLineNumberForPosition(m,N));let j=M.value;if(N=M.index,"/"===j[j.length-1]){const k=N-j.length;j=j.substring(0,j.length-1);const z=validateAttributeString(j,y);if(!0!==z)return getErrorObject(z.err.code,z.err.msg,getLineNumberForPosition(m,k+z.err.line));I=!0}else if(U){if(!M.tagClosed)return getErrorObject("InvalidTag","Closing tag '"+B+"' doesn't have proper closing.",getLineNumberForPosition(m,N));if(j.trim().length>0)return getErrorObject("InvalidTag","Closing tag '"+B+"' can't have attributes or invalid starting.",getLineNumberForPosition(m,O));{const y=k.pop();if(B!==y.tagName){let k=getLineNumberForPosition(m,y.tagStartPos);return getErrorObject("InvalidTag","Expected closing tag '"+y.tagName+"' (opened in line "+k.line+", col "+k.col+") instead of closing tag '"+B+"'.",getLineNumberForPosition(m,O))}0==k.length&&(z=!0)}}else{const P=validateAttributeString(j,y);if(!0!==P)return getErrorObject(P.err.code,P.err.msg,getLineNumberForPosition(m,N-j.length+P.err.line));if(!0===z)return getErrorObject("InvalidXml","Multiple possible root nodes found.",getLineNumberForPosition(m,N));k.push({tagName:B,tagStartPos:O}),I=!0}for(N++;N<m.length;N++)if("<"===m[N]){if("!"===m[N+1]){N++,N=readCommentAndCDATA(m,N);continue}if("?"!==m[N+1])break;if(N=readPI(m,++N),N.err)return N}else if("&"===m[N]){const y=validateAmpersand(m,N);if(-1==y)return getErrorObject("InvalidChar","char '&' is not expected.",getLineNumberForPosition(m,N));N=y}"<"===m[N]&&N--}}}var P;return I?1==k.length?getErrorObject("InvalidTag","Unclosed tag '"+k[0].tagName+"'.",getLineNumberForPosition(m,k[0].tagStartPos)):!(k.length>0)||getErrorObject("InvalidXml","Invalid '"+JSON.stringify(k.map((m=>m.tagName)),null,4).replace(/\r?\n/g,"")+"' found.",{line:1,col:1}):getErrorObject("InvalidXml","Start tag expected.",1)};function readAttributeStr(m,y){let k="",I="",z=!1;for(;y<m.length;y++){if('"'===m[y]||"'"===m[y])""===I?I=m[y]:I!==m[y]||(I="");else if(">"===m[y]&&""===I){z=!0;break}k+=m[y]}return""===I&&{value:k,index:y,tagClosed:z}}const oi=new RegExp("(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['\"])(([\\s\\S])*?)\\5)?","g");function validateAttributeString(m,y){const k=ni.getAllMatches(m,oi),I={};for(let m=0;m<k.length;m++){if(0===k[m][1].length)return getErrorObject("InvalidAttr","Attribute '"+k[m][2]+"' has no space in starting.",getPositionFromMatch(k[m]));if(void 0===k[m][3]&&!y.allowBooleanAttributes)return getErrorObject("InvalidAttr","boolean attribute '"+k[m][2]+"' is not allowed.",getPositionFromMatch(k[m]));const z=k[m][2];if(!validateAttrName(z))return getErrorObject("InvalidAttr","Attribute '"+z+"' is an invalid name.",getPositionFromMatch(k[m]));if(I.hasOwnProperty(z))return getErrorObject("InvalidAttr","Attribute '"+z+"' is repeated.",getPositionFromMatch(k[m]));I[z]=1}return!0}function validateAmpersand(m,y){if(";"===m[++y])return-1;if("#"===m[y])return function validateNumberAmpersand(m,y){let k=/\d/;for("x"===m[y]&&(y++,k=/[\da-fA-F]/);y<m.length;y++){if(";"===m[y])return y;if(!m[y].match(k))break}return-1}(m,++y);let k=0;for(;y<m.length;y++,k++)if(!(m[y].match(/\w/)&&k<20)){if(";"===m[y])break;return-1}return y}function getErrorObject(m,y,k){return{err:{code:m,msg:y,line:k.line||k,col:k.col}}}function validateAttrName(m){return ni.isName(m)}function getLineNumberForPosition(m,y){const k=m.substring(0,y).split(/\r?\n/);return{line:k.length,col:k[k.length-1].length+1}}function getPositionFromMatch(m){return m.startIndex+m[1].length}var hi,li={};function requireNimndata(){if(hi)return li;hi=1;const char=function(m){return String.fromCharCode(m)},m={nilChar:char(176),missingChar:char(201),nilPremitive:char(175),missingPremitive:char(200),emptyChar:char(178),emptyValue:char(177),boundryChar:char(179),objStart:char(198),arrStart:char(204),arrayEnd:char(185)},y=[m.nilChar,m.nilPremitive,m.missingChar,m.missingPremitive,m.boundryChar,m.emptyChar,m.emptyValue,m.arrayEnd,m.objStart,m.arrStart],_e=function(y,k,I){if("string"==typeof k)return y&&y[0]&&void 0!==y[0].val?getValue(y[0].val):getValue(y);{const z=function hasData(y){return void 0===y?m.missingChar:null===y?m.nilChar:!(y.child&&0===Object.keys(y.child).length&&(!y.attrsMap||0===Object.keys(y.attrsMap).length))||m.emptyChar}(y);if(!0===z){let z="";if(Array.isArray(k)){z+=m.arrStart;const P=k[0],N=y.length;if("string"==typeof P)for(let m=0;m<N;m++){const k=getValue(y[m].val);z=processValue(z,k)}else for(let m=0;m<N;m++){const k=_e(y[m],P,I);z=processValue(z,k)}z+=m.arrayEnd}else{z+=m.objStart;const P=Object.keys(k);Array.isArray(y)&&(y=y[0]);for(let m in P){const N=P[m];let O;O=!I.ignoreAttributes&&y.attrsMap&&y.attrsMap[N]?_e(y.attrsMap[N],k[N],I):N===I.textNodeName?_e(y.val,k[N],I):_e(y.child[N],k[N],I),z=processValue(z,O)}}return z}return z}},getValue=function(y){switch(y){case void 0:return m.missingPremitive;case null:return m.nilPremitive;case"":return m.emptyValue;default:return y}},processValue=function(y,k){return isAppChar(k[0])||isAppChar(y[y.length-1])||(y+=m.boundryChar),y+k},isAppChar=function(m){return-1!==y.indexOf(m)};const k=$r,I=qr.buildOptions;return li.convert2nimn=function(m,y,z){return z=I(z,k.defaultOptions,k.props),_e(m,y,z)},li}var fi,ci,di,ui={};function requireNode2json_str(){if(fi)return ui;fi=1;const m=qr,y=qr.buildOptions,k=$r,_cToJsonStr=function(y,k,I){let z="{";const P=Object.keys(y.child);for(let m=0;m<P.length;m++){const I=P[m];if(y.child[I]&&y.child[I].length>1){z+='"'+I+'" : [ ';for(let m in y.child[I])z+=_cToJsonStr(y.child[I][m],k)+" , ";z=z.substr(0,z.length-1)+" ] "}else z+='"'+I+'" : '+_cToJsonStr(y.child[I][0],k)+" ,"}return m.merge(z,y.attrsMap),m.isEmptyObject(z)?m.isExist(y.val)?y.val:"":(m.isExist(y.val)&&("string"!=typeof y.val||""!==y.val&&y.val!==k.cdataPositionChar)&&(z+='"'+k.textNodeName+'" : '+function stringval(m){return!0!==m&&!1!==m&&isNaN(m)?'"'+m+'"':m}(y.val)),","===z[z.length-1]&&(z=z.substr(0,z.length-2)),z+"}")};return ui.convertToJsonString=function(m,I){return(I=y(I,k.defaultOptions,k.props)).indentBy=I.indentBy||"",_cToJsonStr(m,I)},ui}!function(m){const y=Vr,k=$r,I=$r,z=qr.buildOptions,P=ii;m.parse=function(m,N={},O){if(O){!0===O&&(O={});const y=P.validate(m,O);if(!0!==y)throw Error(y.err.msg)}N.parseTrueNumberOnly&&!1!==N.parseNodeValue&&!N.numParseOptions&&(N.numParseOptions={leadingZeros:!1});let U=z(N,I.defaultOptions,I.props);const B=k.getTraversalObj(m,U);return y.convertToJson(B,U)},m.convertTonimn=requireNimndata().convert2nimn,m.getTraversalObj=k.getTraversalObj,m.convertToJson=y.convertToJson,m.convertToJsonString=requireNode2json_str().convertToJsonString,m.validate=P.validate,m.j2xParser=function requireJson2xml(){if(di)return ci;di=1;const m=qr.buildOptions,y={attributeNamePrefix:"@_",attrNodeName:!1,textNodeName:"#text",ignoreAttributes:!0,cdataTagName:!1,cdataPositionChar:"\\c",format:!1,indentBy:"  ",supressEmptyNode:!1,tagValueProcessor:function(m){return m},attrValueProcessor:function(m){return m}},k=["attributeNamePrefix","attrNodeName","textNodeName","ignoreAttributes","cdataTagName","cdataPositionChar","format","indentBy","supressEmptyNode","tagValueProcessor","attrValueProcessor","rootNodeName"];function Parser(I){this.options=m(I,y,k),this.options.ignoreAttributes||this.options.attrNodeName?this.isAttribute=function(){return!1}:(this.attrPrefixLen=this.options.attributeNamePrefix.length,this.isAttribute=isAttribute),this.options.cdataTagName?this.isCDATA=isCDATA:this.isCDATA=function(){return!1},this.replaceCDATAstr=replaceCDATAstr,this.replaceCDATAarr=replaceCDATAarr,this.processTextOrObjNode=processTextOrObjNode,this.options.format?(this.indentate=indentate,this.tagEndChar=">\n",this.newLine="\n"):(this.indentate=function(){return""},this.tagEndChar=">",this.newLine=""),this.options.supressEmptyNode?(this.buildTextNode=buildEmptyTextNode,this.buildObjNode=buildEmptyObjNode):(this.buildTextNode=buildTextValNode,this.buildObjNode=buildObjectNode),this.buildTextValNode=buildTextValNode,this.buildObjectNode=buildObjectNode}function processTextOrObjNode(m,y,k){const I=this.j2x(m,k+1);return void 0!==m[this.options.textNodeName]&&1===Object.keys(m).length?this.buildTextNode(I.val,y,I.attrStr,k):this.buildObjNode(I.val,y,I.attrStr,k)}function replaceCDATAstr(m,y){return m=this.options.tagValueProcessor(""+m),""===this.options.cdataPositionChar||""===m?m+"<![CDATA["+y+"]]"+this.tagEndChar:m.replace(this.options.cdataPositionChar,"<![CDATA["+y+"]]"+this.tagEndChar)}function replaceCDATAarr(m,y){if(m=this.options.tagValueProcessor(""+m),""===this.options.cdataPositionChar||""===m)return m+"<![CDATA["+y.join("]]><![CDATA[")+"]]"+this.tagEndChar;for(let k in y)m=m.replace(this.options.cdataPositionChar,"<![CDATA["+y[k]+"]]>");return m+this.newLine}function buildObjectNode(m,y,k,I){return k&&-1===m.indexOf("<")?this.indentate(I)+"<"+y+k+">"+m+"</"+y+this.tagEndChar:this.indentate(I)+"<"+y+k+this.tagEndChar+m+this.indentate(I)+"</"+y+this.tagEndChar}function buildEmptyObjNode(m,y,k,I){return""!==m?this.buildObjectNode(m,y,k,I):this.indentate(I)+"<"+y+k+"/"+this.tagEndChar}function buildTextValNode(m,y,k,I){return this.indentate(I)+"<"+y+k+">"+this.options.tagValueProcessor(m)+"</"+y+this.tagEndChar}function buildEmptyTextNode(m,y,k,I){return""!==m?this.buildTextValNode(m,y,k,I):this.indentate(I)+"<"+y+k+"/"+this.tagEndChar}function indentate(m){return this.options.indentBy.repeat(m)}function isAttribute(m){return!!m.startsWith(this.options.attributeNamePrefix)&&m.substr(this.attrPrefixLen)}function isCDATA(m){return m===this.options.cdataTagName}return Parser.prototype.parse=function(m){return Array.isArray(m)&&this.options.rootNodeName&&this.options.rootNodeName.length>1&&(m={[this.options.rootNodeName]:m}),this.j2x(m,0).val},Parser.prototype.j2x=function(m,y){let k="",I="";for(let z in m)if(void 0===m[z]);else if(null===m[z])I+=this.indentate(y)+"<"+z+"/"+this.tagEndChar;else if(m[z]instanceof Date)I+=this.buildTextNode(m[z],z,"",y);else if("object"!=typeof m[z]){const P=this.isAttribute(z);P?k+=" "+P+'="'+this.options.attrValueProcessor(""+m[z])+'"':this.isCDATA(z)?m[this.options.textNodeName]?I+=this.replaceCDATAstr(m[this.options.textNodeName],m[z]):I+=this.replaceCDATAstr("",m[z]):z===this.options.textNodeName?m[this.options.cdataTagName]||(I+=this.options.tagValueProcessor(""+m[z])):I+=this.buildTextNode(m[z],z,"",y)}else if(Array.isArray(m[z]))if(this.isCDATA(z))I+=this.indentate(y),m[this.options.textNodeName]?I+=this.replaceCDATAarr(m[this.options.textNodeName],m[z]):I+=this.replaceCDATAarr("",m[z]);else{const k=m[z].length;for(let P=0;P<k;P++){const k=m[z][P];void 0===k||(I+=null===k?this.indentate(y)+"<"+z+"/"+this.tagEndChar:"object"==typeof k?this.processTextOrObjNode(k,z,y):this.buildTextNode(k,z,"",y))}}else if(this.options.attrNodeName&&z===this.options.attrNodeName){const y=Object.keys(m[z]),I=y.length;for(let P=0;P<I;P++)k+=" "+y[P]+'="'+this.options.attrValueProcessor(""+m[z][y[P]])+'"'}else I+=this.processTextOrObjNode(m[z],z,y);return{attrStr:k,val:I}},ci=Parser}(),m.parseToNimn=function(y,k,I){return m.convertTonimn(m.getTraversalObj(y,I),k,I)}}(Hr);const pi=Hr,isSvg=m=>{if(null==m)return!1;if(0===(m=m.toString().trim().replace(/\n/g," ")).length)return!1;if(!0!==pi.validate(m))return!1;let y;try{y=pi.parse(m)}catch(m){return!1}return!!y&&"svg"in y};Gr.exports=isSvg,jr.default=isSvg;const gi={0:{66:{77:"image/bmp"},71:{73:{70:"image/gif"}},73:{73:{42:{0:"image/tiff"}}},77:{77:{0:{42:"image/tiff"}}},137:{80:{78:{71:{13:{10:{26:{10:"image/png"}}}}}}},255:{216:{255:"image/jpeg"}}},4:{102:{116:{121:{112:{97:{118:{105:{102:"image/avif",115:"image/avif"}}}}}}}},8:{87:{69:{66:{80:"image/webp"}}}}},mi=[0,4,8];var bi;!function(m){m.SVG="image/svg+xml",m.JPEG="image/jpeg",m.PNG="image/png",m.GIF="image/gif",m.WEBP="image/webp",m.BMP="image/bmp",m.TIFF="image/tiff",m.AVIF="image/avif"}(bi||(bi={}));const g=m=>{if(!m||m.byteLength<3)throw new Error("Buffer is not a valid image!");for(const y of mi){let k=gi[y];for(let I=y;I<=12;I+=1){const y=m[I];if("object"!=typeof k)return k;if(!Object.prototype.hasOwnProperty.call(k,y))break;k=k[y]}}throw new Error("Buffer is not a supported image type!")},noOp=async()=>{},textResponse=(m,y="")=>new Response(y,{status:m});var vi={},strictUriEncode=m=>encodeURIComponent(m).replace(/[!'()*]/g,(m=>`%${m.charCodeAt(0).toString(16).toUpperCase()}`)),wi="%[a-f0-9]{2}",_i=new RegExp("("+wi+")|([^%]+?)","gi"),yi=new RegExp("("+wi+")+","gi");function decodeComponents(m,y){try{return[decodeURIComponent(m.join(""))]}catch(m){}if(1===m.length)return m;y=y||1;var k=m.slice(0,y),I=m.slice(y);return Array.prototype.concat.call([],decodeComponents(k),decodeComponents(I))}function decode(m){try{return decodeURIComponent(m)}catch(I){for(var y=m.match(_i)||[],k=1;k<y.length;k++)y=(m=decodeComponents(y,k).join("")).match(_i)||[];return m}}var decodeUriComponent=function(m){if("string"!=typeof m)throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof m+"`");try{return m=m.replace(/\+/g," "),decodeURIComponent(m)}catch(y){return function customDecodeURIComponent(m){for(var y={"%FE%FF":"","%FF%FE":""},k=yi.exec(m);k;){try{y[k[0]]=decodeURIComponent(k[0])}catch(m){var I=decode(k[0]);I!==k[0]&&(y[k[0]]=I)}k=yi.exec(m)}y["%C2"]="";for(var z=Object.keys(y),P=0;P<z.length;P++){var N=z[P];m=m.replace(new RegExp(N,"g"),y[N])}return m}(m)}},splitOnFirst=(m,y)=>{if("string"!=typeof m||"string"!=typeof y)throw new TypeError("Expected the arguments to be of type `string`");if(""===y)return[m];const k=m.indexOf(y);return-1===k?[m]:[m.slice(0,k),m.slice(k+y.length)]},filterObj=function(m,y){for(var k={},I=Object.keys(m),z=Array.isArray(y),P=0;P<I.length;P++){var N=I[P],O=m[N];(z?-1!==y.indexOf(N):y(N,O,m))&&(k[N]=O)}return k};!function(m){const y=strictUriEncode,k=decodeUriComponent,I=splitOnFirst,z=filterObj,P=Symbol("encodeFragmentIdentifier");function validateArrayFormatSeparator(m){if("string"!=typeof m||1!==m.length)throw new TypeError("arrayFormatSeparator must be single character string")}function encode(m,k){return k.encode?k.strict?y(m):encodeURIComponent(m):m}function decode(m,y){return y.decode?k(m):m}function keysSorter(m){return Array.isArray(m)?m.sort():"object"==typeof m?keysSorter(Object.keys(m)).sort(((m,y)=>Number(m)-Number(y))).map((y=>m[y])):m}function removeHash(m){const y=m.indexOf("#");return-1!==y&&(m=m.slice(0,y)),m}function extract(m){const y=(m=removeHash(m)).indexOf("?");return-1===y?"":m.slice(y+1)}function parseValue(m,y){return y.parseNumbers&&!Number.isNaN(Number(m))&&"string"==typeof m&&""!==m.trim()?m=Number(m):!y.parseBooleans||null===m||"true"!==m.toLowerCase()&&"false"!==m.toLowerCase()||(m="true"===m.toLowerCase()),m}function parse(m,y){validateArrayFormatSeparator((y=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},y)).arrayFormatSeparator);const k=function parserForArrayFormat(m){let y;switch(m.arrayFormat){case"index":return(m,k,I)=>{y=/\[(\d*)\]$/.exec(m),m=m.replace(/\[\d*\]$/,""),y?(void 0===I[m]&&(I[m]={}),I[m][y[1]]=k):I[m]=k};case"bracket":return(m,k,I)=>{y=/(\[\])$/.exec(m),m=m.replace(/\[\]$/,""),y?void 0!==I[m]?I[m]=[].concat(I[m],k):I[m]=[k]:I[m]=k};case"colon-list-separator":return(m,k,I)=>{y=/(:list)$/.exec(m),m=m.replace(/:list$/,""),y?void 0!==I[m]?I[m]=[].concat(I[m],k):I[m]=[k]:I[m]=k};case"comma":case"separator":return(y,k,I)=>{const z="string"==typeof k&&k.includes(m.arrayFormatSeparator),P="string"==typeof k&&!z&&decode(k,m).includes(m.arrayFormatSeparator);k=P?decode(k,m):k;const N=z||P?k.split(m.arrayFormatSeparator).map((y=>decode(y,m))):null===k?k:decode(k,m);I[y]=N};case"bracket-separator":return(y,k,I)=>{const z=/(\[\])$/.test(y);if(y=y.replace(/\[\]$/,""),!z)return void(I[y]=k?decode(k,m):k);const P=null===k?[]:k.split(m.arrayFormatSeparator).map((y=>decode(y,m)));void 0!==I[y]?I[y]=[].concat(I[y],P):I[y]=P};default:return(m,y,k)=>{void 0!==k[m]?k[m]=[].concat(k[m],y):k[m]=y}}}(y),z=Object.create(null);if("string"!=typeof m)return z;if(!(m=m.trim().replace(/^[?#&]/,"")))return z;for(const P of m.split("&")){if(""===P)continue;let[m,N]=I(y.decode?P.replace(/\+/g," "):P,"=");N=void 0===N?null:["comma","separator","bracket-separator"].includes(y.arrayFormat)?N:decode(N,y),k(decode(m,y),N,z)}for(const m of Object.keys(z)){const k=z[m];if("object"==typeof k&&null!==k)for(const m of Object.keys(k))k[m]=parseValue(k[m],y);else z[m]=parseValue(k,y)}return!1===y.sort?z:(!0===y.sort?Object.keys(z).sort():Object.keys(z).sort(y.sort)).reduce(((m,y)=>{const k=z[y];return Boolean(k)&&"object"==typeof k&&!Array.isArray(k)?m[y]=keysSorter(k):m[y]=k,m}),Object.create(null))}m.extract=extract,m.parse=parse,m.stringify=(m,y)=>{if(!m)return"";validateArrayFormatSeparator((y=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},y)).arrayFormatSeparator);const shouldFilter=k=>y.skipNull&&null==m[k]||y.skipEmptyString&&""===m[k],k=function encoderForArrayFormat(m){switch(m.arrayFormat){case"index":return y=>(k,I)=>{const z=k.length;return void 0===I||m.skipNull&&null===I||m.skipEmptyString&&""===I?k:null===I?[...k,[encode(y,m),"[",z,"]"].join("")]:[...k,[encode(y,m),"[",encode(z,m),"]=",encode(I,m)].join("")]};case"bracket":return y=>(k,I)=>void 0===I||m.skipNull&&null===I||m.skipEmptyString&&""===I?k:null===I?[...k,[encode(y,m),"[]"].join("")]:[...k,[encode(y,m),"[]=",encode(I,m)].join("")];case"colon-list-separator":return y=>(k,I)=>void 0===I||m.skipNull&&null===I||m.skipEmptyString&&""===I?k:null===I?[...k,[encode(y,m),":list="].join("")]:[...k,[encode(y,m),":list=",encode(I,m)].join("")];case"comma":case"separator":case"bracket-separator":{const y="bracket-separator"===m.arrayFormat?"[]=":"=";return k=>(I,z)=>void 0===z||m.skipNull&&null===z||m.skipEmptyString&&""===z?I:(z=null===z?"":z,0===I.length?[[encode(k,m),y,encode(z,m)].join("")]:[[I,encode(z,m)].join(m.arrayFormatSeparator)])}default:return y=>(k,I)=>void 0===I||m.skipNull&&null===I||m.skipEmptyString&&""===I?k:null===I?[...k,encode(y,m)]:[...k,[encode(y,m),"=",encode(I,m)].join("")]}}(y),I={};for(const y of Object.keys(m))shouldFilter(y)||(I[y]=m[y]);const z=Object.keys(I);return!1!==y.sort&&z.sort(y.sort),z.map((I=>{const z=m[I];return void 0===z?"":null===z?encode(I,y):Array.isArray(z)?0===z.length&&"bracket-separator"===y.arrayFormat?encode(I,y)+"[]":z.reduce(k(I),[]).join("&"):encode(I,y)+"="+encode(z,y)})).filter((m=>m.length>0)).join("&")},m.parseUrl=(m,y)=>{y=Object.assign({decode:!0},y);const[k,z]=I(m,"#");return Object.assign({url:k.split("?")[0]||"",query:parse(extract(m),y)},y&&y.parseFragmentIdentifier&&z?{fragmentIdentifier:decode(z,y)}:{})},m.stringifyUrl=(y,k)=>{k=Object.assign({encode:!0,strict:!0,[P]:!0},k);const I=removeHash(y.url).split("?")[0]||"",z=m.extract(y.url),N=m.parse(z,{sort:!1}),O=Object.assign(N,y.query);let U=m.stringify(O,k);U&&(U=`?${U}`);let B=function getHash(m){let y="";const k=m.indexOf("#");return-1!==k&&(y=m.slice(k)),y}(y.url);return y.fragmentIdentifier&&(B=`#${k[P]?encode(y.fragmentIdentifier,k):y.fragmentIdentifier}`),`${I}${U}${B}`},m.pick=(y,k,I)=>{I=Object.assign({parseFragmentIdentifier:!0,[P]:!1},I);const{url:N,query:O,fragmentIdentifier:U}=m.parseUrl(y,I);return m.stringifyUrl({url:N,query:z(O,k),fragmentIdentifier:U},I)},m.exclude=(y,k,I)=>{const z=Array.isArray(k)?m=>!k.includes(m):(m,y)=>!k(m,y);return m.pick(y,z,I)}}(vi);const parseURL=(m,y)=>{let k;try{k=new URL(m,y)}catch(y){throw new RemixImageError(`Invalid URL: ${m}`,400)}return k};exports.Cache=Cache,exports.GB=m=>1e9*m,exports.MemoryCache=class MemoryCache extends Cache{config;cache;constructor(m={}){super(),this.config={maxSize:m?.maxSize??mB(50),ttl:m?.ttl??86400,tbd:m?.tbd??31536e3},this.cache=new U({ttl:this.config.ttl,allowStale:!0,updateAgeOnGet:!0,maxSize:this.config.maxSize,sizeCalculation:m=>m.byteLength})}async status(m){return this.cache.has(m)?exports.CacheStatus.HIT:exports.CacheStatus.MISS}async has(m){return this.cache.has(m)}async get(m){return this.cache.get(m)??null}async set(m,y){this.cache.set(m,y,{size:y.byteLength})}async clear(){this.cache.clear()}},exports.RemixImageError=RemixImageError,exports.UnsupportedImageError=UnsupportedImageError,exports.fetchResolver=fetchResolver,exports.generateKey=(...m)=>m.filter((m=>null!=m)).join("_"),exports.imageLoader=async({selfUrl:m,cache:y=null,resolver:k=fetchResolver,transformer:I=Dr,useFallbackFormat:z=!0,fallbackFormat:P,useFallbackTransformer:N=!0,fallbackTransformer:O=Dr,defaultOptions:U={},redirectOnFail:B=!1,skipFormats:M=new Set([exports.MimeType.SVG]),basePath:j="public",whitelistedDomains:G=null,blacklistedDomains:H=null,verbose:V=!1},q)=>{const Z=parseURL(q.url);let $=null;try{if(!m)throw new RemixImageError("selfUrl is required in RemixImage loader config!",500);let B;try{B=new URL(m)}catch(m){throw new RemixImageError("selfUrl is not a valid URL!")}const q=G?new Set([...G,B.host]):null,tt=H?new Set(H):null;if(K=Z.searchParams,Q="src",$=K.has(Q)?decodeURIComponent(K.get(Q)):null,!$)throw new RemixImageError("An image URL must be provided!",400);try{$=decodeURI($)}catch(m){throw new RemixImageError("An invalid image URL was provided!",400)}const et=(m=>{const y=vi.parse(m,{arrayFormat:"bracket",parseNumbers:!0,parseBooleans:!0,sort:!1});return Object.prototype.hasOwnProperty.call(y,"crop")&&null!=y.crop&&(y.crop=JSON.parse(y.crop)),y})(Z.search),vt={fit:"cover",position:"center",background:[0,0,0,0],quality:80,compressionLevel:9,loop:0,delay:100,blurRadius:null,rotate:null,flip:null,crop:null,...U,...et},yt=parseURL($,m);if(!vt.width)throw new RemixImageError("A width is required!",400);if(vt.width&&vt.width>8e3)throw new RemixImageError("Requested Image too large!",406);if(vt.height&&vt.height>8e3)throw new RemixImageError("Requested Image too large!",406);const xt=Z.search;let kt,Et,It,zt=!0,Ut=!0,Bt=vt.contentType;if(y&&await y.has(xt)){const m=await y.get(xt);m&&(V&&console.log(`Retrieved image [${xt}] from cache.`),zt=!1,Ut=!1,kt=m,It=g(kt))}if(!kt){if(q&&!q.has(yt.host))throw new RemixImageError("The requested image host is not included on the whitelist!");if(tt&&tt.has(yt.host))throw new RemixImageError("The requested image host is not allowed!");const m=await k($,yt.toString(),vt,j);V&&console.log(`Fetched image [${xt}] directly using resolver: ${k.name}.`),zt=!0,Ut=!0,kt=m.buffer,It=m.contentType}if(!kt||!It)throw new RemixImageError("Failed to transform requested image!",500);if(Bt||(Bt=It),!Ut||M?.has(It))Et=kt;else if(null!=I){let m=I;if(!I.supportedInputs.has(It)){if(!N||I===O||!O.supportedInputs.has(It))throw new UnsupportedImageError(`Transformer does not allow this input content type: ${It}!`);console.error(`Transformer does not allow this input content type: ${It}! Falling back to transformer: ${O.name}`),m=O}m.supportedOutputs.has(Bt)||(z&&null!=P&&m.supportedOutputs.has(P)?(console.error(`Transformer does not allow this output content type: ${Bt}! Falling back to mime type: ${P}`),Bt=P):(console.error(`Transformer does not allow this output content type: ${Bt}! Falling back to mime type: ${m.fallbackOutput}`),Bt=m.fallbackOutput)),Et=await m.transform({url:yt.toString(),data:kt,contentType:It},{...vt,contentType:Bt}),V&&console.log(`Successfully transformed image using transformer: ${m.name}`)}if(!Et)throw new RemixImageError("Failed to transform requested image!",500);return zt&&y&&await y.set(xt,Et),W=Et,X=200,J=Bt,Y=y?`private, max-age=${y.config.ttl}, max-stale=${y.config.tbd}`:"public, max-age=31536000",new Response(W,{status:X,headers:{"Content-Type":J,"Cache-Control":Y}})}catch(m){if("undefined"!=typeof process&&"test"===process?.env?.NODE_ENV)throw m;return console.error("RemixImage loader error:",m?.message),console.error(m),B&&$?new Response(null,{status:302,headers:{Location:$}}):m instanceof RemixImageError?textResponse(m.errorCode||500,m.message):textResponse(500,"RemixImage encountered an unknown error!")}var W,X,J,Y,K,Q},exports.kB=m=>1e3*m,exports.kvResolver=async(y,k)=>{const I=new Request(k),z=await((y,k)=>{if("undefined"!=typeof process&&"development"===process?.env?.NODE_ENV)return m.getAssetFromKV(y,{cacheControl:{bypassCache:!0},...k});let I={};return new URL(y.request.url).pathname.split("/").slice(0,-1).join("/").startsWith("/build")&&(I={bypassCache:!1,edgeTTL:31536e3,browserTTL:31536e3}),m.getAssetFromKV(y,{cacheControl:I,...k})})({request:I,waitUntil:noOp});if(!z)throw new m.NotFoundError("Image not found!");const P=await z.arrayBuffer();if(!P||P.byteLength<2)throw new RemixImageError("Invalid image retrieved from resolver!");const N=new Uint8Array(P);let O=null;try{O=g(N)}catch(m){if(!jr((new TextDecoder).decode(N)))throw new UnsupportedImageError("Buffer is not a supported image type!");O=exports.MimeType.SVG}return{buffer:N,contentType:O}},exports.mB=mB,exports.pureTransformer=Dr,exports.version="1.4.0";
//# sourceMappingURL=pure.js.map
